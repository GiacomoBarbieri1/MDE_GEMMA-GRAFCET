{"version":3,"sources":["node/node.tsx","canvas/arrow.tsx","canvas/canvas.tsx","utils.ts","canvas/config-view.tsx","node/node-model.tsx","canvas/store.tsx","graph-menu/main-menu.tsx","properties/properties-table.tsx","properties/properties-view.tsx","step/gemma-templates.ts","fields/choice-field.tsx","step/gemma.tsx","fields/primitive-field.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["StyledNode","styled","div","NodeView","observer","operation","rootStore","useStore","onDrag","React","useCallback","_","data","move","deltaX","deltaY","selectingInput","undefined","selectingInputFor","isValidInput","onClick","console","log","assignInput","selectNode","x","y","name","position","bounds","ref","e","setSize","getBoundingClientRect","style","cursor","triangleFromCenter","height","width","y0","ArrowView","changeX","changeY","connection","from","to","x1","y1","x2","y2","dy","dx","m","Math","abs","xa","ya","xm","ym","degrees","atan2","PI","strokeWidth","stroke","d","selectConnection","RectAndText","text","connectionText","transform","rectFill","padding","useState","textRef","setTextRef","prev","setPrev","bbox","getBBox","useEffect","id","setTimeout","clearTimeout","fill","MainCanvas","ops","nodes","values","overflow","flex","border","background","margin","borderRadius","map","key","flatMap","op","inputs","defaultResizeEnable","top","right","bottom","left","topRight","bottomRight","bottomLeft","topLeft","resizableEnable","f","Object","entries","reduce","p","k","v","ConfigView","connections","c","forEach","get","set","push","Map","orderedOps","counts","filter","withDependencies","length","numProcessed","size","slice","outs","dep","delete","minWidth","defaultSize","boxShadow","enable","globalData","generateCode","ConnModel","dataBuilder","this","NodeModel","graph","conn","outputs","observable","array","computed","action","rect","RootStoreModel","builders","graphBuilder","selectedConnection","remove","node","selectedNode","_in","_out","nodeType","pos","canAddNode","nodeBuilder","v4","window","addEventListener","_selectingInputKeyListener","connectionBuilder","addOutput","ev","removeEventListener","MainList","ul","MainMenu","items","disableDragging","maxWidth","maxHeight","display","flexDirection","enableResizing","type","List","component","Array","isArray","t","ListItem","button","className","addNode","ListItemText","primary","list","Item","open","setOpen","icon","Collapse","in","timeout","unmountOnExit","disablePadding","PropertiesTable","children","PropertiesTableStyled","PropertiesTableNode","self","fullOfInputs","nInputs","isAddingInput","spec","plotField","model","table","PropertiesView","inner","setT","justifyContent","alignItems","TextField","value","onChange","setName","target","IconButton","removeNode","color","removeConnection","ConnectionView","_tokens","tokens","prevIndex","font","index","textIndex","VarId","includes","whiteSpace","repeat","toString","caretColor","onSelect","currentTarget","selectionStart","minHeight","l","i","omit","signal","addSignal","add","strPrev","substring","H","textOrEmpty","cond","templateTransitions","transitions","isNested","condition","expression","join","templateFBEntry","templateGemmaGraphcet","steps","s","StepType","ENCLOSING","MACRO","initialStep","step","templateGemmaGraphcetEnclosingStep","INITIAL","SIMPLE","templateGemmaGraphcetSimpleStep","innerTransitionsLength","templateGemmaGraphcetMacroStep","replace","SignalType","ButtonsDiv","ChoiceFieldSpec","choices","default","isObservableMap","keys","Symbol","toStringTag","mobxProp","types","optional","string","setValue","Error","ChoiceField","Select","autoWidth","MenuItem","ButtonGroup","aria-label","buttonStyle","Button","StrFieldSpec","maxLength","minLength","errors","inputProps","textAlign","error","fullWidth","ProcedureType","GemmaGraphcet","workingFamilyTransitions","signals","View","label","Signal","_hasInitialStep","some","n","find","description","bool","BaseStep","Number","POSITIVE_INFINITY","family","F","inputNodes","every","_transitions","automationSystem","concat","indexOf","SimpleStep","InitialStep","EnclosingStep","MacroStep","Transition","conditionExpression","Condition","g","s1","s2","_t","A","D","storeContext","createContext","store","useContext","App","Provider","Boolean","location","hostname","match","library","faChevronDown","faChevronUp","faTrashAlt","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.8b21e06c.chunk.js","sourcesContent":["import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport Draggable, { DraggableData, DraggableEvent } from \"react-draggable\";\nimport styled from \"styled-components\";\nimport { NodeModel } from \"./node-model\";\nimport { useStore } from \"../App\";\n\nexport type Shape = (number | undefined)[];\n\nconst StyledNode = styled.div`\n  z-index: 1;\n  cursor: pointer;\n  position: absolute;\n  box-shadow: 0 1px 4px 1px #eee;\n  padding: 6px;\n  background: #fff;\n  border-radius: 6;\n  border: 1px solid #eee;\n`;\n\ntype NodeViewProps = { operation: NodeModel<any, any, any> };\nexport const NodeView: React.FC<NodeViewProps> = observer(\n  ({ operation }) => {\n    const rootStore = useStore();\n    const onDrag = React.useCallback(\n      (_: DraggableEvent, data: DraggableData) => {\n        operation.move(data.deltaX, data.deltaY);\n      },\n      [operation]\n    );\n    const selectingInput = rootStore.selectingInputFor !== undefined;\n    const isValidInput =\n      selectingInput && rootStore.selectingInputFor!.data.isValidInput(operation);\n\n    const onClick = React.useCallback(\n      (_: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        console.log(operation);\n        if (selectingInput) {\n          if (isValidInput) {\n            rootStore.assignInput(operation);\n          }\n        } else {\n          rootStore.selectNode(operation);\n        }\n      },\n      [rootStore, operation, selectingInput, isValidInput]\n    );\n    // const [_, setDivRef] = React.useState<HTMLDivElement | null>(null);\n    const { x, y, name } = operation;\n\n    return (\n      <Draggable onDrag={onDrag} position={{ x, y }} bounds=\"parent\">\n        <StyledNode\n          ref={(e) => {\n            if (e === null) return;\n            operation.setSize(e.getBoundingClientRect());\n          }}\n          onClick={onClick}\n          style={\n            selectingInput\n              ? { cursor: isValidInput ? \"pointer\" : \"not-allowed\" }\n              : undefined\n          }\n        >\n          {`Layer ${name}`}\n        </StyledNode>\n      </Draggable>\n    );\n  }\n);","import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { NodeModel, ConnModel } from \"../node/node-model\";\nimport { useStore } from \"../App\";\n\nexport type ArrowModel = {\n  from: NodeModel<any, any, any>;\n  to: NodeModel<any, any, any>;\n};\n\ntype ArrowViewProps = { connection: ConnModel<any, any, any> };\n\nconst triangleFromCenter = (\n  x: number,\n  y: number,\n  height: number = 14,\n  width: number = 14\n) => {\n  const y0 = y + height;\n  return `M${x} ${y} L${x - width / 2} ${y0} L${x + width / 2} ${y0} Z`;\n};\n\nexport const ArrowView: React.FC<ArrowViewProps> = observer(\n  ({ connection }: ArrowViewProps) => {\n    const rootStore = useStore();\n    const { from, to } = connection;\n\n    const [x1, y1, x2, y2] = [\n      from.x + from.width / 2,\n      from.y + from.height / 2,\n      to.x + to.width / 2,\n      to.y + to.height / 2,\n    ];\n    const dy = y2 - y1;\n    const dx = x2 - x1;\n\n    let changeX;\n    let changeY;\n    if (dx === 0) {\n      changeX = 0;\n      changeY = ((y2 > y1 ? 1 : -1) * to.height) / 2;\n    } else if (dy === 0) {\n      changeY = 0;\n      changeX = ((x2 > x1 ? 1 : -1) * to.width) / 2;\n    } else {\n      const m = Math.abs(dy / dx);\n      const [deltaX, deltaY] =\n        m > to.height / to.width\n          ? [to.height / 2 / m, to.height / 2]\n          : [to.width / 2, (to.width / 2) * m];\n      changeY = (y2 > y1 ? 1 : -1) * deltaY;\n      changeX = (x2 > x1 ? 1 : -1) * deltaX;\n    }\n    const xa = x2 - changeX;\n    const ya = y2 - changeY;\n\n    const [xm, ym] = [(x1 + x2) / 2, (y1 + y2) / 2];\n    const degrees = 90 + (Math.atan2(y2 - y1, x2 - x1) * 180) / Math.PI;\n\n    return (\n      <>\n        <path\n          style={{ strokeWidth: 2, stroke: \"black\" }}\n          d={`M${x1} ${y1} L${x2} ${y2}`}\n          onClick={(e) => {\n            rootStore.selectConnection(connection);\n          }}\n        />\n        <RectAndText\n          text={connection.data.connectionText}\n          x={xm}\n          y={ym}\n          onClick={(_) => rootStore.selectConnection(connection)}\n        />\n        <path\n          d={triangleFromCenter(xa, ya)}\n          transform={`rotate(${degrees} ${xa} ${ya})`}\n        />\n      </>\n    );\n  }\n);\n\nconst RectAndText: React.FC<{\n  text: string;\n  x: number;\n  y: number;\n  rectFill?: string;\n  padding?: number;\n  onClick: (event: React.MouseEvent<any, MouseEvent>) => void;\n}> = observer(\n  ({ text, x: xm, y: ym, rectFill = \"#eee\", padding = 3, onClick }) => {\n    const [textRef, setTextRef] = React.useState<SVGTextElement | null>(null);\n    const [prev, setPrev] = React.useState(text);\n    const bbox = textRef?.getBBox();\n    React.useEffect(() => {\n      if (prev !== text) {\n        const id = setTimeout(() => setPrev(text), 0);\n        return () => clearTimeout(id);\n      }\n    });\n\n    return (\n      <>\n        {bbox !== undefined && (\n          <rect\n            width={bbox.width + padding * 2}\n            height={bbox.height + padding * 2}\n            x={xm - bbox.width / 2 - padding}\n            y={ym - bbox.height + padding}\n            fill={rectFill}\n            onClick={onClick}\n          ></rect>\n        )}\n        <text\n          x={bbox !== undefined ? xm - bbox.width / 2 : xm}\n          y={ym}\n          fill=\"black\"\n          ref={setTextRef}\n          onClick={onClick}\n        >\n          {text}\n        </text>\n      </>\n    );\n  }\n);\n\n// const getBoxIntersection = (from: OperationModelT, to: OperationModelT) => {\n//   const fwidth = from.width || 60;\n//   const fheight = from.width || 60;\n//   const twidth = to.width || 60;\n//   const theight = to.width || 60;\n\n//   const [x1, y1, x2, y2] = [\n//     from.x + fwidth / 2,\n//     from.y + fheight / 2,\n//     to.x + twidth / 2,\n//     to.y + theight / 2\n//   ];\n//   const dy = y2 - y1;\n//   const dx = x2 - x1;\n//   if (dx === 0 || dy === 0) {\n//   }\n//   const m = dy / dx;\n\n//   const degrees = 90 + (Math.atan2(dy, dx) * 180) / Math.PI;\n//   let xpos = x2 > x1 ? 1 : -1;\n//   const interY = (y2 - y1) / m;\n//   const interX = x2 * m + y1;\n// };\n","import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { useStore } from \"../App\";\nimport { NodeView } from \"../node/node\";\nimport { ArrowView } from \"./arrow\";\n\ntype Props = {};\n\nexport const MainCanvas: React.FC<Props> = observer(() => {\n  const rootStore = useStore();\n  const ops = [...rootStore.nodes.values()];\n  return (\n    <div style={{ overflow: \"auto\", flex: \"1\" }}>\n      <div\n        style={{\n          position: \"relative\",\n          border: \"1px solid #eee\",\n          background: \"#fff\",\n          margin: \"10px\",\n          borderRadius: \"6px\",\n          flex: 1,\n          height: \"1500px\",\n          width: \"1500px\",\n        }}\n      >\n        {ops.map((operation) => {\n          console.log(operation);\n          return <NodeView operation={operation} key={operation.key} />;\n        })}\n        <svg style={{ width: \"100%\", height: \"100%\" }}>\n          {ops\n            .flatMap((op) => op.inputs)\n            .map((connection) => (\n              <ArrowView\n                connection={connection}\n                key={connection.from.key + connection.to.key}\n              />\n            ))}\n        </svg>\n      </div>\n    </div>\n  );\n});\n","export function listToMap<T extends number | string>(l: Array<T>) {\n  return l.reduce((p, c) => {\n    p[c.toString()] = c;\n    return p;\n  }, {} as { [key: string]: T });\n}\n\nconst defaultResizeEnable = {\n  top: false,\n  right: false,\n  bottom: false,\n  left: false,\n  topRight: false,\n  bottomRight: false,\n  bottomLeft: false,\n  topLeft: false,\n};\n\nexport function resizableEnable(f: {\n  top?: boolean;\n  right?: boolean;\n  bottom?: boolean;\n  left?: boolean;\n  topRight?: boolean;\n  bottomRight?: boolean;\n  bottomLeft?: boolean;\n  topLeft?: boolean;\n}) {\n  return Object.entries(f).reduce((p, [k, v]) => {\n    if (v !== undefined) {\n      p[k as keyof typeof defaultResizeEnable] = v;\n    }\n    return p;\n  }, {...defaultResizeEnable});\n}\n","import { observer } from \"mobx-react-lite\";\nimport { Resizable } from \"re-resizable\";\nimport React from \"react\";\nimport { useStore } from \"../App\";\nimport { NodeModel } from \"../node/node-model\";\nimport { resizableEnable } from \"../utils\";\nimport { GlobalData } from \"./store\";\n\ntype Props = {};\n\nexport const ConfigView: React.FC<Props> = observer(<\n  G extends GlobalData<any>\n>() => {\n  const rootStore = useStore<any, G, any>();\n  const ops = [...rootStore.nodes.values()];\n  const connections = ops.reduce((p, c) => {\n    c.inputs.forEach((v) => {\n      let m = p.get(v.to);\n      if (m === undefined) {\n        m = [];\n        p.set(v.to, m);\n      }\n      m.push(c);\n    });\n    return p;\n  }, new Map<NodeModel<any, any, any>, NodeModel<any, any, any>[]>());\n\n  const orderedOps: NodeModel<any, any, any>[] = [];\n  const counts = new Map(\n    ops\n      .filter((op) => {\n        const withDependencies = op.data.length !== 0;\n        if (!withDependencies) {\n          orderedOps.push(op);\n        }\n        return withDependencies;\n      })\n      .map((op) => [op, op.data.length])\n  );\n  let numProcessed = 0;\n  while (counts.size !== 0 && orderedOps.length !== numProcessed) {\n    for (let k of orderedOps.slice(numProcessed)) {\n      numProcessed += 1;\n      const outs = connections.get(k);\n      if (outs === undefined) continue;\n\n      for (let dep of outs) {\n        const m = counts.get(dep)!;\n        if (m === 1) {\n          counts.delete(dep);\n          orderedOps.push(dep);\n        } else {\n          counts.set(dep, m - 1);\n        }\n      }\n    }\n  }\n\n  if (counts.size !== 0) {\n    // CICLE ?\n  }\n\n  return (\n    <Resizable\n      minWidth={200}\n      defaultSize={{ height: \"auto\", width: 400 }}\n      style={{\n        position: \"relative\",\n        background: \"white\",\n        boxShadow: \"0 1px 4px 1px #eee\",\n        border: \"1px solid #eee\",\n      }}\n      enable={resizableEnable({ left: true })}\n    >\n      <div style={{ overflow: \"auto\", height: \"100%\", padding: \"0 10px\" }}>\n        <pre>{rootStore.globalData.generateCode()}</pre>\n        {/* {ops.map((op) => {\n          return (\n            <pre key={op.key}>\n              {op.name + \" = \" + op.data.pythonCode + \"\\n\"}\n            </pre>\n          );\n        })}\n\n        {orderedOps.map((op) => {\n          if (op.data.inputs.length > 0) {\n            return (\n              <pre key={op.key + \"input\"}>\n                {`${op.name}_output = ${op.name}(${op.inputs\n                  .map((inp) => inp.to.name)\n                  .join(\",\")});`}\n              </pre>\n            );\n          }\n          return null;\n        })} */}\n      </div>\n    </Resizable>\n  );\n});\n","import {\n  action,\n  computed,\n  observable,\n  ObservableMap,\n} from \"mobx\";\nimport { SnapshotIn } from \"mobx-state-tree\";\nimport { FieldSpec } from \"../fields\";\nimport { GlobalData, RootStoreModel, ConnectionData } from \"../canvas/store\";\n\nexport type OperationI<\n  V extends { [key: string]: FieldSpec },\n  D extends NodeData<D, G, any>,\n  G extends GlobalData<D>\n> = {\n  [key in keyof V]: SnapshotIn<ReturnType<V[key][\"mobxProp\"]>>;\n} & {\n  NAME: string;\n  spec: V;\n  nInputs: number;\n  errors: ObservableMap<keyof V, string>;\n};\n\nexport const mobxDecorators = <V extends { [key: string]: FieldSpec }>(\n  spec: V\n) => {\n  return {\n    ...Object.keys(spec).reduce((p, c) => {\n      p[c as keyof V] = observable;\n      return p;\n    }, {} as { [key in keyof V]: PropertyDecorator }),\n    errors: observable,\n  };\n};\n\nexport interface NodeData<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<G>\n> {\n  isValidInput(input: NodeModel<D, G, C>): boolean;\n  nInputs: number;\n  spec: { [key: string]: FieldSpec };\n  // TODO: ObservableMap<keyof V, string>\n  errors: ObservableMap<string, string>;\n}\n\nexport class ConnModel<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<G>\n> {\n  constructor(\n    public from: NodeModel<D, G, C>,\n    public to: NodeModel<D, G, C>,\n    dataBuilder: (connection: ConnModel<D, G, C>) => C\n  ) {\n    this.data = dataBuilder(this);\n  }\n\n  data: C;\n}\n\nexport class NodeModel<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<G>\n> {\n  constructor(\n    public graph: RootStoreModel<D, G, any>,\n    d: {\n      key: string;\n      name: string;\n      x: number;\n      y: number;\n      dataBuilder: (node: NodeModel<D, G, C>) => D;\n    }\n  ) {\n    this.key = d.key;\n    this.name = d.name;\n    this.x = d.x;\n    this.y = d.y;\n    this.data = d.dataBuilder(this);\n  }\n\n  @observable\n  key: string;\n  @observable\n  name: string;\n  @observable\n  x: number;\n  @observable\n  y: number;\n  @observable\n  width: number = 60;\n  @observable\n  height: number = 60;\n  @observable\n  data: D;\n  @observable\n  inputs = observable.array<ConnModel<D, G, C>>();\n  @computed\n  get inputNodes(): NodeModel<D, G, C>[] {\n    return this.inputs.map((c) => c.from);\n  }\n  @observable\n  outputs = observable.array<ConnModel<D, G, C>>();\n  @computed\n  get outputNodes(): NodeModel<D, G, C>[] {\n    return this.outputs.map((c) => c.to);\n  }\n\n  @action   \n  addInput(conn: ConnModel<D, G, C>) {\n    this.inputs.push(conn);\n    conn.from.outputs.push(conn);\n  }\n\n  @action\n  addOutput(conn: ConnModel<D, G, C>) {\n    this.outputs.push(conn);\n    conn.to.inputs.push(conn);\n  }\n\n  @action\n  move = (dx: number, dy: number) => {\n    this.x += dx;\n    this.y += dy;\n  };\n  @action\n  setSize = (rect: DOMRect) => {\n    this.width = rect.width;\n    this.height = rect.height;\n  };\n  @action\n  setName = (name: string) => {\n    this.name = name;\n  };\n}","import { action, observable, ObservableMap } from \"mobx\";\nimport { v4 } from \"uuid\";\nimport { NodeModel, NodeData, ConnModel } from \"../node/node-model\";\n\nexport type DataBuilder<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<D>\n> = {\n  connectionBuilder: (connection: ConnModel<D, G, C>) => C;\n  nodeBuilder: { [key: string]: (node: NodeModel<D, G, C>) => D };\n  graphBuilder: (connection: RootStoreModel<D, G, C>) => G;\n};\n\nexport interface GlobalData<D extends NodeData<D, any, any>> {\n  generateCode(): string;\n  canAddNode(nodeType: string): boolean;\n  View: React.FunctionComponent;\n}\n\nexport type ConnectionData<D> = {\n  ConnectionView: React.FunctionComponent;\n  connectionText: string;\n};\n\nexport class RootStoreModel<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<D>\n> {\n  @action\n  removeConnection(connection: ConnModel<D, G, C>): void {\n    if (connection === this.selectedConnection) {\n      this.selectedConnection = undefined;\n    }\n    connection.from.outputs.remove(connection);\n    connection.to.inputs.remove(connection);\n  }\n\n  constructor(d: { builders: DataBuilder<D, G, C> }) {\n    this.builders = d.builders;\n    this.globalData = d.builders.graphBuilder(this);\n  }\n\n  // Builders to create graph, node and transition instances\n  builders: DataBuilder<D, G, C>;\n  // Global generic data\n  globalData: G;\n\n  // All nodes\n  @observable\n  nodes: ObservableMap<string, NodeModel<D, G, C>> = observable.map({});\n  // Selected node\n  @observable\n  selectedNode?: NodeModel<D, G, C>;\n  // Selected connection\n  @observable\n  selectedConnection?: ConnModel<D, G, C>;\n  // Selected input for transition\n  @observable\n  selectingInputFor?: NodeModel<D, G, C>;\n\n  // Select a node\n  @action\n  selectNode = (node: NodeModel<D, G, C>) => {\n    this.selectedNode = node;\n  };\n\n  // Select a connection\n  @action\n  selectConnection = (connection: ConnModel<D, G, C>) => {\n    this.selectedConnection = connection;\n  };\n\n  // Add a node\n  @action\n  addNode = (\n    nodeType: string,\n    pos?: { x: number; y: number }\n  ): NodeModel<D, G, C> | undefined => {\n    if (this.globalData.canAddNode(nodeType)) {\n      const dataBuilder = this.builders.nodeBuilder[nodeType];\n      if (dataBuilder !== undefined) {\n        const op = new NodeModel(this, {\n          dataBuilder,\n          key: v4(),\n          name: nodeType,\n          x: pos?.x ?? 100,\n          y: pos?.y ?? 100,\n        });\n        this.nodes.set(op.key, op);\n        return op;\n      }\n    }\n  };\n\n  // remove a node\n  @action\n  removeNode(node: NodeModel<D, G, C>): void {\n    if (node === this.selectedNode) {\n      this.selectedNode = undefined;\n    }\n    if (this.nodes.delete(node.key)) {\n      for (const _in of node.inputs) {\n        _in.from.outputs.remove(_in);\n      }\n      for (const _out of node.outputs) {\n        _out.to.inputs.remove(_out);\n      }\n    }\n  }\n\n  // Select a node\n  @action\n  selectingInput = (from: NodeModel<D, G, C>) => {\n    this.selectingInputFor = from;\n    window.addEventListener(\"keyup\", this._selectingInputKeyListener);\n  };\n\n  @action\n  assignInput = (to: NodeModel<D, G, C>): ConnModel<D, G, C> => {\n    const conn = new ConnModel(\n      this.selectingInputFor!,\n      to,\n      this.builders.connectionBuilder\n    );\n    conn.from.addOutput(conn);\n    this.selectingInputFor = undefined;\n    this.selectedConnection = conn;\n    return conn;\n  };\n\n  @action\n  private _selectingInputKeyListener = (ev: KeyboardEvent) => {\n    if (ev.key === \"Escape\") {\n      this.selectingInputFor = undefined;\n      window.removeEventListener(\"keyup\", this._selectingInputKeyListener);\n    }\n  };\n}\n","import { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport Collapse from \"@material-ui/core/Collapse\";\nimport List from \"@material-ui/core/List\";\nimport ListItem from \"@material-ui/core/ListItem\";\nimport ListItemText from \"@material-ui/core/ListItemText\";\nimport { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { Rnd } from \"react-rnd\";\nimport styled from \"styled-components\";\nimport { resizableEnable } from \"../utils\";\nimport { useStore } from \"../App\";\n\nconst MainList = styled.ul`\n  overflow-y: scroll;\n  height: 100%;\n  margin: 0;\n  padding: 0px 10px 25px;\n\n  .group {\n    padding-left: 10px;\n    padding-top: 3px;\n    padding-bottom: 3px;\n    border-top: 2px solid #eee;\n    margin-top: 6px;\n    .MuiListItemText-primary {\n      font-weight: bold;\n    }\n  }\n  .nested {\n    padding-left: 25px;\n    padding-top: 0px;\n    padding-bottom: 0px;\n  }\n`;\n\ntype Props = { items: { [key: string]: string[] } | string[] };\n\nexport const MainMenu: React.FC<Props> = observer(({ items }) => {\n  const rootStore = useStore();\n  return (\n    <Rnd\n      disableDragging={true}\n      maxWidth={300}\n      minWidth={200}\n      style={{\n        position: \"relative\",\n        maxHeight: \"100%\",\n        display: \"flex\",\n        flexDirection: \"column\",\n      }}\n      enableResizing={resizableEnable({\n        right: true,\n      })}\n    >\n      <input type=\"text\" />\n      <MainList>\n        <List component=\"nav\">\n          {Array.isArray(items)\n            ? items.map((t) => (\n                <ListItem\n                  button\n                  key={t}\n                  className=\"nested\"\n                  onClick={() => {\n                    rootStore.addNode(t);\n                  }}\n                >\n                  <ListItemText primary={t} />\n                </ListItem>\n              ))\n            : Object.entries(items).map(([name, list]) => (\n                <Item key={name} name={name} list={list} />\n              ))}\n        </List>\n      </MainList>\n    </Rnd>\n  );\n});\n\ntype ItemProps = { name: string; list: string[] };\n\nexport const Item: React.FC<ItemProps> = observer(({ name, list }) => {\n  const [open, setOpen] = React.useState(true);\n  const rootStore = useStore();\n  return (\n    <>\n      <ListItem button onClick={() => setOpen(!open)} className=\"group\">\n        <ListItemText primary={name} />\n        <FontAwesomeIcon icon={open ? \"chevron-up\" : \"chevron-down\"} />\n      </ListItem>\n      <Collapse in={open} timeout=\"auto\" unmountOnExit>\n        <List component=\"div\" disablePadding>\n          {list.map((t) => (\n            <ListItem\n              button\n              key={t}\n              className=\"nested\"\n              onClick={() => {\n                rootStore.addNode(t);\n              }}\n            >\n              <ListItemText primary={t} />\n            </ListItem>\n          ))}\n        </List>\n      </Collapse>\n    </>\n  );\n});","import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { NodeModel, NodeData } from \"../node/node-model\";\nimport { useStore } from \"../App\";\n\ntype Props2 = {\n  children: React.ReactNode;\n};\n\nexport const PropertiesTable = observer(({ children }: Props2) => {\n  return (\n    <PropertiesTableStyled>\n      <thead>\n        <tr>\n          <td>Property</td>\n          <td>Value</td>\n        </tr>\n      </thead>\n      <tbody>{children}</tbody>\n    </PropertiesTableStyled>\n  );\n});\n\ntype Props<D extends NodeData<D, any, any>> = {\n  self: NodeModel<D, any, any>;\n};\n\nexport const PropertiesTableNode = observer(\n  <D extends NodeData<D, any, any>>({ self }: Props<D>) => {\n    const rootStore = useStore();\n    const fullOfInputs = self.inputs.length >= self.data.nInputs;\n    const isAddingInput = rootStore.selectingInputFor !== undefined;\n    return (\n      <PropertiesTable>\n        {self.data.nInputs !== 0 && (\n          <tr>\n            <td>Inputs</td>\n            <td>\n              {self.inputs.map((v) => (\n                <div\n                  onClick={() => rootStore.selectConnection(v as any)}\n                  key={v.from.key}\n                  style={{ padding: \"5px\" }}\n                >\n                  {v.from.name}\n                </div>\n              ))}\n              {!fullOfInputs && (\n                <div\n                  onClick={() => rootStore.selectingInput(self as any)}\n                  style={\n                    isAddingInput\n                      ? { background: \"#eee\" }\n                      : { cursor: \"pointer\" }\n                  }\n                >\n                  Add Transition\n                </div>\n              )}\n            </td>\n          </tr>\n        )}\n        {Object.entries(self.data.spec).map(([k, v]) => (\n          <tr key={k}>\n            <td>{k}</td>\n            <td>\n              <v.plotField name={k} model={self.data as any} />\n            </td>\n          </tr>\n        ))}\n      </PropertiesTable>\n    );\n  }\n);\n\nconst PropertiesTableStyled = styled.table`\n  padding-bottom: 10px;\n  thead {\n    font-size: 1.1em;\n    font-weight: bolder;\n  }\n  tr td {\n    padding: 0;\n  }\n  tr td:first-child {\n    padding-right: 15px;\n    height: 32px;\n  }\n  tr td:last-child {\n    margin: auto auto;\n    padding-left: 10px;\n    text-align: center;\n    align-self: center;\n  }\n`;\n","import { observer } from \"mobx-react-lite\";\nimport { Resizable } from \"re-resizable\";\nimport React, { useState } from \"react\";\nimport { resizableEnable } from \"../utils\";\nimport { PropertiesTableNode } from \"./properties-table\";\nimport { useStore } from \"../App\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport TextField from \"@material-ui/core/TextField\";\n\ntype Props = {};\n\nexport const PropertiesView: React.FC<Props> = observer(() => {\n  const rootStore = useStore();\n  const [t, setT] = useState<string>(\"\");\n\n  let inner;\n  if (rootStore.selectedNode != null) {\n    const selectedNode = rootStore.selectedNode;\n    const selectedConnection = rootStore.selectedConnection;\n    inner = (\n      <div\n        style={{\n          overflow: \"auto\",\n          maxHeight: \"100%\",\n          maxWidth: \"100%\",\n        }}\n        key={rootStore.selectedNode.key}\n        className=\"row\"\n      >\n        <div style={{ padding: \"15px\" }}>\n          <div\n            className=\"row\"\n            style={{ justifyContent: \"space-between\", alignItems: \"center\" }}\n          >\n            <TextField\n              type=\"text\"\n              value={selectedNode.name}\n              onChange={(e) => selectedNode.setName(e.target.value)}\n              style={{ width: \"150px\" }}\n            ></TextField>\n            <IconButton onClick={(e) => rootStore.removeNode(selectedNode)}>\n              <FontAwesomeIcon icon={\"trash-alt\"} color={\"#000\"} />\n            </IconButton>\n          </div>\n          <PropertiesTableNode self={rootStore.selectedNode} />\n        </div>\n        <div style={{ padding: \"15px\" }}>\n          {selectedConnection !== undefined && (\n            <div className=\"col\">\n              <div\n                className=\"row\"\n                style={{\n                  justifyContent: \"space-between\",\n                  alignItems: \"center\",\n                }}\n              >\n                <div>{`${selectedConnection.from.name} -> ${selectedConnection.to.name}`}</div>\n                <IconButton\n                  onClick={(e) =>\n                    rootStore.removeConnection(selectedConnection)\n                  }\n                >\n                  <FontAwesomeIcon icon={\"trash-alt\"} color={\"#000\"} />\n                </IconButton>\n              </div>\n              <selectedConnection.data.ConnectionView />\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  } else {\n    const _tokens = tokens(t);\n    console.log(_tokens);\n    let prevIndex = 0;\n    inner = (\n      <div style={{ width: \"150px\" }} className=\"center\">\n        <span\n          style={{\n            font: \"400 13.3333px monospace\",\n            position: \"absolute\",\n            top: 0,\n            margin: \"3px\",\n            width: \"180px\",\n          }}\n        >\n          {_tokens.map(([c, textIndex], index) => {\n            let color: string;\n            if (c instanceof VarId) {\n              color = \"black\";\n            } else if ([\"AND\", \"NOT\", \"OR\"].includes(c)) {\n              color = \"blue\";\n            } else {\n              color = \"brown\";\n            }\n            const whiteSpace = textIndex - prevIndex;\n            console.log(whiteSpace);\n            const text =\n              (whiteSpace !== 0 ? \" \".repeat(whiteSpace) : \"\") + c.toString();\n            prevIndex = textIndex + c.toString().length;\n            return (\n              <span key={index} style={{ color }}>\n                {text}\n              </span>\n            );\n          })}\n        </span>\n        <textarea\n          style={{\n            font: \"400 13.3333px monospace\",\n            color: \"transparent\",\n            caretColor: \"black\",\n            width: \"180px\",\n            position: \"relative\",\n            background: \"transparent\",\n          }}\n          value={t}\n          onSelect={(e) => {\n            console.log(e.currentTarget.selectionStart);\n          }}\n          onChange={(e) => {\n            setT(e.currentTarget.value);\n            // console.log(tokens(e.currentTarget.value));\n          }}\n        ></textarea>\n      </div>\n    );\n  }\n\n  return (\n    <Resizable\n      minHeight={200}\n      defaultSize={{ height: 280, width: \"auto\" }}\n      style={{\n        position: \"relative\",\n        background: \"white\",\n        boxShadow: \"0 1px 4px 1px #eee\",\n        border: \"1px solid #eee\",\n      }}\n      enable={resizableEnable({ top: true })}\n    >\n      {inner}\n    </Resizable>\n  );\n});\n\nclass VarId {\n  constructor(public text: string) {}\n\n  toString(): string {\n    return this.text;\n  }\n}\ntype Token =\n  | \"(\"\n  | \")\"\n  | \"AND\"\n  | \"OR\"\n  | \"NOT\"\n  | \"<\"\n  | \">\"\n  | \"=\"\n  | \"<=\"\n  | \">=\"\n  | VarId;\n\nconst tokens = (t: string): [Token, number][] => {\n  const l: [Token, number][] = [];\n  let i = -1;\n  let omit = 0;\n  let signal = \"\";\n  const addSignal = () => {\n    if (signal.length !== 0) {\n      l.push([new VarId(signal), i - signal.length]);\n      signal = \"\";\n    }\n  };\n  const add = (v: Token) => {\n    addSignal();\n    l.push([v, i]);\n  };\n\n  for (const c of t) {\n    i++;\n    if (omit !== 0) {\n      omit--;\n      continue;\n    }\n    switch (c) {\n      case \" \":\n        addSignal();\n        break;\n      case \")\":\n      case \"(\":\n      case \"<\":\n      case \">\":\n        add(c);\n        break;\n      case \"=\":\n        const prev = l[l.length - 1][0];\n        const strPrev = prev instanceof VarId ? prev.text : prev;\n        if ([\"<\", \">\"].includes(strPrev)) {\n          l[l.length - 1][0] = (prev + \"=\") as any;\n        } else {\n          add(c);\n        }\n        break;\n      case \"A\":\n        if (t.substring(i, i + 3) === \"AND\") {\n          omit = 2;\n          add(\"AND\");\n          continue;\n        }\n      // ignore: no-fallthrough\n      case \"O\":\n        if (t.substring(i, i + 2) === \"OR\") {\n          omit = 1;\n          add(\"OR\");\n          continue;\n        }\n      // ignore: no-fallthrough\n      case \"N\":\n        if (t.substring(i, i + 3) === \"NOT\") {\n          omit = 2;\n          add(\"NOT\");\n          continue;\n        }\n      // ignore: no-fallthrough\n      default:\n        signal += c;\n        break;\n    }\n  }\n  if (signal.length !== 0) {\n    l.push([new VarId(signal), i - signal.length + 1]);\n  }\n  return l;\n};\n","import {\n  EnclosingStep,\n  MacroStep,\n  SimpleStep,\n  InitialStep,\n  GemmaGraphcet,\n  StepType,\n  Transition,\n} from \"./gemma\";\n\nclass H {\n  static textOrEmpty = (cond: boolean, text: string) => (cond ? text : \"\");\n}\n\nconst templateTransitions = (\n  transitions: Transition[],\n  { isNested }: { isNested: boolean }\n) => {\n  return `\\\n${transitions\n  .map((t, index) => {\n    return `\n${index === 0 ? \"IF\" : \"ELSIF\"} ${t.condition.expression} THEN\n  State:=${t.to.id};\\\n  ${isNested ? \"\\n  Entry:=TRUE;\" : \"\"}`;\n  })\n  .join(\"\\n\")}\\\n${transitions.length === 0 ? \"\" : \"\\nEND_IF\"}`;\n};\n\nconst templateGemmaGraphcetSimpleStep = (\n  model: SimpleStep | InitialStep\n): string => {\n  return templateTransitions(model.transitions, { isNested: false });\n};\n\nconst templateFBEntry = (model: MacroStep | EnclosingStep): string => `\\\nIF Entry THEN\n  ${model.name}(Initialization:=ENTRY);\n  Entry:=FALSE;\nEND_IF\n${model.name}(Initialization:=ENTRY);`;\n\nconst templateGemmaGraphcetMacroStep = (model: MacroStep): string => {\n  const transitions = model.transitions;\n  return `\n${templateFBEntry(model)}\n\n${transitions\n  .map((t, index) => {\n    return `\\\n${index === 0 ? \"IF\" : \"ELSIF\"} ${t.condition.expression}${\n      transitions.length - model.innerTransitionsLength <= index\n        ? ` AND ${model.name}.Complete`\n        : \"\"\n    } THEN\n  State:=${t.to.id};\n  Entry:=TRUE;`;\n  })\n  .join(\"\\n\")}\\\n${H.textOrEmpty(transitions.length !== 0, \"\\nEND_IF\")}`;\n};\n\nconst templateGemmaGraphcetEnclosingStep = (model: EnclosingStep): string => {\n  return `\\\n${templateFBEntry(model)}\n\n${templateTransitions(model.transitions, { isNested: true })}`;\n};\n\nexport const templateGemmaGraphcet = (model: GemmaGraphcet): string => {\n  return `\n// Variable declaration\nVAR\n${model.steps\n  .filter((s) => s.type === StepType.ENCLOSING || s.type === StepType.MACRO)\n  .map((s) => `  ${s.name}:${s.name}_FB;`)\n  .join(\"\\n\")}\n\n  State:UINT:=${model.initialStep?.id};\n  Entry:BOOL:=TRUE;\nEND_VAR\n\n// Program behavior\nCASE State OF\n  ${model.steps\n    .map((step) => {\n      return `\n  ${step.id}: //State ${step.name}\n    ${(() => {\n      switch (step.type) {\n        case StepType.ENCLOSING:\n          return templateGemmaGraphcetEnclosingStep(step);\n        case StepType.INITIAL:\n        case StepType.SIMPLE:\n          return templateGemmaGraphcetSimpleStep(step);\n        case StepType.MACRO:\n          return templateGemmaGraphcetMacroStep(step);\n      }\n    })().replace(/\\n/g, \"\\n    \")}\n  `;\n    })\n    .join(\"\\n\")}\nEND_CASE\n`;\n};\n","import Button from \"@material-ui/core/Button\";\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Select from \"@material-ui/core/Select\";\nimport { observer } from \"mobx-react-lite\";\nimport { IAnyType, IMSTMap, types } from \"mobx-state-tree\";\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { FieldSpec, PP2 } from \"./\";\n\nconst ButtonsDiv = styled.div`\n  min-height: 38px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n`;\n\nexport class ChoiceFieldSpec<\n  V,\n  K extends C extends IMSTMap<M> ? string : string & keyof C,\n  C extends { [key: string]: V } | IMSTMap<M>,\n  M extends IAnyType,\n  MM extends { [key: string]: FieldSpec }\n> {\n  choices: C;\n  default: K;\n\n  constructor(v: { choices: C; default: K }) {\n    this.choices = v.choices;\n    this.default = v.default;\n    if (this.isObservableMap()) {\n      if ((this.choices as any).get(this.default) === null) {\n        throw Error(\"\");\n      }\n    }\n  }\n\n  isObservableMap = () => {\n    return (\n      typeof this.choices.keys === \"function\" &&\n      typeof this.choices.size === \"number\" &&\n      Symbol.toStringTag in this.choices\n    );\n  };\n\n  mobxProp = () =>\n    this.default !== undefined\n      ? types.optional(types.string, this.default)\n      : types.string;\n\n  plotField: React.FC<PP2<MM, string>> = observer(({ name, model }) => {\n    let keys;\n    if (this.isObservableMap()) {\n      keys = Array.from(\n        (this.choices as any).keys() as IterableIterator<string>\n      );\n    } else {\n      keys = Object.keys(this.choices);\n    }\n    return (\n      <ChoiceField\n        value={model[name]}\n        setValue={(v) => (model[name] = v as any)}\n        keys={keys}\n      />\n    );\n  });\n}\n\nexport const ChoiceField = ({\n  keys,\n  value,\n  setValue,\n}: {\n  keys: string[];\n  value: string;\n  setValue: (v: string) => void;\n}) => {\n  if (keys.length > 3) {\n    return (\n      <Select\n        value={value}\n        onChange={(e) => {\n          setValue(e.target.value as any);\n        }}\n        autoWidth={true}\n      >\n        {keys.map((k) => {\n          return (\n            <MenuItem key={k} value={k}>\n              {k}\n            </MenuItem>\n          );\n        })}\n      </Select>\n    );\n  } else {\n    return (\n      <ButtonsDiv>\n        <ButtonGroup\n          size=\"small\"\n          color=\"primary\"\n          aria-label=\"outlined primary button group\"\n        >\n          {keys.map((k) => {\n            const buttonStyle =\n              k === value ? { background: \"#3f51b5\", color: \"white\" } : {};\n\n            return (\n              <Button\n                key={k}\n                onClick={() => {\n                  setValue(k);\n                }}\n                style={buttonStyle}\n              >\n                {k}\n              </Button>\n            );\n          })}\n        </ButtonGroup>\n      </ButtonsDiv>\n    );\n  }\n};\n","import { templateGemmaGraphcet } from \"./gemma-templates\";\nimport { NodeData, NodeModel, ConnModel } from \"../node/node-model\";\nimport { GlobalData, RootStoreModel, DataBuilder } from \"../canvas/store\";\nimport { computed, observable } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { FieldSpec, StrFieldSpec, ChoiceFieldSpec } from \"../fields\";\nimport { listToMap } from \"../utils\";\nimport { PropertiesTable } from \"../properties/properties-table\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\nimport { ChoiceField } from \"../fields/choice-field\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport IconButton from \"@material-ui/core/IconButton\";\n\nenum StepType {\n  ENCLOSING = \"ENCLOSING\",\n  INITIAL = \"INITIAL\",\n  MACRO = \"MACRO\",\n  SIMPLE = \"SIMPLE\",\n}\n\nenum SignalType {\n  bool = \"bool\",\n  num = \"num\",\n}\n\nclass GemmaGraphcet implements GlobalData<Step> {\n  constructor(private graph: RootStoreModel<Step, GemmaGraphcet, Transition>) {}\n\n  canAddNode(nodeType: string): boolean {\n    if (nodeType === StepType.INITIAL) {\n      return !this._hasInitialStep();\n    }\n    return true;\n  }\n\n  private _hasInitialStep(): boolean {\n    return [...this.graph.nodes.values()].some(\n      (n) => n.data.type === StepType.INITIAL\n    );\n  }\n\n  workingFamilyTransitions: Transition[] = [];\n\n  @computed\n  get steps(): Step[] {\n    return [...this.graph.nodes.values()].map((node) => node.data);\n  }\n\n  signals = observable.array<Signal>();\n\n  @computed\n  get initialStep(): Step | undefined {\n    return this.steps.find((s) => s.type === StepType.INITIAL);\n  }\n\n  generateCode = (): string => {\n    return templateGemmaGraphcet(this);\n  };\n\n  View = observer(() => {\n    return (\n      <div style={{ padding: \"5px\" }}>\n        <h2>Signals</h2>\n        {this.signals.map((s, index) => (\n          <div className=\"row\">\n            <TextField\n              type=\"text\"\n              label=\"name\"\n              value={s.name}\n              onChange={(e) => (s.name = e.target.value)}\n              style={{ width: \"150px\" }}\n            ></TextField>\n            <ChoiceField\n              keys={Object.keys(SignalType)}\n              setValue={(v) => (s.type = v as any)}\n              value={s.type}\n            />\n            <IconButton onClick={(e) => this.signals.remove(s)}>\n              <FontAwesomeIcon icon={\"trash-alt\"} color={\"#000\"} />\n            </IconButton>\n          </div>\n        ))}\n        <Button onClick={(e) => this.signals.push(new Signal({ name: \"\" }))}>\n          Add Signal\n        </Button>\n      </div>\n    );\n  });\n}\n\nclass Signal {\n  @observable\n  name: string;\n  @observable\n  type: SignalType;\n\n  description?: string;\n\n  constructor(d: { name: string; description?: string }) {\n    this.name = d.name;\n    this.description = d.description;\n    this.type = SignalType.bool;\n  }\n}\n\nexport type Step = SimpleStep | EnclosingStep | MacroStep | InitialStep;\n\ntype GemmaNode = NodeModel<Step, GemmaGraphcet, Transition>;\ntype GemmaConn = ConnModel<Step, GemmaGraphcet, Transition>;\n\nenum ProcedureType {\n  F = \"F\", // Operational\n  D = \"D\", // Failure\n  A = \"A\", // Stop\n}\n\nabstract class BaseStep implements NodeData<Step, GemmaGraphcet, Transition> {\n  nInputs = Number.POSITIVE_INFINITY;\n  errors = observable.map<string, string>();\n\n  constructor(\n    private node: GemmaNode,\n    d?: {\n      description?: string;\n      family: ProcedureType;\n    }\n  ) {\n    this.description = d?.description ?? \"\";\n    this.family = d?.family ?? ProcedureType.F;\n  }\n\n  @computed\n  get name(): string {\n    return this.node.name;\n  }\n  @observable\n  description: string;\n  @observable\n  family: ProcedureType;\n\n  get automationSystem(): GemmaGraphcet {\n    return this.node.graph.globalData;\n  }\n\n  @computed\n  private get _transitions(): Transition[] {\n    return this.node.outputs.map((t) => t.data);\n  }\n  @computed\n  get innerTransitionsLength(): number {\n    return this._transitions.length;\n  }\n  @computed\n  get transitions(): Transition[] {\n    return this.family === ProcedureType.F\n      ? this.automationSystem.workingFamilyTransitions.concat(this._transitions)\n      : this._transitions;\n  }\n  @computed\n  get id(): number {\n    return this.automationSystem.steps.indexOf(this as any) + 1;\n  }\n\n  spec = {\n    family: new ChoiceFieldSpec({\n      default: ProcedureType.F,\n      choices: listToMap(Object.values(ProcedureType)),\n    }),\n    description: new StrFieldSpec({ default: \"\" }),\n  };\n\n  isValidInput(n: GemmaNode): boolean {\n    return this.node.inputNodes.every((t) => t.data !== n.data);\n  }\n}\n\nclass SimpleStep extends BaseStep {\n  type = StepType.SIMPLE;\n}\n\nclass InitialStep extends BaseStep {\n  type = StepType.INITIAL;\n}\n\nclass EnclosingStep extends BaseStep {\n  type = StepType.ENCLOSING;\n}\n\nclass MacroStep extends BaseStep {\n  type = StepType.MACRO;\n}\n\nclass Transition {\n  name: string;\n  // condition: Condition;\n  @computed\n  get condition(): Condition {\n    return new Condition(this.conditionExpression);\n  }\n  @observable\n  conditionExpression: string;\n  errors = observable.map<string, string>();\n\n  spec: { [key: string]: FieldSpec } = {\n    conditionExpression: new StrFieldSpec({ default: \"\" }),\n  };\n\n  constructor(\n    private connection: GemmaConn,\n    d?: {\n      name: string;\n      condition: Condition;\n    }\n  ) {\n    this.name = d?.name ?? \"\";\n    // this.condition = d?.condition ?? new Condition(\"\");\n    this.conditionExpression =\n      d?.condition.expression ?? this.spec[\"conditionExpression\"].default;\n    console.log(this.conditionExpression);\n  }\n\n  get from(): Step {\n    return this.connection.from.data;\n  }\n\n  get to(): Step {\n    return this.connection.to.data;\n  }\n\n  @computed\n  get connectionText(): string {\n    return this.conditionExpression;\n  }\n\n  ConnectionView = observer(() => {\n    return (\n      <PropertiesTable>\n        {Object.entries(this.spec).map(([k, v]) => (\n          <tr key={k}>\n            <td>{k}</td>\n            <td>{<v.plotField name={k} model={this as any} />}</td>\n          </tr>\n        ))}\n      </PropertiesTable>\n    );\n  });\n}\n\nclass Condition {\n  constructor(public expression: string) {}\n}\n\nconst gemmaBuilders: DataBuilder<Step, GemmaGraphcet, Transition> = {\n  graphBuilder: (g) => new GemmaGraphcet(g),\n  nodeBuilder: {\n    [StepType.SIMPLE]: (n) => new SimpleStep(n),\n    [StepType.MACRO]: (n) => new MacroStep(n),\n    [StepType.ENCLOSING]: (n) => new EnclosingStep(n),\n    [StepType.INITIAL]: (n) => new InitialStep(n),\n  },\n  connectionBuilder: (c) => new Transition(c),\n};\n\nexport {\n  Condition,\n  Transition,\n  MacroStep,\n  EnclosingStep,\n  Signal,\n  SimpleStep,\n  GemmaGraphcet,\n  InitialStep,\n  ProcedureType,\n  StepType,\n  BaseStep,\n  gemmaBuilders,\n};\n","import Switch from \"@material-ui/core/Switch\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { observer } from \"mobx-react-lite\";\nimport { types } from \"mobx-state-tree\";\nimport React from \"react\";\nimport { FieldSpec, FieldSpecI, PP2 } from \"./\";\n\nexport class StrFieldSpec<M extends { [key: string]: FieldSpec }>\n  implements FieldSpecI<M, string> {\n  default: string;\n  maxLength?: number;\n  minLength?: number;\n\n  constructor(v: { default: string; maxLength?: number; minLength?: number }) {\n    this.default = v.default;\n    this.maxLength = v.maxLength;\n    this.minLength = v.minLength;\n\n    if (typeof this.default === \"string\") {\n      if (\n        this.minLength !== undefined &&\n        this.default.length < this.minLength\n      ) {\n        throw Error(\"\");\n      } else if (\n        this.maxLength !== undefined &&\n        this.default.length > this.maxLength\n      ) {\n        throw Error(\"\");\n      }\n    }\n  }\n\n  mobxProp = () => {\n    if (this.default !== undefined) {\n      return types.optional(types.string, this.default);\n    } else {\n      return types.string;\n    }\n  };\n\n  plotField = observer(({ name, model }: PP2<M, string>) => {\n    const [value, setValue] = React.useState(model[name]);\n    const errors = model.errors;\n    return (\n      <TextField\n        key={name}\n        value={value}\n        inputProps={{ style: { textAlign: \"center\" } }}\n        onChange={(e) => {\n          let value = e.target.value;\n          setValue(value as any);\n\n          if (this.maxLength !== undefined && value.length > this.maxLength) {\n            errors.set(name, \"Max length exceded.\");\n          } else if (\n            this.minLength !== undefined &&\n            value.length < this.minLength\n          ) {\n            errors.set(name, \"Min length exceded.\");\n          } else {\n            errors.delete(name);\n            model[name] = value as any;\n          }\n        }}\n        error={errors.get(name) !== undefined}\n        fullWidth={true}\n        style={{ width: \"140px\" }}\n      />\n    );\n  });\n}\n\nexport class BoolFieldSpec<M extends { [key: string]: FieldSpec }>\n  implements FieldSpecI<M, boolean> {\n  default: boolean;\n  required?: boolean;\n\n  constructor(v: { default: boolean; required?: boolean }) {\n    this.default = v.default;\n    this.required = v.required !== undefined ? v.required : true;\n  }\n\n  mobxProp = () => {\n    if (this[\"default\"] === undefined) {\n      return types.boolean;\n    } else {\n      return types.optional(types.boolean, this.default);\n    }\n  };\n\n  plotField = observer(({ name, model }: PP2<M, boolean>) => {\n    return (\n      <Switch\n        checked={model[name]}\n        onChange={() => {\n          model[name] = !model[name] as any;\n        }}\n        color=\"primary\"\n      />\n    );\n  });\n}\n\nexport class NumFieldSpec<M extends { [key: string]: FieldSpec }>\n  implements FieldSpecI<M, number> {\n  default: number;\n  min?: number;\n  max?: number;\n  step?: number;\n  isInt: boolean;\n\n  constructor(v: {\n    default: number;\n    min?: number;\n    max?: number;\n    step?: number;\n    isInt?: boolean;\n  }) {\n    this.default = v.default;\n    this.min = v.min;\n    this.max = v.max;\n    this.step = v.step;\n    this.isInt = v.isInt !== undefined ? v.isInt : false;\n    if (this.min !== undefined && this.default < this.min) {\n      throw Error(\"\");\n    } else if (this.max !== undefined && this.default > this.max) {\n      throw Error(\"\");\n    }\n    if (this.isInt) {\n      this.default = Math.round(this.default);\n      if (this.step === undefined) {\n        this.step = 1;\n      } else {\n        this.step = Math.round(this.step);\n      }\n    }\n  }\n\n  mobxProp = () =>\n    this.default !== undefined\n      ? types.optional(types.number, this.default)\n      : types.number;\n\n  plotField = observer(({ name, model }: PP2<M, number>) => {\n    const [value, setValue] = React.useState(\n      ((model[name] as any) as number).toString()\n    );\n    const errors = model.errors;\n    const error = errors.get(name);\n\n    return (\n      <TextField\n        key={name}\n        value={value}\n        inputProps={{\n          min: this.min,\n          max: this.max,\n          step: this.step,\n          style: { textAlign: \"center\" },\n        }}\n        type=\"number\"\n        error={error !== undefined}\n        fullWidth={true}\n        style={{ width: \"80px\" }}\n        onChange={(e) => {\n          let value = e.target.value;\n          if (this.min !== undefined && this.min >= 0) {\n            value = value.replace(/-/g, \"\");\n          }\n          if (this.isInt) {\n            value = value.replace(/\\./g, \"\");\n          }\n          setValue(value);\n\n          let num: number;\n          if (this.isInt) {\n            num = parseInt(value, 10);\n          } else {\n            num = parseFloat(value);\n          }\n\n          if (Number.isNaN(num)) {\n            errors.set(name, \"Invalid\");\n          } else if (this.min !== undefined && this.min > num) {\n            errors.set(name, `Smaller than minimum ${this.min}`);\n          } else if (this.max !== undefined && this.max < num) {\n            errors.set(name, `Greater than maximum ${this.max}`);\n          } else {\n            errors.delete(name);\n            model[name] = num as any;\n          }\n        }}\n      />\n    );\n  });\n}\n","import React from \"react\";\nimport { MainCanvas } from \"./canvas/canvas\";\nimport { ConfigView } from \"./canvas/config-view\";\nimport { RootStoreModel, GlobalData, ConnectionData } from \"./canvas/store\";\nimport { MainMenu } from \"./graph-menu/main-menu\";\nimport { NodeData, ConnModel } from \"./node/node-model\";\nimport { PropertiesView } from \"./properties/properties-view\";\nimport {\n  GemmaGraphcet,\n  ProcedureType,\n  Transition,\n  Step,\n  Condition,\n  gemmaBuilders,\n  StepType,\n} from \"./step/gemma\";\n\nconst rootStore = new RootStoreModel<Step, GemmaGraphcet, Transition>({\n  builders: gemmaBuilders,\n});\n\nconst s1 = rootStore.addNode(StepType.INITIAL, { x: 72, y: 60 });\nconst s2 = rootStore.addNode(StepType.MACRO, { x: 261, y: 170 });\n\nconst _t = new ConnModel(\n  s1!,\n  s2!,\n  (c) =>\n    new Transition(c, {\n      name: \"Emergency\",\n      condition: new Condition(\"I1 & I2\"),\n    })\n);\nrootStore.globalData.workingFamilyTransitions.push(_t.data);\n\n[\n  s1,\n  s2,\n  rootStore.addNode(StepType.ENCLOSING, { x: 441, y: 316 }),\n  rootStore.addNode(StepType.SIMPLE, { x: 211, y: 410 }),\n  rootStore.addNode(StepType.SIMPLE, { x: 441, y: 500 }),\n].forEach((s, index) => s?.setName(`S${index + 1}`));\n\ns1!.data.family = ProcedureType.A;\ns2!.data.family = ProcedureType.D;\n\nexport const storeContext = React.createContext<RootStoreModel<\n  any,\n  any,\n  any\n> | null>(null);\n\nexport function useStore<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<D>\n>() {\n  const store = React.useContext<RootStoreModel<D, G, C> | null>(storeContext);\n  if (!store) {\n    throw Error(\"useStore should be used inside a Store provider.\");\n  }\n  return store;\n}\n\nexport function App() {\n  return (\n    <storeContext.Provider value={rootStore}>\n      <div\n        className=\"row\"\n        style={{ background: \"rgba(250,250,250,0.7)\", height: \"100%\" }}\n      >\n        <div className=\"col\">\n          <MainMenu items={Object.keys(rootStore.builders.nodeBuilder)} />\n          <rootStore.globalData.View></rootStore.globalData.View>\n        </div>\n        <div\n          className=\"col\"\n          style={{\n            width: \"0px\",\n            background: \"rgba(250,250,250,0.7)\",\n            flex: \"1 0 auto\",\n          }}\n        >\n          <div className=\"row\" style={{ minHeight: 0, flex: 1 }}>\n            <MainCanvas />\n            <ConfigView />\n          </div>\n          <PropertiesView />\n        </div>\n      </div>\n    </storeContext.Provider>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker === null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import { library } from \"@fortawesome/fontawesome-svg-core\";\nimport { faChevronDown, faChevronUp, faTrashAlt } from \"@fortawesome/free-solid-svg-icons\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { App } from \"./App\";\nimport \"./index.css\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nlibrary.add(faChevronDown, faChevronUp, faTrashAlt);\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}