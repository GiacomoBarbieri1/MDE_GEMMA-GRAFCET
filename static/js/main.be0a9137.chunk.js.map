{"version":3,"sources":["canvas/arrow.tsx","canvas/canvas.tsx","utils.ts","canvas/config-view.tsx","canvas/persistence.ts","node/node-model.tsx","canvas/store.tsx","properties/properties-table.tsx","properties/properties-view.tsx","step/custom_parser.ts","fields/choice-field.tsx","step/step.tsx","fields/primitive-field.tsx","step/gemma-templates.ts","grammar/SimpleBooleanLexer.ts","grammar/SimpleBooleanParser.ts","step/antlr_parser.ts","step/transition.tsx","codegen/file-system.ts","step/macro-step.ts","node/node.tsx","step/gemma.tsx","step/enclosing-step.ts","App.tsx","serviceWorker.ts","index.tsx"],"names":["triangleFromCenter","x","y","height","width","y0","ArrowView","observer","changeX","changeY","connection","rootStore","useStore","from","to","isSelected","connectionStartPosition","data","undefined","b","top","bottom","left","right","getStartPositionConnection","x1","y1","x2","y2","dy","dx","m","Math","abs","deltaX","xa","ya","xm","ym","degrees","atan2","PI","style","strokeWidth","stroke","opacity","isHidden","d","onClick","_","selectConnection","RectAndText","text","connectionText","rectFill","transform","padding","React","useState","textRef","setTextRef","prev","setPrev","bbox","getBBox","useEffect","id","setTimeout","clearTimeout","fill","cursor","ref","MainCanvas","ops","nodes","values","overflow","flex","position","border","background","margin","borderRadius","globalData","CanvasView","flatMap","op","inputs","map","key","defaultResizeEnable","topRight","bottomRight","bottomLeft","topLeft","resizableEnable","f","Object","entries","reduce","p","k","v","downloadToClient","content","fileName","contentType","a","document","createElement","file","Blob","type","href","URL","createObjectURL","download","click","importJson","event","files","target","Promise","resolve","window","alert","reader","FileReader","onload","e","result","onabort","onerror","readAsText","DBStores","ConfigView","connections","c","forEach","get","set","push","Map","orderedOps","counts","filter","withDependencies","length","numProcessed","size","slice","outs","dep","delete","minWidth","defaultSize","boxShadow","enable","className","borderBottom","Button","downloadSourceCode","generateMainFile","openDB","upgrade","db","createObjectStore","graph","keyPath","autoIncrement","node","createIndex","IndexedDB","getKeyFromConnection","path","connectionWithKey","graphKey","assign","this","getAll","value","put","tx","transaction","objectStore","dbKey","index","openCursor","continue","done","all","getAllFromIndex","_g","n","store","add","updateMany","close","clear","keys","items","val","Error","item","ConnModel","dataBuilder","json","selectedConnection","toJson","observable","computed","NodeModel","resizeObserver","element","setElement","setSize","getBoundingClientRect","disconnect","ResizeObserver","observe","name","conn","outputs","array","action","rect","RootStoreModel","builders","hideOnDelete","saveModel","clearDB","updateGraph","addNodes","addConnections","t","downloadModel","JSON","stringify","_addToZip","root","dir","newRoot","folder","when","zip","JSZip","sourceCode","generateSourceCode","generateAsync","graphBuilder","v4","nodeBuilder","addConnection","selectedNode","next","_n","initState","nodeType","pos","canAddNode","_in","remove","_out","selectingInputFor","addEventListener","_selectingInputKeyListener","connectionBuilder","addOutput","removeEventListener","ev","PropertiesTable","children","PropertiesTableStyled","PropertiesTableNode","self","spec","plotField","model","nInputs","variant","styled","table","PropertiesView","inner","maxHeight","maxWidth","justifyContent","backgroundColor","display","alignItems","IconButton","activateNode","removeNode","icon","color","activateConnection","removeConnection","ConnectionView","View","minHeight","VarId","StepType","ProcedureType","ButtonsDiv","div","ChoiceFieldSpec","choices","default","onChange","isObservableMap","Symbol","toStringTag","mobxProp","types","optional","string","Array","setValue","ChoiceField","maxButton","Select","autoWidth","marginBottom","disabled","MenuItem","ButtonGroup","aria-label","buttonStyle","StrFieldSpec","maxLength","minLength","multiline","errors","TextField","fullWidth","inputProps","textAlign","error","BoolFieldSpec","required","boolean","Switch","checked","BaseStep","l","Number","POSITIVE_INFINITY","CONTAINER","isInitial","SIMPLE","toString","_color","A","D","F","family","innerStyle","wrapper","nodeHeight","ENCLOSING","MACRO","borderTop","borderRight","borderLeft","description","reaction","console","log","otherInitial","automationSystem","steps","find","s","inputNodes","every","aFamily","dFamily","fFamily","sort","priority","_transitions","transitions","concat","indexOf","EnclosingDecoration","H","textOrEmpty","cond","templateCondition","expressionTokens","tok","join","templateGemmaGrafcetSimpleStep","isNested","templateTransitions","templateGemmaGrafcetNestedStep","templateFBEntry","_isInner","innerTransitionsLength","isNegated","_evaluateComplete","templateGemmaGrafcet","initialStep","step","replace","SimpleBooleanLexer","input","_interp","LexerATNSimulator","_ATN","VOCABULARY","ruleNames","_serializedATN","channelNames","modeNames","__ATN","ATNDeserializer","deserialize","Utils","Lexer","AND","OR","NOT","TRUE","FALSE","GT","GE","LT","LE","EQ","LPAREN","RPAREN","DECIMAL","IDENTIFIER","WS","_LITERAL_NAMES","_SYMBOLIC_NAMES","VocabularyImpl","SimpleBooleanParser","ParserATNSimulator","_localctx","ParseContext","_ctx","state","enterRule","RULE_parse","enterOuterAlt","expression","match","EOF","re","RecognitionException","exception","_errHandler","reportError","recover","exitRule","ExpressionContext","RULE_expression","sync","interpreter","adaptivePredict","_input","NotExpressionContext","OrExpressionContext","_left","expressionAnd","_right","AndParentExpressionContext","ExpressionAndContext","RULE_expressionAnd","AndExpressionContext","expressionSimple","SimpleExpressionContext","ExpressionSimpleContext","RULE_expressionSimple","ComparatorExpressionContext","numExpression","_op","comparator","IdentifierExpressionContext","ParenExpressionContext","NumExpressionContext","RULE_numExpression","LA","IdentifierNumExpressionContext","DecimalExpressionContext","NoViableAltException","_la","ComparatorContext","RULE_comparator","recoverInline","Token","matchedEOF","reportMatch","consume","Parser","parent","invokingState","getRuleContext","getToken","listener","enterParse","exitParse","visitor","visitParse","visitChildren","ParserRuleContext","ctx","copyFrom","enterNotExpression","exitNotExpression","visitNotExpression","enterOrExpression","exitOrExpression","visitOrExpression","enterAndParentExpression","exitAndParentExpression","visitAndParentExpression","enterAndExpression","exitAndExpression","visitAndExpression","enterSimpleExpression","exitSimpleExpression","visitSimpleExpression","i","getRuleContexts","enterComparatorExpression","exitComparatorExpression","visitComparatorExpression","enterIdentifierExpression","exitIdentifierExpression","visitIdentifierExpression","enterParenExpression","exitParenExpression","visitParenExpression","enterIdentifierNumExpression","exitIdentifierNumExpression","visitIdentifierNumExpression","enterDecimalExpression","exitDecimalExpression","visitDecimalExpression","tryGetToken","enterComparator","exitComparator","visitComparator","ErrorVisitor","signals","isInvalid","aggregate","nextResult","boolSignals","includes","numSignals","AbstractParseTreeVisitor","Transition","bound","conditionExpression","priorityChoices","setPriority","ConditionInput","expressionErrors","marginTop","err","substring","negation","omit","signal","addSignal","prevToken","strPrev","getCustomTokens","gemma","inputStream","CharStreams","fromString","lexer","tokenStream","CommonTokenStream","tree","parse","countFunctionsVisitor","visit","toProcess","curr","pop","childCount","getChild","parseBoolExpression","parseInt","prevIndex","_spanStyleRef","useRef","font","whiteSpace","textIndex","repeat","onScroll","current","scrollTo","currentTarget","scrollTop","caretColor","spellCheck","SourceItem","SourceFile","SourceDirectory","macroStepTemplate","SignalTypeBase","SignalType","SignalTypeSize","StyledNode","NodeView","params","onDrag","useCallback","move","deltaY","selectingInput","isValidInput","assignInput","selectNode","bounds","signalSizeMap","bool","int","uint","real","GemmaGrafcet","showDelete","setShowDelete","flexDirection","paddingLeft","Table","stickyHeader","TableHead","TableRow","TableCell","TableBody","SignalRow","removeSignal","findIndex","s2","alignSelf","Signal","w","h","_d","isArray","fromJson","addNode","setName","some","main","globals","defaultValue","trim","Tooltip","title","setTypeBase","typeBase","typeSize","didBlur","regexSignalDefaultValid","test","onBlur","align","typePrim","base","lreal","startsWith","charAt","signalTypeToPrimitives","sizeStr","gemmaBuilders","g","makeBaseGemmaTemplate","nodesRaw","A1","A2","A3","A4","A5","A6","A7","D1","D2","D3","F1","F2","F3","F4","F5","F6","nn","a1","storeContext","createContext","useContext","App","globalDB","setDB","setStore","_isReset","resetStore","createIndexedDB","then","fetchGraphs","graphs","loadGraph","graphExt","_store","Provider","TopMenu","isResetDialogOpen","setIsResetDialogOpen","toggleDialog","Dialog","open","onClose","keepMounted","aria-labelledby","aria-describedby","DialogTitle","DialogContent","DialogContentText","DialogActions","htmlFor","accept","Boolean","location","hostname","library","faChevronDown","faChevronUp","faTrashAlt","faEye","faEyeSlash","ReactDOM","render","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","message"],"mappings":"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","file":"static/js/main.be0a9137.chunk.js","sourcesContent":["import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { NodeModel, ConnModel, NodeData } from \"../node/node-model\";\nimport { useStore } from \"../App\";\n\nexport type ArrowModel = {\n  from: NodeModel<any, any, any>;\n  to: NodeModel<any, any, any>;\n};\n\ntype ArrowViewProps = { connection: ConnModel<any, any, any> };\n\nconst triangleFromCenter = (\n  x: number,\n  y: number,\n  height: number = 14,\n  width: number = 14\n) => {\n  const y0 = y + height;\n  return `M${x} ${y} L${x - width / 2} ${y0} L${x + width / 2} ${y0} Z`;\n};\nconst getStartPositionConnection = (\n  from: NodeModel<any, any, any>\n): { x: number; y: number } => {\n  const connectionStartPosition = (from.data as NodeData<any, any, any>)\n    .connectionStartPosition;\n\n  if (connectionStartPosition !== undefined) {\n    const b = connectionStartPosition();\n    if (b !== undefined) {\n      let x = from.x;\n      let y = from.y;\n      if (\"top\" in b) {\n        y += b.top;\n      } else {\n        y += from.height - b.bottom;\n      }\n\n      if (\"left\" in b) {\n        x += b.left;\n      } else {\n        y += from.width - b.right;\n      }\n      return { x, y };\n    }\n  }\n  return { x: from.x + from.width / 2, y: from.y + from.height / 2 };\n};\n\nexport const ArrowView: React.FC<ArrowViewProps> = observer(\n  ({ connection }: ArrowViewProps) => {\n    const rootStore = useStore();\n    const { from, to, isSelected } = connection;\n    const { x: x1, y: y1 } = getStartPositionConnection(from);\n\n    const [x2, y2] = [to.x + to.width / 2, to.y + to.height / 2];\n    const dy = y2 - y1;\n    const dx = x2 - x1;\n\n    let changeX;\n    let changeY;\n    if (dx === 0) {\n      changeX = 0;\n      changeY = ((y2 > y1 ? 1 : -1) * to.height) / 2;\n    } else if (dy === 0) {\n      changeY = 0;\n      changeX = ((x2 > x1 ? 1 : -1) * to.width) / 2;\n    } else {\n      const m = Math.abs(dy / dx);\n      const [deltaX, deltaY] =\n        m > to.height / to.width\n          ? [to.height / 2 / m, to.height / 2]\n          : [to.width / 2, (to.width / 2) * m];\n      changeY = (y2 > y1 ? 1 : -1) * deltaY;\n      changeX = (x2 > x1 ? 1 : -1) * deltaX;\n    }\n    const xa = x2 - changeX;\n    const ya = y2 - changeY;\n\n    const [xm, ym] = [(x1 + x2) / 2, (y1 + y2) / 2];\n    const degrees = 90 + (Math.atan2(y2 - y1, x2 - x1) * 180) / Math.PI;\n\n    return (\n      <>\n        <path\n          style={{\n            strokeWidth: 2,\n            stroke: \"black\",\n            opacity: connection.isHidden ? 0.07 : 1,\n          }}\n          d={`M${x1} ${y1} L${x2} ${y2}`}\n          onClick={(_) => {\n            rootStore.selectConnection(connection);\n          }}\n        />\n        {!connection.isHidden && (\n          <>\n            <RectAndText\n              text={connection.data.connectionText}\n              x={xm}\n              rectFill={isSelected ? \"#eeedff\" : \"#eee\"}\n              y={ym}\n              onClick={(_) => rootStore.selectConnection(connection)}\n            />\n            <path\n              d={triangleFromCenter(xa, ya)}\n              transform={`rotate(${degrees} ${xa} ${ya})`}\n            />\n          </>\n        )}\n      </>\n    );\n  }\n);\n\nconst RectAndText: React.FC<{\n  text: string;\n  x: number;\n  y: number;\n  rectFill?: string;\n  padding?: number;\n  onClick: (event: React.MouseEvent<any, MouseEvent>) => void;\n}> = observer(\n  ({ text, x: xm, y: ym, rectFill = \"#eee\", padding = 3, onClick }) => {\n    const [textRef, setTextRef] = React.useState<SVGTextElement | null>(null);\n    const [prev, setPrev] = React.useState(text);\n    const bbox = textRef?.getBBox();\n    React.useEffect(() => {\n      if (prev !== text) {\n        const id = setTimeout(() => setPrev(text), 0);\n        return () => clearTimeout(id);\n      }\n    });\n\n    return (\n      <>\n        {bbox !== undefined && (\n          <rect\n            width={bbox.width + padding * 2}\n            height={bbox.height + padding * 2}\n            x={xm - bbox.width / 2 - padding}\n            y={ym - bbox.height + padding}\n            fill={rectFill}\n            onClick={onClick}\n            style={{ cursor: \"pointer\" }}\n          ></rect>\n        )}\n        <text\n          x={bbox !== undefined ? xm - bbox.width / 2 : xm}\n          y={ym}\n          fill=\"black\"\n          ref={setTextRef}\n          onClick={onClick}\n          style={{ cursor: \"pointer\" }}\n        >\n          {text}\n        </text>\n      </>\n    );\n  }\n);\n\n// const getBoxIntersection = (from: OperationModelT, to: OperationModelT) => {\n//   const fwidth = from.width || 60;\n//   const fheight = from.width || 60;\n//   const twidth = to.width || 60;\n//   const theight = to.width || 60;\n\n//   const [x1, y1, x2, y2] = [\n//     from.x + fwidth / 2,\n//     from.y + fheight / 2,\n//     to.x + twidth / 2,\n//     to.y + theight / 2\n//   ];\n//   const dy = y2 - y1;\n//   const dx = x2 - x1;\n//   if (dx === 0 || dy === 0) {\n//   }\n//   const m = dy / dx;\n\n//   const degrees = 90 + (Math.atan2(dy, dx) * 180) / Math.PI;\n//   let xpos = x2 > x1 ? 1 : -1;\n//   const interY = (y2 - y1) / m;\n//   const interX = x2 * m + y1;\n// };\n","import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport { useStore } from \"../App\";\nimport { ArrowView } from \"./arrow\";\n\ntype Props = {};\n\nexport const MainCanvas: React.FC<Props> = observer(() => {\n  const rootStore = useStore();\n  const ops = [...rootStore.nodes.values()];\n  return (\n    <div style={{ overflow: \"auto\", flex: \"1\" }}>\n      <div\n        style={{\n          position: \"relative\",\n          border: \"1px solid #eee\",\n          background: \"#fff\",\n          margin: \"10px\",\n          borderRadius: \"6px\",\n          flex: 1,\n          height: \"1000px\",\n          width: \"1200px\",\n        }}\n      >\n        <rootStore.globalData.CanvasView/>\n        <svg style={{ width: \"100%\", height: \"100%\", position: \"absolute\" }}>\n          {ops\n            .flatMap((op) => op.inputs)\n            .map((connection) => (\n              <ArrowView\n                connection={connection}\n                key={connection.from.key + connection.to.key}\n              />\n            ))}\n        </svg>\n      </div>\n    </div>\n  );\n});\n","export function listToMap<T extends number | string>(l: Array<T>) {\n  return l.reduce((p, c) => {\n    p[c.toString()] = c;\n    return p;\n  }, {} as { [key: string]: T });\n}\n\nconst defaultResizeEnable = {\n  top: false,\n  right: false,\n  bottom: false,\n  left: false,\n  topRight: false,\n  bottomRight: false,\n  bottomLeft: false,\n  topLeft: false,\n};\n\nexport function resizableEnable(f: {\n  top?: boolean;\n  right?: boolean;\n  bottom?: boolean;\n  left?: boolean;\n  topRight?: boolean;\n  bottomRight?: boolean;\n  bottomLeft?: boolean;\n  topLeft?: boolean;\n}) {\n  return Object.entries(f).reduce(\n    (p, [k, v]) => {\n      if (v !== undefined) {\n        p[k as keyof typeof defaultResizeEnable] = v;\n      }\n      return p;\n    },\n    { ...defaultResizeEnable }\n  );\n}\n\nexport function downloadToClient(\n  content: BlobPart,\n  fileName: string,\n  contentType: string\n) {\n  let a = document.createElement(\"a\");\n  let file = new Blob([content], { type: contentType });\n  a.href = URL.createObjectURL(file);\n  a.download = fileName;\n  a.click();\n}\n\nexport function importJson(\n  event: React.ChangeEvent<HTMLInputElement>\n): Promise<string | ArrayBuffer | null | undefined> {\n  const files = event.target.files;\n  return new Promise((resolve, _) => {\n    if (files !== null) {\n      const file = files[0];\n      if (file.type !== \"application/json\") {\n        window.alert(\n          \"Debes seleccionar un archivo válido, la extensión debe ser '.json'.\"\n        );\n        return resolve(undefined);\n      }\n        const reader = new FileReader();\n        reader.onload = (e) => {\n          resolve(e.target?.result);\n        };\n        reader.onabort = (e) => {\n          resolve(undefined);\n        };\n        reader.onerror = (e) => {\n          resolve(undefined);\n        };\n        reader.readAsText(file);\n    } else {\n      resolve(undefined);\n    }\n  });\n}\n","import Button from \"@material-ui/core/Button\";\nimport { observer } from \"mobx-react-lite\";\nimport { Resizable } from \"re-resizable\";\nimport React from \"react\";\nimport { useStore } from \"../App\";\nimport { NodeModel } from \"../node/node-model\";\nimport { resizableEnable } from \"../utils\";\nimport { GlobalData } from \"./store\";\n\ntype Props = {};\n\nexport const ConfigView: React.FC<Props> = observer(<\n  G extends GlobalData<any>\n>() => {\n  const rootStore = useStore<any, G, any>();\n  const ops = [...rootStore.nodes.values()];\n  const connections = ops.reduce((p, c) => {\n    c.inputs.forEach((v) => {\n      let m = p.get(v.to);\n      if (m === undefined) {\n        m = [];\n        p.set(v.to, m);\n      }\n      m.push(c);\n    });\n    return p;\n  }, new Map<NodeModel<any, any, any>, NodeModel<any, any, any>[]>());\n\n  const orderedOps: NodeModel<any, any, any>[] = [];\n  const counts = new Map(\n    ops\n      .filter((op) => {\n        const withDependencies = op.data.length !== 0;\n        if (!withDependencies) {\n          orderedOps.push(op);\n        }\n        return withDependencies;\n      })\n      .map((op) => [op, op.data.length])\n  );\n  let numProcessed = 0;\n  while (counts.size !== 0 && orderedOps.length !== numProcessed) {\n    for (let k of orderedOps.slice(numProcessed)) {\n      numProcessed += 1;\n      const outs = connections.get(k);\n      if (outs === undefined) continue;\n\n      for (let dep of outs) {\n        const m = counts.get(dep)!;\n        if (m === 1) {\n          counts.delete(dep);\n          orderedOps.push(dep);\n        } else {\n          counts.set(dep, m - 1);\n        }\n      }\n    }\n  }\n\n  if (counts.size !== 0) {\n    // CICLE ?\n  }\n\n  return (\n    <Resizable\n      minWidth={200}\n      defaultSize={{ height: \"auto\", width: 250 }}\n      style={{\n        position: \"relative\",\n        background: \"white\",\n        boxShadow: \"0 1px 4px 1px #eee\",\n        border: \"1px solid #eee\",\n      }}\n      enable={resizableEnable({ left: true })}\n    >\n      <div className=\"col\" style={{ height: \"100%\" }}>\n        <div style={{ borderBottom: \"rgb(221 220 220) solid 1.5px\" }}>\n          <Button\n            onClick={async (_) => {\n              rootStore.downloadSourceCode();\n            }}\n          >\n            Download Code\n          </Button>\n        </div>\n        <div\n          style={{\n            overflow: \"auto\",\n            height: \"100%\",\n            padding: \"0 10px\",\n            flex: 1,\n          }}\n        >\n          <pre>{rootStore.globalData.generateMainFile}</pre>\n        </div>\n      </div>\n    </Resizable>\n  );\n});\n","import { DBSchema, IDBPDatabase, openDB } from \"idb\";\nimport { JsonType } from \"./store\";\n\nconst DB_NAME = \"GemmaGrafcet\";\nenum DBStores {\n  graph = \"graph\",\n  node = \"node\",\n  connection = \"connection\",\n}\n\nexport type GraphJson = {\n  key: string;\n  data: JsonType;\n};\n\nexport type NodeJson = {\n  key: string;\n  name: string;\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n  isHidden: boolean;\n  data: JsonType;\n};\n\ntype _NodeJson = NodeJson & {\n  graphKey: string;\n};\n\nexport type ConnectionJson = {\n  from: string;\n  to: string;\n  isHidden: boolean;\n  data: JsonType;\n};\n\ntype _ConnectionJson = ConnectionJson & {\n  key: string;\n  graphKey: string;\n};\n\ninterface MyDB extends DBSchema {\n  [DBStores.graph]: {\n    key: string;\n    value: GraphJson;\n  };\n  [DBStores.node]: {\n    key: string;\n    value: _NodeJson;\n    indexes: { \"by-graph\": string };\n  };\n  [DBStores.connection]: {\n    key: string;\n    value: _ConnectionJson;\n    indexes: { \"by-graph\": string };\n  };\n}\n\nexport async function createIndexedDB() {\n  const db = await openDB<MyDB>(DB_NAME, 1, {\n    upgrade(db) {\n      db.createObjectStore(DBStores.graph, {\n        keyPath: \"key\",\n        autoIncrement: false,\n      });\n\n      const nodeStore = db.createObjectStore(DBStores.node, {\n        keyPath: \"key\",\n        autoIncrement: false,\n      });\n      nodeStore.createIndex(\"by-graph\", \"graphKey\");\n\n      const connStore = db.createObjectStore(DBStores.connection, {\n        keyPath: \"key\",\n        autoIncrement: false,\n      });\n      connStore.createIndex(\"by-graph\", \"graphKey\");\n    },\n  });\n  return new IndexedDB(db);\n}\n\nexport function sameKeys(path: ConnectionJson, path2: ConnectionJson) {\n  return getKeyFromConnection(path) === getKeyFromConnection(path2);\n}\n\nexport function getKeyFromConnection(path: ConnectionJson) {\n  return `${path.from}_${path.to}`;\n}\n\nexport function connectionWithKey(\n  graphKey: string,\n  path: ConnectionJson\n): _ConnectionJson {\n  return Object.assign(path, { key: getKeyFromConnection(path), graphKey });\n}\n\nexport class IndexedDB {\n  constructor(private db: IDBPDatabase<MyDB>) {}\n\n  //\n  // GRAPHS\n  //\n\n  fetchGraphs() {\n    return this.db.getAll(DBStores.graph);\n  }\n\n  updateGraph(value: GraphJson) {\n    return this.db.put(DBStores.graph, value);\n  }\n\n  async deleteGraph(graphKey: string) {\n    const tx = this.db.transaction(\n      [DBStores.graph, DBStores.node, DBStores.connection],\n      \"readwrite\"\n    );\n    tx.objectStore(DBStores.graph).delete(graphKey);\n    for (const dbKey of [DBStores.node, DBStores.connection] as Array<\n      DBStores.node | DBStores.connection\n    >) {\n      let cursor = await tx\n        .objectStore(dbKey)\n        .index(\"by-graph\")\n        .openCursor(graphKey);\n      while (cursor) {\n        cursor.delete();\n        cursor = await cursor.continue();\n      }\n    }\n    await tx.done;\n  }\n\n  async loadGraph(graphKey: string) {\n    const [nodes, connections] = await Promise.all([\n      this.db.getAllFromIndex(DBStores.node, \"by-graph\", graphKey),\n      this.db.getAllFromIndex(DBStores.connection, \"by-graph\", graphKey),\n    ]);\n\n    return { nodes, connections };\n  }\n\n  //\n  // NODES\n  //\n\n  async addNodes(graphKey: string, nodes: NodeJson[]) {\n    const tx = this.db.transaction(DBStores.node, \"readwrite\");\n\n    const _g = { graphKey };\n    for (const n of nodes) {\n      tx.store.add(Object.assign(n, _g));\n    }\n    return await tx.done;\n  }\n\n  deleteNode(path: NodeJson) {\n    return this.db.delete(DBStores.node, path.key);\n  }\n\n  async updateNode(graphKey: string, path: NodeJson) {\n    return this.db.put(DBStores.node, Object.assign(path, { graphKey }));\n  }\n\n  async updateNodes(graphKey: string, nodes: Array<NodeJson>) {\n    const _g = { graphKey };\n    return this.updateMany(\n      DBStores.node,\n      nodes.map((n) => n.key),\n      nodes.map((p) => Object.assign(p, _g))\n    );\n  }\n\n  //\n  // CONNECTIONS\n  //\n\n  async addConnections(graphKey: string, connections: ConnectionJson[]) {\n    const tx = this.db.transaction(DBStores.connection, \"readwrite\");\n\n    for (const p of connections) {\n      tx.store.add(connectionWithKey(graphKey, p));\n    }\n    return await tx.done;\n  }\n\n  deleteConnection(path: ConnectionJson) {\n    return this.db.delete(DBStores.connection, getKeyFromConnection(path));\n  }\n\n  async updateConnection(graphKey: string, connection: ConnectionJson) {\n    return this.db.put(\n      DBStores.connection,\n      connectionWithKey(graphKey, connection)\n    );\n  }\n\n  async updateConnections(\n    graphKey: string,\n    connections: Array<ConnectionJson>\n  ) {\n    return this.updateMany(\n      DBStores.connection,\n      connections.map(getKeyFromConnection),\n      connections.map((p) => connectionWithKey(graphKey, p))\n    );\n  }\n\n  //\n  // OTHER\n  //\n\n  async closeDB() {\n    this.db.close();\n  }\n\n  async clearDB() {\n    await Promise.all([\n      this.db.clear(DBStores.graph),\n      this.db.clear(DBStores.connection),\n      this.db.clear(DBStores.node),\n    ]);\n  }\n\n  private async updateMany<T>(dbKey: DBStores, keys: string[], items: T[]) {\n    const tx = this.db.transaction(dbKey, \"readwrite\");\n    await Promise.all(\n      items.map(async (path, index) => {\n        const key = keys[index];\n        const val = await tx.store.get(key);\n\n        if (!val) {\n          throw new Error();\n        }\n        return tx.store.put({ ...val, ...path });\n      })\n    );\n    return await tx.done;\n  }\n\n  private async updateIncrementalSingle<T>(\n    dbKey: DBStores,\n    key: string,\n    item: T\n  ) {\n    const tx = this.db.transaction(dbKey, \"readwrite\");\n    const val = await tx.store.get(key);\n\n    if (!val) {\n      throw new Error();\n    }\n    tx.store.put({ ...val, ...item });\n    await tx.done;\n  }\n}\n","import { action, computed, observable, ObservableMap } from \"mobx\";\nimport { SnapshotIn } from \"mobx-state-tree\";\nimport { FieldSpec } from \"../fields\";\nimport { GlobalData, RootStoreModel, JsonType } from \"../canvas/store\";\nimport { ConnectionJson, NodeJson } from \"../canvas/persistence\";\nimport { ResizeObserver } from \"@juggle/resize-observer\";\n\nexport type OperationI<\n  V extends { [key: string]: FieldSpec },\n  D extends NodeData<D, G, any>,\n  G extends GlobalData<D>\n> = {\n  [key in keyof V]: SnapshotIn<ReturnType<V[key][\"mobxProp\"]>>;\n} & {\n  NAME: string;\n  spec: V;\n  nInputs: number;\n  errors: ObservableMap<keyof V, string>;\n};\n\nexport const mobxDecorators = <V extends { [key: string]: FieldSpec }>(\n  spec: V\n) => {\n  return {\n    ...Object.keys(spec).reduce((p, c) => {\n      p[c as keyof V] = observable;\n      return p;\n    }, {} as { [key in keyof V]: PropertyDecorator }),\n    errors: observable,\n  };\n};\n\nexport type ConnectionPosition =\n  | { top: number; left: number }\n  | { top: number; right: number }\n  | { bottom: number; left: number }\n  | { bottom: number; right: number };\n\nexport interface NodeData<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<G>\n> {\n  isValidInput(input: NodeModel<D, G, C>): boolean;\n  nInputs: number;\n  spec: { [key: string]: FieldSpec };\n  // TODO: ObservableMap<keyof V, string>\n  errors: ObservableMap<string, string>;\n  View: React.FC;\n  toJson: JsonType;\n  parent?: NodeModel<D, G, C>;\n  connectionStartPosition?: () => undefined | ConnectionPosition;\n}\n\nexport type ConnectionData<D> = {\n  ConnectionView: React.FunctionComponent;\n  connectionText: string;\n  toJson: JsonType;\n};\n\nexport class ConnModel<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<G>\n> {\n  constructor(\n    public from: NodeModel<D, G, C>,\n    public to: NodeModel<D, G, C>,\n\n    dataBuilder: (connection: ConnModel<D, G, C>, json?: JsonType) => C,\n    json?: JsonType,\n    isHidden?: boolean\n  ) {\n    this.data = dataBuilder(this, json);\n    this.isHidden = isHidden ?? false;\n  }\n\n  data: C;\n  @observable\n  isHidden: boolean;\n  get graph(): RootStoreModel<D, G, any> {\n    return this.from.graph;\n  }\n\n  @computed\n  get isSelected(): boolean {\n    return this.from.graph.selectedConnection === this;\n  }\n\n  @computed\n  get toJson(): ConnectionJson {\n    return {\n      from: this.from.key,\n      to: this.to.key,\n      data: this.data.toJson,\n      isHidden: this.isHidden,\n    };\n  }\n}\n\nexport class NodeModel<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<G>\n> {\n  constructor(\n    public graph: RootStoreModel<D, G, any>,\n    d: {\n      key: string;\n      name: string;\n      x: number;\n      y: number;\n      isHidden?: boolean;\n      dataBuilder: (node: NodeModel<D, G, C>, json?: JsonType) => D;\n      data?: JsonType;\n    }\n  ) {\n    this.key = d.key;\n    this.name = d.name;\n    this.x = d.x;\n    this.y = d.y;\n    this.isHidden = d.isHidden ?? false;\n    this.data = d.dataBuilder(this, d.data);\n  }\n\n  resizeObserver?: ResizeObserver;\n  element?: HTMLElement;\n  @observable\n  key: string;\n  @observable\n  name: string;\n  @observable\n  x: number;\n  @observable\n  y: number;\n  @observable\n  width: number = 60;\n  @observable\n  height: number = 60;\n  @observable\n  data: D;\n  @observable\n  isHidden: boolean;\n  @observable\n  inputs = observable.array<ConnModel<D, G, C>>();\n  @computed\n  get inputNodes(): NodeModel<D, G, C>[] {\n    return this.inputs.map((c) => c.from);\n  }\n  @observable\n  outputs = observable.array<ConnModel<D, G, C>>();\n  @computed\n  get outputNodes(): NodeModel<D, G, C>[] {\n    return this.outputs.map((c) => c.to);\n  }\n\n  @action\n  addInput(conn: ConnModel<D, G, C>) {\n    this.inputs.push(conn);\n    conn.from.outputs.push(conn);\n  }\n\n  @action\n  addOutput(conn: ConnModel<D, G, C>) {\n    this.outputs.push(conn);\n    conn.to.inputs.push(conn);\n  }\n\n  @action\n  move = (dx: number, dy: number) => {\n    this.x += dx;\n    this.y += dy;\n  };\n  @action\n  setSize = (rect: DOMRect) => {\n    this.width = rect.width;\n    this.height = rect.height;\n  };\n  @action\n  setName = (name: string) => {\n    this.name = name;\n  };\n  setElement = (element: HTMLElement) => {\n    this.setSize(element.getBoundingClientRect());\n\n    if (this.element !== element) {\n      if (this.resizeObserver !== undefined) {\n        this.resizeObserver.disconnect();\n      }\n      this.element = element;\n      this.resizeObserver = new ResizeObserver((entries, observer) => {\n        this.setSize(element.getBoundingClientRect());\n      });\n      this.resizeObserver.observe(element);\n    }\n  };\n\n  @computed\n  get toJson(): NodeJson {\n    return {\n      key: this.key,\n      name: this.name,\n      x: this.x,\n      y: this.y,\n      width: this.width,\n      height: this.height,\n      isHidden: this.isHidden,\n      data: this.data.toJson,\n    };\n  }\n}\n","import {\n  action,\n  computed,\n  IKeyValueMap,\n  IMapEntries,\n  observable,\n  ObservableMap,\n} from \"mobx\";\nimport { v4 } from \"uuid\";\nimport { SourceDirectory } from \"../codegen/file-system\";\nimport {\n  NodeModel,\n  NodeData,\n  ConnModel,\n  ConnectionData,\n} from \"../node/node-model\";\nimport { downloadToClient } from \"../utils\";\nimport JSZip from \"jszip\";\nimport { ConnectionJson, GraphJson, IndexedDB, NodeJson } from \"./persistence\";\n\nexport type DataBuilder<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<D>\n> = {\n  connectionBuilder: (connection: ConnModel<D, G, C>, json?: JsonType) => C;\n  nodeBuilder: (node: NodeModel<D, G, C>, json?: JsonType) => D;\n  graphBuilder: (graph: RootStoreModel<D, G, C>, json?: JsonType) => G;\n};\n\ntype JsonTypeItem = number | string | boolean | JsonType;\nexport type JsonType = { [key: string]: JsonTypeItem | JsonTypeItem[] };\n\nexport interface GlobalData<D extends NodeData<D, any, any>> {\n  generateMainFile: string;\n  generateSourceCode: SourceDirectory;\n  canAddNode(nodeType: string): boolean;\n  View: React.FunctionComponent;\n  CanvasView: React.FunctionComponent;\n  toJson: JsonType;\n  initState?: () => void;\n}\n\ntype FullGraphJson = {\n  graph: GraphJson;\n  nodes: NodeJson[];\n  connections: ConnectionJson[];\n};\n\ntype ConstructParams<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<D>\n> = {\n  builders: DataBuilder<D, G, C>;\n  data?: G;\n  key?: string;\n  nodes?:\n    | IMapEntries<string, NodeModel<D, G, C>>\n    | IKeyValueMap<NodeModel<D, G, C>>;\n};\n\nexport class RootStoreModel<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<D>\n> {\n  constructor(d: {\n    db: IndexedDB;\n    builders: DataBuilder<D, G, C>;\n    hideOnDelete?: boolean;\n    json?: FullGraphJson;\n  }) {\n    this.db = d.db;\n    this.builders = d.builders;\n    this.hideOnDelete = d.hideOnDelete ?? false;\n    this.globalData = d.builders.graphBuilder(this, d.json?.graph.data);\n    this.key = d.json?.graph.key ?? v4();\n\n    const nodes = d.json?.nodes.reduce((m, n) => {\n      const node = new NodeModel(this, {\n        ...n,\n        dataBuilder: d.builders.nodeBuilder,\n      });\n\n      m[n.key] = node;\n      return m;\n    }, {} as { [key: string]: NodeModel<D, G, C> });\n\n    this.nodes = observable.map(nodes ?? {});\n\n    d.json?.connections.forEach((c) => {\n      const from = this.nodes.get(c.from);\n      const to = this.nodes.get(c.to);\n      if (from !== undefined && to !== undefined) {\n        this.addConnection(from, to, c.data, c.isHidden);\n      }\n    });\n    if (this.nodes.size !== 0) {\n      this.selectedNode = this.nodes.values().next().value;\n      if (this.selectedNode!.outputs.length !== 0) {\n        this.selectedConnection = this.selectedNode!.outputs[0];\n      } else if (this.selectedNode!.inputs.length !== 0) {\n        this.selectedConnection = this.selectedNode!.inputs[0];\n      } else {\n        for (const _n of this.nodes.values()) {\n          if (_n.outputs.length !== 0) {\n            this.selectedConnection = _n.outputs[0];\n            break;\n          }\n        }\n      }\n    }\n    if (this.globalData.initState !== undefined) {\n      this.globalData.initState();\n    }\n  }\n\n  key: string;\n  // Builders to create graph, node and transition instances\n  builders: DataBuilder<D, G, C>;\n  hideOnDelete: boolean;\n  // Global generic data\n  globalData: G;\n  db: IndexedDB;\n\n  @observable\n  resetStore: boolean = false;\n  // All nodes\n  @observable\n  nodes: ObservableMap<string, NodeModel<D, G, C>>;\n  // Selected node\n  @observable\n  selectedNode?: NodeModel<D, G, C>;\n  // Selected connection\n  @observable\n  selectedConnection?: ConnModel<D, G, C>;\n\n  // Selected input for connection\n  @observable\n  selectingInputFor?: NodeModel<D, G, C>;\n\n  // Select a node\n  @action\n  selectNode = (node: NodeModel<D, G, C>) => {\n    this.selectedNode = node;\n  };\n\n  // Select a connection\n  @action\n  selectConnection = (connection: ConnModel<D, G, C>) => {\n    this.selectedConnection = connection;\n  };\n\n  // Add a node\n  @action\n  addNode = (\n    nodeType: string,\n    pos?: { x: number; y: number }\n  ): NodeModel<D, G, C> | undefined => {\n    if (this.globalData.canAddNode(nodeType)) {\n      const op = new NodeModel(this, {\n        dataBuilder: this.builders.nodeBuilder,\n        key: v4(),\n        name: nodeType,\n        x: pos?.x ?? 100,\n        y: pos?.y ?? 100,\n        data: { type: nodeType },\n      });\n      this.nodes.set(op.key, op);\n      return op;\n    }\n  };\n\n  // Remove a node\n  @action\n  removeNode = (node: NodeModel<D, G, C>): void => {\n    if (node === this.selectedNode) {\n      this.selectedNode = undefined;\n    }\n    if (this.hideOnDelete) {\n      node.isHidden = true;\n      for (const _in of node.inputs) {\n        _in.isHidden = true;\n      }\n      for (const _out of node.outputs) {\n        _out.isHidden = true;\n      }\n    } else {\n      if (this.nodes.delete(node.key)) {\n        for (const _in of node.inputs) {\n          _in.from.outputs.remove(_in);\n        }\n        for (const _out of node.outputs) {\n          _out.to.inputs.remove(_out);\n        }\n      }\n    }\n  };\n\n  @action\n  activateNode = (node: NodeModel<D, G, C>) => {\n    node.isHidden = false;\n    for (const _in of node.inputs) {\n      _in.isHidden = false;\n    }\n    for (const _out of node.outputs) {\n      _out.isHidden = false;\n    }\n  };\n\n  @action\n  removeConnection = (connection: ConnModel<D, G, C>): void => {\n    if (connection === this.selectedConnection) {\n      this.selectedConnection = undefined;\n    }\n    if (this.hideOnDelete) {\n      connection.isHidden = true;\n    } else {\n      connection.from.outputs.remove(connection);\n      connection.to.inputs.remove(connection);\n    }\n  };\n\n  @action\n  activateConnection = (connection: ConnModel<D, G, C>): void => {\n    if (!connection.from.isHidden && !connection.to.isHidden) {\n      connection.isHidden = false;\n    }\n  };\n\n  // Select input-output / add connection\n\n  @action\n  selectingInput = (from: NodeModel<D, G, C>) => {\n    this.selectingInputFor = from;\n    window.addEventListener(\"keyup\", this._selectingInputKeyListener);\n  };\n\n  @action\n  assignInput = (to: NodeModel<D, G, C>): ConnModel<D, G, C> => {\n    const conn = new ConnModel(\n      this.selectingInputFor!,\n      to,\n      this.builders.connectionBuilder\n    );\n    conn.from.addOutput(conn);\n    this.selectingInputFor = undefined;\n    this.selectedConnection = conn;\n    window.removeEventListener(\"keyup\", this._selectingInputKeyListener);\n    return conn;\n  };\n\n  @action\n  private _selectingInputKeyListener = (ev: KeyboardEvent) => {\n    if (ev.key === \"Escape\") {\n      this.selectingInputFor = undefined;\n      window.removeEventListener(\"keyup\", this._selectingInputKeyListener);\n    }\n  };\n\n  @action\n  addConnection = (\n    from: NodeModel<D, G, C>,\n    to: NodeModel<D, G, C>,\n    json?: JsonType,\n    isHidden?: boolean\n  ): ConnModel<D, G, C> => {\n    const conn = new ConnModel(\n      from,\n      to,\n      this.builders.connectionBuilder,\n      json,\n      isHidden\n    );\n    conn.from.addOutput(conn);\n    return conn;\n  };\n\n  // Serialization\n\n  @computed\n  get toJson(): GraphJson {\n    return { data: this.globalData.toJson, key: this.key };\n  }\n\n  saveModel = async () => {\n    const nodes = [...this.nodes.entries()];\n    await this.db.clearDB();\n    await Promise.all([\n      this.db.updateGraph(this.toJson),\n      this.db.addNodes(\n        this.key,\n        nodes.map(([_, value]) => value.toJson)\n      ),\n      this.db.addConnections(\n        this.key,\n        nodes.flatMap(([_, value]) => value.outputs).map((t) => t.toJson)\n      ),\n    ]);\n  };\n\n  downloadModel = (): FullGraphJson => {\n    const nodes = [...this.nodes.entries()];\n    const json = {\n      graph: this.toJson,\n      nodes: nodes.map(([_, value]) => value.toJson),\n      connections: nodes\n        .flatMap(([_, value]) => value.outputs)\n        .map((t) => t.toJson),\n    };\n\n    downloadToClient(\n      JSON.stringify(json),\n      \"gemma-model.json\",\n      \"application/json\"\n    );\n    return json;\n  };\n\n  downloadSourceCode = async () => {\n    const _addToZip = (root: JSZip, dir: SourceDirectory) => {\n      const newRoot = root.folder(dir.name)!;\n\n      for (const item of dir.items) {\n        item.when({\n          file: (f) => newRoot.file(f.name, f.content),\n          dir: (d) => _addToZip(newRoot, d),\n        });\n      }\n    };\n\n    const zip = new JSZip();\n    const sourceCode = this.globalData.generateSourceCode;\n    _addToZip(zip, sourceCode);\n\n    const content = await zip.generateAsync({ type: \"blob\" });\n\n    downloadToClient(\n      content,\n      \"gemma-grafcet-source-code.zip\",\n      \"application/zip\"\n    );\n  };\n}\n","import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { NodeModel, NodeData } from \"../node/node-model\";\nimport { useStore } from \"../App\";\nimport Button from \"@material-ui/core/Button\";\n\ntype Props2 = {\n  children: React.ReactNode;\n};\n\nexport const PropertiesTable = observer(({ children }: Props2) => {\n  return (\n    <PropertiesTableStyled>\n      <thead>\n        <tr>\n          <td>Property</td>\n          <td>Value</td>\n        </tr>\n      </thead>\n      <tbody>{children}</tbody>\n    </PropertiesTableStyled>\n  );\n});\n\ntype Props<D extends NodeData<D, any, any>> = {\n  self: NodeModel<D, any, any>;\n};\n\nexport const PropertiesTableNode = observer(\n  <D extends NodeData<D, any, any>>({ self }: Props<D>) => {\n    const rootStore = useStore();\n    return (\n      <div className=\"col\">\n        <PropertiesTable>\n          {Object.entries(self.data.spec).map(([k, v]) => (\n            <tr key={k}>\n              <td>{k}</td>\n              <td>\n                <v.plotField name={k} model={self.data as any} />\n              </td>\n            </tr>\n          ))}\n        </PropertiesTable>\n        <div style={{ margin: \"0 3px\" }}>\n          {self.data.nInputs !== 0 && (\n            <div className=\"row\" key=\"inputs\">\n              <h4 style={{ margin: \"3px 0 5px 0\", width: \"100px\" }}>Inputs:</h4>\n              <div>\n                {self.inputs.map((v) => (\n                  <Button\n                    onClick={() => rootStore.selectConnection(v as any)}\n                    key={v.from.key}\n                    variant=\"outlined\"\n                    size=\"small\"\n                  >\n                    {v.from.name}\n                  </Button>\n                ))}\n                {self.inputs.length === 0 && \"No inputs\"}\n              </div>\n            </div>\n          )}\n          <div key=\"outputs\" className=\"row\">\n            <h4 style={{ margin: \"3px 0 5px 0\", width: \"100px\" }}>Outputs:</h4>\n            <div>\n              {self.outputs.map((v) => (\n                <Button\n                  onClick={() => rootStore.selectConnection(v as any)}\n                  key={v.to.key}\n                  variant=\"outlined\"\n                  size=\"small\"\n                >\n                  {v.to.name}\n                </Button>\n              ))}\n              {self.outputs.length === 0 && \"No outputs\"}\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n);\n\nconst PropertiesTableStyled = styled.table`\n  padding-bottom: 10px;\n  thead {\n    font-size: 1.1em;\n    font-weight: bolder;\n  }\n  tr td {\n    padding: 0;\n  }\n  tr td:first-child {\n    padding-right: 15px;\n    height: 32px;\n  }\n  tr td:last-child {\n    margin: auto auto;\n    padding-left: 10px;\n    text-align: center;\n    display: flex;\n    justify-content: center;\n    align-self: center;\n  }\n`;\n","import { observer } from \"mobx-react-lite\";\nimport { Resizable } from \"re-resizable\";\nimport React from \"react\";\nimport { resizableEnable } from \"../utils\";\nimport { PropertiesTableNode } from \"./properties-table\";\nimport { useStore } from \"../App\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport \"./properties-view.css\";\n\ntype Props = {};\n\nexport const PropertiesView: React.FC<Props> = observer(() => {\n  const rootStore = useStore();\n\n  let inner;\n  if (rootStore.selectedNode != null) {\n    const selectedNode = rootStore.selectedNode;\n    const selectedConnection = rootStore.selectedConnection;\n    inner = (\n      <div\n        style={{\n          overflow: \"auto\",\n          maxHeight: \"100%\",\n          maxWidth: \"100%\",\n          justifyContent: \"space-around\",\n          backgroundColor: \"#fafafa\",\n          display: \"flex\",\n        }}\n        className=\"row\"\n      >\n        <div\n          className=\"properties-view\"\n          key=\"node-properties\"\n          id=\"node-properties\"\n        >\n          <div\n            className=\"row\"\n            style={{ justifyContent: \"space-between\", alignItems: \"center\" }}\n          >\n            <h3 style={{ margin: \"5px 0px 10px 5px\" }}>\n              {`Step: ${selectedNode.name}`}\n            </h3>\n            <IconButton\n              onClick={(_) => {\n                if (selectedNode.isHidden) {\n                  rootStore.activateNode(selectedNode);\n                } else {\n                  rootStore.removeNode(selectedNode);\n                }\n              }}\n            >\n              <FontAwesomeIcon\n                icon={selectedNode.isHidden ? \"eye\" : \"eye-slash\"} //trash-alt\n                color={\"#000\"}\n              />\n            </IconButton>\n          </div>\n          <PropertiesTableNode self={rootStore.selectedNode} />\n        </div>\n        <div\n          className=\"properties-view\"\n          key=\"connection-properties\"\n          id=\"connection-properties\"\n        >\n          {selectedConnection !== undefined && (\n            <div className=\"col\">\n              <div\n                className=\"row\"\n                style={{\n                  justifyContent: \"space-between\",\n                  alignItems: \"center\",\n                }}\n              >\n                <h3 style={{ margin: \"5px 0 10px 5px\" }}>\n                  {`Transition: ${selectedConnection.from.name} -> ${selectedConnection.to.name}`}\n                </h3>\n                <IconButton\n                  onClick={(_) => {\n                    if (selectedConnection.isHidden) {\n                      rootStore.activateConnection(selectedConnection);\n                    } else {\n                      rootStore.removeConnection(selectedConnection);\n                    }\n                  }}\n                >\n                  <FontAwesomeIcon\n                    icon={selectedConnection.isHidden ? \"eye\" : \"eye-slash\"} //trash-alt\n                    color={\"#000\"}\n                  />\n                </IconButton>\n              </div>\n              <selectedConnection.data.ConnectionView />\n            </div>\n          )}\n        </div>\n        <div\n          style={{ minWidth: \"270px\" }}\n          className=\"properties-view\"\n          key=\"graph-properties\"\n        >\n          <rootStore.globalData.View />\n        </div>\n      </div>\n    );\n  } else {\n    inner = (\n      <div style={{ width: \"150px\" }} className=\"row\">\n        <div style={{ width: \"150px\" }} className=\"center\">\n          Not selected\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <Resizable\n      minHeight={200}\n      defaultSize={{ height: 280, width: \"auto\" }}\n      style={{\n        position: \"relative\",\n        background: \"white\",\n        boxShadow: \"0 1px 4px 1px #eee\",\n        border: \"1px solid #eee\",\n      }}\n      enable={resizableEnable({ top: true })}\n    >\n      {inner}\n    </Resizable>\n  );\n});\n","export class VarId {\n  constructor(public text: string) {}\n\n  toString(): string {\n    return this.text;\n  }\n}\n\nexport type CustomToken =\n  | \"(\"\n  | \")\"\n  | \"AND\"\n  | \"OR\"\n  | \"NOT\"\n  | \"<\"\n  | \">\"\n  | \"=\"\n  | \"<=\"\n  | \">=\"\n  | \"\\n\"\n  | VarId;\n\nexport const getCustomTokens = (t: string): [CustomToken, number][] => {\n  const l: [CustomToken, number][] = [];\n  let i = -1;\n  let omit = 0;\n  let signal = \"\";\n  const addSignal = () => {\n    if (signal.length !== 0) {\n      l.push([new VarId(signal), i - signal.length]);\n      signal = \"\";\n    }\n  };\n  const add = (v: CustomToken) => {\n    addSignal();\n    l.push([v, i]);\n  };\n\n  for (const c of t) {\n    i++;\n    if (omit !== 0) {\n      omit--;\n      continue;\n    }\n    switch (c) {\n      case \" \":\n        addSignal();\n        break;\n      case \"\\n\":\n      case \")\":\n      case \"(\":\n      case \"<\":\n      case \">\":\n        add(c);\n        break;\n      case \"=\":\n        const prevToken = l[l.length - 1];\n        const prev = prevToken[0];\n        const strPrev = prev instanceof VarId ? prev.text : prev;\n        if ([\"<\", \">\"].includes(strPrev) && prevToken[1] === i - 1) {\n          l[l.length - 1][0] = (prev + \"=\") as any;\n        } else {\n          add(c);\n        }\n        break;\n      case \"A\":\n        if (t.substring(i, i + 3) === \"AND\") {\n          omit = 2;\n          add(\"AND\");\n          continue;\n        }\n      // ignore: no-fallthrough\n      case \"O\":\n        if (t.substring(i, i + 2) === \"OR\") {\n          omit = 1;\n          add(\"OR\");\n          continue;\n        }\n      // ignore: no-fallthrough\n      case \"N\":\n        if (t.substring(i, i + 3) === \"NOT\") {\n          omit = 2;\n          add(\"NOT\");\n          continue;\n        }\n      // ignore: no-fallthrough\n      default:\n        signal += c;\n        break;\n    }\n  }\n  if (signal.length !== 0) {\n    l.push([new VarId(signal), i - signal.length + 1]);\n  }\n  return l;\n};\n\ntype ParseR = { ok: boolean };\n\n// type Conv = (tokens: Token[]) => ParseR;\n\n// const _union = (fs: Array<Conv>) => {};\n\n// const _find = (token: Token): Conv => {\n//   return (ts) => {\n//     return { ok: ts[0] == token };\n//   };\n// };\n\ntype Item = (CustomToken | Union)[];\n\ntype ExpType = \"VarId\" | \"comp\" | \"and\" | \"simpleExp\" | \"numOP\";\n\nclass Union {\n  constructor(\n    items: Partial<{ [key in ExpType]: (CustomToken | \"SELF\" | Union)[] }>\n  ) {\n    this.variants = Object.values(items).map((l) => {\n      return l!.map((v) => (v === \"SELF\" ? this : v));\n    });\n  }\n  variants: Item[];\n}\n\n// type Val = Item | Union;\n\n// type Expression<V extends { [key: string]: Token }> = {\n//   name: ExpType;\n//   tokens: Item;\n//   p: (t: Token[]) => V;\n// };\n\n// export const getCustomParse = (tokens: Token[]) => {\n//   const varId: Expression<{ varId: VarId }> = {\n//     name: \"VarId\",\n//     p: (t) => ({ varId: t[0] as VarId }),\n//     tokens: [new VarId(\"\")],\n//   };\n\n//   const numSimple = new Union({\n//     VarId: [new VarId(\"\")], //TODO: decimal\n//   });\n\n//   const comparator = new Union([[\"<\"], [\">\"], [\"=\"], [\"<=\"], [\">=\"]]);\n\n//   const expSimple = new Union([\n//     [numSimple, comparator, numSimple],\n//     [new VarId(\"\")],\n//   ]);\n\n//   const expAnd = new Union([[expSimple, \"AND\", \"SELF\"], [expSimple]]);\n\n//   const exp = new Union([\n//     [\"(\", \"SELF\", \")\"],\n//     [\"NOT\", \"SELF\"],\n//     [expAnd, \"OR\", \"SELF\"],\n//     [expAnd],\n//   ]);\n\n//   for (const t of tokens) {\n//     matchPossibilities(t, exp);\n//   }\n// };\n\n// const matchPossibilities = (t: Token, possibilities: Union): void => {\n//   let i = -1;\n//   for (const variant of possibilities.variants) {\n//     i++;\n\n//     const curr = variant.pop();\n//     if (curr === undefined) {\n//     } else if (typeof curr == \"string\") {\n//       if (t == curr) {\n//       }\n//     } else if (curr instanceof Union) {\n//       matchPossibilities(t, curr);\n//     } else {\n//       if (t instanceof VarId) {\n//       } else {\n//       }\n//     }\n//   }\n// };\n","import Button from \"@material-ui/core/Button\";\nimport ButtonGroup from \"@material-ui/core/ButtonGroup\";\nimport MenuItem from \"@material-ui/core/MenuItem\";\nimport Select from \"@material-ui/core/Select\";\nimport { observer } from \"mobx-react-lite\";\nimport { IAnyType, IMSTMap, types } from \"mobx-state-tree\";\nimport React from \"react\";\nimport styled from \"styled-components\";\nimport { FieldSpec, PP2 } from \"./\";\n\nconst ButtonsDiv = styled.div`\n  min-height: 38px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n`;\n\nexport class ChoiceFieldSpec<\n  V,\n  K extends C extends IMSTMap<M> ? string : string & keyof C,\n  C extends { [key: string]: V } | IMSTMap<M>,\n  M extends IAnyType,\n  MM extends { [key: string]: FieldSpec }\n> {\n  choices: C;\n  default: K;\n  onChange?: (n: V) => void;\n\n  constructor(v: { choices: C; default: K; onChange?: (n: V) => void }) {\n    this.choices = v.choices;\n    this.default = v.default;\n    this.onChange = v.onChange;\n    if (this.isObservableMap()) {\n      if ((this.choices as any).get(this.default) === null) {\n        throw Error(\"\");\n      }\n    }\n  }\n\n  isObservableMap = () => {\n    return (\n      typeof this.choices.keys === \"function\" &&\n      typeof this.choices.size === \"number\" &&\n      Symbol.toStringTag in this.choices\n    );\n  };\n\n  mobxProp = () =>\n    this.default !== undefined\n      ? types.optional(types.string, this.default)\n      : types.string;\n\n  plotField: React.FC<PP2<MM, string>> = observer(({ name, model }) => {\n    let keys;\n    if (this.isObservableMap()) {\n      keys = Array.from(\n        (this.choices as any).keys() as IterableIterator<string>\n      );\n    } else {\n      keys = Object.keys(this.choices);\n    }\n    return (\n      <ChoiceField\n        value={model[name]}\n        setValue={(v) => {\n          model[name] = v as any;\n          if (this.onChange !== undefined) this.onChange(v as any);\n        }}\n        keys={keys}\n      />\n    );\n  });\n}\n\nexport const ChoiceField = ({\n  keys,\n  value,\n  setValue,\n  maxButton,\n}: {\n  keys: string[];\n  value: string;\n  setValue: (v: string) => void;\n  maxButton?: number\n}) => {\n  if (keys.length > (maxButton ?? 3)) {\n    return (\n      <Select\n        value={value}\n        onChange={(e) => {\n          setValue(e.target.value as any);\n        }}\n        autoWidth={true}\n        style={{minHeight: \"35px\", marginBottom: \"3px\"}}\n        disabled={keys.length <= 1}\n      >\n        {keys.map((k) => {\n          return (\n            <MenuItem key={k} value={k}>\n              {k}\n            </MenuItem>\n          );\n        })}\n      </Select>\n    );\n  } else {\n    return (\n      <ButtonsDiv>\n        <ButtonGroup\n          size=\"small\"\n          color=\"primary\"\n          aria-label=\"outlined primary button group\"\n        >\n          {keys.map((k) => {\n            const buttonStyle =\n              k === value ? { background: \"#3f51b5\", color: \"white\" } : {};\n\n            return (\n              <Button\n                key={k}\n                onClick={() => {\n                  setValue(k);\n                }}\n                style={buttonStyle}\n              >\n                {k}\n              </Button>\n            );\n          })}\n        </ButtonGroup>\n      </ButtonsDiv>\n    );\n  }\n};\n","import React from \"react\";\nimport { computed, observable, reaction } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport { ChoiceFieldSpec } from \"../fields/choice-field\";\nimport { ConnectionPosition, NodeData, NodeModel } from \"../node/node-model\";\nimport { listToMap } from \"../utils\";\nimport { GemmaGrafcet } from \"./gemma\";\nimport { Transition } from \"./transition\";\nimport { JsonType } from \"../canvas/store\";\nimport { BoolFieldSpec } from \"../fields/primitive-field\";\n\nexport enum StepType {\n  ENCLOSING = \"ENCLOSING\",\n  MACRO = \"MACRO\",\n  SIMPLE = \"SIMPLE\",\n  CONTAINER = \"CONTAINER\",\n}\n\ntype GemmaNode = NodeModel<Step, GemmaGrafcet, Transition>;\n\nexport enum ProcedureType {\n  F = \"F\", // Operational\n  D = \"D\", // Failure\n  A = \"A\", // Stop\n}\n\nexport type Step = SimpleStep | EnclosingStep | MacroStep | ContainerStep;\n\nexport class BaseStep implements NodeData<Step, GemmaGrafcet, Transition> {\n  @observable\n  type: StepType;\n\n  nInputs = Number.POSITIVE_INFINITY;\n  errors = observable.map<string, string>();\n\n  constructor(\n    private node: GemmaNode,\n    d?: {\n      description?: string;\n      family?: ProcedureType;\n      isInitial?: boolean;\n      type?: StepType;\n    }\n  ) {\n    this.description = d?.description ?? \"\";\n    this.family = d?.family ?? ProcedureType.F;\n    this.isInitial = d?.isInitial ?? false;\n    this.type = d?.type ?? StepType.SIMPLE;\n    reaction(\n      (_) => this.isInitial,\n      (isInitial, _) => {\n        console.log(isInitial);\n        if (isInitial) {\n          const otherInitial = this.automationSystem.steps.find(\n            (s) => s.isInitial && s !== this\n          );\n          if (otherInitial !== undefined) {\n            otherInitial.isInitial = false;\n          }\n        }\n      }\n    );\n  }\n\n  @computed\n  get name(): string {\n    return this.node.name;\n  }\n  @observable\n  description: string;\n  @observable\n  isInitial: boolean;\n  @observable\n  family: ProcedureType;\n  @computed\n  get parent(): GemmaNode | undefined {\n    if (this.type === StepType.CONTAINER) {\n      return undefined;\n    }\n    switch (this.family) {\n      case ProcedureType.A:\n        return this.automationSystem.aFamily;\n      case ProcedureType.D:\n        return this.automationSystem.dFamily;\n      case ProcedureType.F:\n        return this.automationSystem.fFamily;\n    }\n    throw new Error(\"\");\n  }\n\n  get automationSystem(): GemmaGrafcet {\n    return this.node.graph.globalData;\n  }\n\n  connectionStartPosition = (): undefined | ConnectionPosition => {\n    if (this.type === StepType.CONTAINER) {\n      return { bottom: 40, left: 50 };\n    }\n    return undefined;\n  };\n\n  @computed\n  private get _transitions(): Transition[] {\n    return this.node.outputs\n      .filter((t) => !t.isHidden)\n      .map((t) => t.data)\n      .sort((a, b) => a.priority - b.priority);\n  }\n  @computed\n  get innerTransitionsLength(): number {\n    return this._transitions.length;\n  }\n  @computed\n  get transitions(): Transition[] {\n    if (this === this.automationSystem.fFamily!.data) {\n      return this._transitions;\n    }\n    return this.family === ProcedureType.F\n      ? this.automationSystem.fFamily!.data.transitions.concat(\n          this._transitions\n        )\n      : this._transitions;\n  }\n  @computed\n  get id(): number {\n    return this.automationSystem.steps.indexOf(this as any) + 1;\n  }\n\n  spec = {\n    isInitial: new BoolFieldSpec({ default: false, required: true }),\n    type: new ChoiceFieldSpec({\n      default: StepType.SIMPLE,\n      choices: listToMap(\n        Object.values(StepType).filter((t) => t !== StepType.CONTAINER)\n      ),\n    }),\n  };\n\n  isValidInput(n: GemmaNode): boolean {\n    return this.node.inputNodes.every((t) => t.data !== n.data);\n  }\n\n  @computed\n  get toJson(): JsonType {\n    return {\n      family: this.family,\n      description: this.description,\n      type: this.type,\n      isInitial: this.isInitial,\n    };\n  }\n\n  View = observer(({ children }) => {\n    const _color = {\n      [ProcedureType.A]: \"#ecf5ff\",\n      [ProcedureType.D]: \"#ffd6d6\",\n      [ProcedureType.F]: \"#ebffec\",\n    };\n\n    if (this.type === StepType.CONTAINER) {\n      return (\n        <div\n          style={{\n            position: \"relative\",\n            border: \"1px solid #eee\",\n            background: _color[this.family],\n            flex: 1,\n            width: 400,\n            height: 400,\n          }}\n        >\n          {children}\n        </div>\n      );\n    }\n\n    let style: React.CSSProperties = {};\n    let innerStyle: React.CSSProperties = { padding: \"12px\" };\n    let wrapper: (p: React.ReactElement) => React.ReactElement = (p) => p;\n\n    if (this.isInitial) {\n      wrapper = (p) => (\n        <div style={{ padding: \"5px\" }}>\n          <div\n            style={{\n              border: \"1.5px solid\",\n            }}\n          >\n            {p}\n          </div>\n        </div>\n      );\n    }\n\n    const nodeHeight = this.node.height - 2 - (this.isInitial ? 12 : 0);\n    switch (this.type) {\n      case StepType.ENCLOSING:\n        style = { padding: \"0 0\", display: \"flex\" };\n        return wrapper(\n          <div style={{ ...style, position: \"relative\" }}>\n            <EnclosingDecoration left={true} nodeHeight={nodeHeight} />\n            <div style={{ ...innerStyle, padding: \"12px 18px\" }}>\n              {this.node.name}\n            </div>\n            <EnclosingDecoration left={false} nodeHeight={nodeHeight} />\n          </div>\n        );\n      case StepType.MACRO:\n        style = { padding: \"5px 0\" };\n        innerStyle = {\n          borderTop: \"1.5px solid\",\n          borderBottom: \"1.5px solid\",\n          borderRight: \"0\",\n          borderLeft: \"0\",\n          padding: \"5px 12px\",\n        };\n        break;\n    }\n\n    return wrapper(\n      <div style={style}>\n        <div style={innerStyle}>{this.node.name}</div>\n      </div>\n    );\n  });\n}\n\nexport type SimpleStep = BaseStep & {\n  type: StepType.SIMPLE;\n};\n\nexport type ContainerStep = BaseStep & {\n  type: StepType.CONTAINER;\n};\n\nexport type EnclosingStep = BaseStep & {\n  type: StepType.ENCLOSING;\n};\n\nexport type MacroStep = BaseStep & {\n  type: StepType.MACRO;\n};\n\nconst EnclosingDecoration = ({\n  nodeHeight,\n  left,\n}: {\n  nodeHeight: number;\n  left: boolean;\n}) => {\n  return (\n    <svg\n      style={{\n        width: \"10px\",\n        height: \"\" + nodeHeight + \"px\",\n        position: \"absolute\",\n        right: left ? undefined : 0,\n      }}\n    >\n      <path\n        d={\n          left\n            ? `M 10 0 L 0 ${nodeHeight / 2} L 10 ${nodeHeight}`\n            : `M 0 0 L 10 ${nodeHeight / 2} L 0 ${nodeHeight}`\n        }\n        stroke=\"black\"\n        fill=\"transparent\"\n      ></path>\n    </svg>\n  );\n};\n","import Switch from \"@material-ui/core/Switch\";\nimport TextField from \"@material-ui/core/TextField\";\nimport { observer } from \"mobx-react-lite\";\nimport { types } from \"mobx-state-tree\";\nimport React from \"react\";\nimport { FieldSpec, FieldSpecI, PP2 } from \"./\";\n\nexport class StrFieldSpec<M extends { [key: string]: FieldSpec }>\n  implements FieldSpecI<M, string> {\n  default: string;\n  maxLength?: number;\n  minLength?: number;\n  multiline: boolean;\n\n  constructor(v: {\n    default: string;\n    maxLength?: number;\n    minLength?: number;\n    multiline?: boolean;\n  }) {\n    this.default = v.default;\n    this.maxLength = v.maxLength;\n    this.minLength = v.minLength;\n    this.multiline = v.multiline ?? false;\n\n    if (typeof this.default === \"string\") {\n      if (\n        this.minLength !== undefined &&\n        this.default.length < this.minLength\n      ) {\n        throw Error(\"\");\n      } else if (\n        this.maxLength !== undefined &&\n        this.default.length > this.maxLength\n      ) {\n        throw Error(\"\");\n      }\n    }\n  }\n\n  mobxProp = () => {\n    if (this.default !== undefined) {\n      return types.optional(types.string, this.default);\n    } else {\n      return types.string;\n    }\n  };\n\n  plotField = observer(({ name, model }: PP2<M, string>) => {\n    const [value, setValue] = React.useState(model[name]);\n    const errors = model.errors;\n    const onChange = (\n      e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>\n    ) => {\n      let value = e.target.value;\n      setValue(value as any);\n\n      if (this.maxLength !== undefined && value.length > this.maxLength) {\n        errors.set(name, \"Max length exceded.\");\n      } else if (\n        this.minLength !== undefined &&\n        value.length < this.minLength\n      ) {\n        errors.set(name, \"Min length exceded.\");\n      } else {\n        errors.delete(name);\n        model[name] = value as any;\n      }\n    };\n\n    if (this.multiline) {\n      return (\n        <textarea\n          key={name}\n          className=\"multiline-input\"\n          value={value}\n          onChange={onChange}\n        ></textarea>\n      );\n    } else {\n      return (\n        <TextField\n          key={name}\n          value={value}\n          fullWidth={true}\n          margin=\"dense\"\n          inputProps={{ style: { textAlign: \"center\" } }}\n          error={errors.get(name) !== undefined}\n          style={{ width: \"140px\" }}\n          onChange={onChange}\n        />\n      );\n    }\n  });\n}\n\nexport class BoolFieldSpec<M extends { [key: string]: FieldSpec }>\n  implements FieldSpecI<M, boolean> {\n  default: boolean;\n  required?: boolean;\n\n  constructor(v: { default: boolean; required?: boolean }) {\n    this.default = v.default;\n    this.required = v.required !== undefined ? v.required : true;\n  }\n\n  mobxProp = () => {\n    if (this[\"default\"] === undefined) {\n      return types.boolean;\n    } else {\n      return types.optional(types.boolean, this.default);\n    }\n  };\n\n  plotField = observer(({ name, model }: PP2<M, boolean>) => {\n    return (\n      <Switch\n        checked={model[name]}\n        onChange={() => {\n          model[name] = !model[name] as any;\n        }}\n        color=\"primary\"\n      />\n    );\n  });\n}\n\nexport class NumFieldSpec<M extends { [key: string]: FieldSpec }>\n  implements FieldSpecI<M, number> {\n  default: number;\n  min?: number;\n  max?: number;\n  step?: number;\n  isInt: boolean;\n\n  constructor(v: {\n    default: number;\n    min?: number;\n    max?: number;\n    step?: number;\n    isInt?: boolean;\n  }) {\n    this.default = v.default;\n    this.min = v.min;\n    this.max = v.max;\n    this.step = v.step;\n    this.isInt = v.isInt !== undefined ? v.isInt : false;\n    if (this.min !== undefined && this.default < this.min) {\n      throw Error(\"\");\n    } else if (this.max !== undefined && this.default > this.max) {\n      throw Error(\"\");\n    }\n    if (this.isInt) {\n      this.default = Math.round(this.default);\n      if (this.step === undefined) {\n        this.step = 1;\n      } else {\n        this.step = Math.round(this.step);\n      }\n    }\n  }\n\n  mobxProp = () =>\n    this.default !== undefined\n      ? types.optional(types.number, this.default)\n      : types.number;\n\n  plotField = observer(({ name, model }: PP2<M, number>) => {\n    const [value, setValue] = React.useState(\n      ((model[name] as any) as number).toString()\n    );\n    const errors = model.errors;\n    const error = errors.get(name);\n\n    return (\n      <TextField\n        key={name}\n        value={value}\n        inputProps={{\n          min: this.min,\n          max: this.max,\n          step: this.step,\n          style: { textAlign: \"center\" },\n        }}\n        type=\"number\"\n        error={error !== undefined}\n        fullWidth={true}\n        style={{ width: \"80px\" }}\n        onChange={(e) => {\n          let value = e.target.value;\n          if (this.min !== undefined && this.min >= 0) {\n            value = value.replace(/-/g, \"\");\n          }\n          if (this.isInt) {\n            value = value.replace(/\\./g, \"\");\n          }\n          setValue(value);\n\n          let num: number;\n          if (this.isInt) {\n            num = parseInt(value, 10);\n          } else {\n            num = parseFloat(value);\n          }\n\n          if (Number.isNaN(num)) {\n            errors.set(name, \"Invalid\");\n          } else if (this.min !== undefined && this.min > num) {\n            errors.set(name, `Smaller than minimum ${this.min}`);\n          } else if (this.max !== undefined && this.max < num) {\n            errors.set(name, `Greater than maximum ${this.max}`);\n          } else {\n            errors.delete(name);\n            model[name] = num as any;\n          }\n        }}\n      />\n    );\n  });\n}\n","import { VarId } from \"./custom_parser\";\nimport { GemmaGrafcet, Signal } from \"./gemma\";\nimport { EnclosingStep, MacroStep, SimpleStep, StepType } from \"./step\";\nimport { Transition } from \"./transition\";\n\nexport class H {\n  static textOrEmpty = (cond: boolean, text: string) => (cond ? text : \"\");\n}\n\nconst templateCondition = (t: Transition): string => {\n  return t.expressionTokens\n    .map(([tok, _]) => {\n      if (tok instanceof VarId) {\n        return \"GVL.\" + tok.text;\n      } else {\n        return tok;\n      }\n    })\n    .join(\" \");\n};\n\nconst templateTransitions = (\n  transitions: Transition[],\n  { isNested }: { isNested: boolean }\n) => {\n  return `\\\n${transitions\n  .map((t, index) => {\n    return `\n${index === 0 ? \"IF\" : \"ELSIF\"} ${templateCondition(t)} THEN\n  State:=${t.to.id};\\\n  ${isNested ? \"\\n  Entry:=TRUE;\" : \"\"}`;\n  })\n  .join(\"\\n\")}\\\n${transitions.length === 0 ? \"\" : \"\\nEND_IF\"}`;\n};\n\nconst templateGemmaGrafcetSimpleStep = (model: SimpleStep): string => {\n  return templateTransitions(model.transitions, { isNested: false });\n};\n\nconst templateFBEntry = (model: MacroStep | EnclosingStep): string => `\\\nIF Entry THEN\n  ${model.name}(Initialization:=ENTRY);\n  Entry:=FALSE;\nEND_IF\n${model.name}(Initialization:=ENTRY);`;\n\nconst templateGemmaGrafcetNestedStep = (\n  model: MacroStep | EnclosingStep\n): string => {\n  const transitions = model.transitions;\n  const _evaluateComplete = (t: Transition, index: number): boolean => {\n    const _isInner = transitions.length - model.innerTransitionsLength <= index;\n    switch (model.type) {\n      case StepType.MACRO:\n        return _isInner && !t.isNegated;\n      case StepType.ENCLOSING:\n        return _isInner && t.isNegated;\n    }\n    throw new Error(\"\");\n  };\n\n  return `\n${templateFBEntry(model)}\n\n${transitions\n  .map((t, index) => {\n    return `\\\n${index === 0 ? \"IF\" : \"ELSIF\"} ${templateCondition(t)}${\n      _evaluateComplete(t, index) ? ` AND ${model.name}.Complete` : \"\"\n    } THEN\n  State:=${t.to.id};\n  Entry:=TRUE;`;\n  })\n  .join(\"\\n\")}\\\n${H.textOrEmpty(transitions.length !== 0, \"\\nEND_IF\")}`;\n};\n\nexport const templateGlobals = (signals: Array<Signal>): string => {\n  return `\\\nVAR_GLOBAL\n    ${signals\n      .map(\n        (s) =>\n          `${s.name} : ${s.type}${\n            s.defaultValue.trim().length === 0 ? \"\" : \" :=\" + s.defaultValue\n          };`\n      )\n      .join(\"\\n    \")}\nEND_VAR\n`;\n};\n\nexport const templateGemmaGrafcet = (model: GemmaGrafcet): string => {\n  return `\n// Variable declaration\nVAR\n${model.steps\n  .filter((s) => s.type === StepType.ENCLOSING || s.type === StepType.MACRO)\n  .map((s) => `  ${s.name}:${s.name}_FB;`)\n  .join(\"\\n\")}\n\n  State:UINT:=${model.initialStep?.id};\n  Entry:BOOL:=TRUE;\nEND_VAR\n\n// Program behavior\nCASE State OF\n  ${model.steps\n    .map((step) => {\n      return `\n  ${step.id}: //State ${step.name}\n    ${(() => {\n      switch (step.type) {\n        case StepType.SIMPLE:\n          return templateGemmaGrafcetSimpleStep(step);\n        case StepType.ENCLOSING:\n        case StepType.MACRO:\n          return templateGemmaGrafcetNestedStep(step);\n        default:\n          throw new Error(\"\");\n      }\n    })().replace(/\\n/g, \"\\n    \")}\n  `;\n    })\n    .join(\"\\n\")}\nEND_CASE\n`;\n};\n","/* eslint-disable */\n// Generated from ./src/step/SimpleBoolean.g4 by ANTLR 4.7.3-SNAPSHOT\n// @ts-nocheck\n\nimport { ATN } from \"antlr4ts/atn/ATN\";\nimport { ATNDeserializer } from \"antlr4ts/atn/ATNDeserializer\";\nimport { CharStream } from \"antlr4ts/CharStream\";\nimport { Lexer } from \"antlr4ts/Lexer\";\nimport { LexerATNSimulator } from \"antlr4ts/atn/LexerATNSimulator\";\nimport { NotNull } from \"antlr4ts/Decorators\";\nimport { Override } from \"antlr4ts/Decorators\";\nimport { RuleContext } from \"antlr4ts/RuleContext\";\nimport { Vocabulary } from \"antlr4ts/Vocabulary\";\nimport { VocabularyImpl } from \"antlr4ts/VocabularyImpl\";\n\nimport * as Utils from \"antlr4ts/misc/Utils\";\n\n\nexport class SimpleBooleanLexer extends Lexer {\n\tpublic static readonly AND = 1;\n\tpublic static readonly OR = 2;\n\tpublic static readonly NOT = 3;\n\tpublic static readonly TRUE = 4;\n\tpublic static readonly FALSE = 5;\n\tpublic static readonly GT = 6;\n\tpublic static readonly GE = 7;\n\tpublic static readonly LT = 8;\n\tpublic static readonly LE = 9;\n\tpublic static readonly EQ = 10;\n\tpublic static readonly LPAREN = 11;\n\tpublic static readonly RPAREN = 12;\n\tpublic static readonly DECIMAL = 13;\n\tpublic static readonly IDENTIFIER = 14;\n\tpublic static readonly WS = 15;\n\n\t// tslint:disable:no-trailing-whitespace\n\tpublic static readonly channelNames: string[] = [\n\t\t\"DEFAULT_TOKEN_CHANNEL\", \"HIDDEN\",\n\t];\n\n\t// tslint:disable:no-trailing-whitespace\n\tpublic static readonly modeNames: string[] = [\n\t\t\"DEFAULT_MODE\",\n\t];\n\n\tpublic static readonly ruleNames: string[] = [\n\t\t\"AND\", \"OR\", \"NOT\", \"TRUE\", \"FALSE\", \"GT\", \"GE\", \"LT\", \"LE\", \"EQ\", \"LPAREN\", \n\t\t\"RPAREN\", \"DECIMAL\", \"IDENTIFIER\", \"WS\",\n\t];\n\n\tprivate static readonly _LITERAL_NAMES: Array<string | undefined> = [\n\t\tundefined, \"'AND'\", \"'OR'\", \"'NOT'\", \"'TRUE'\", \"'FALSE'\", \"'>'\", \"'>='\", \n\t\t\"'<'\", \"'<='\", \"'='\", \"'('\", \"')'\",\n\t];\n\tprivate static readonly _SYMBOLIC_NAMES: Array<string | undefined> = [\n\t\tundefined, \"AND\", \"OR\", \"NOT\", \"TRUE\", \"FALSE\", \"GT\", \"GE\", \"LT\", \"LE\", \n\t\t\"EQ\", \"LPAREN\", \"RPAREN\", \"DECIMAL\", \"IDENTIFIER\", \"WS\",\n\t];\n\tpublic static readonly VOCABULARY: Vocabulary = new VocabularyImpl(SimpleBooleanLexer._LITERAL_NAMES, SimpleBooleanLexer._SYMBOLIC_NAMES, []);\n\n\t// @Override\n\t// @NotNull\n\tpublic get vocabulary(): Vocabulary {\n\t\treturn SimpleBooleanLexer.VOCABULARY;\n\t}\n\t// tslint:enable:no-trailing-whitespace\n\n\n\tconstructor(input: CharStream) {\n\t\tsuper(input);\n\t\tthis._interp = new LexerATNSimulator(SimpleBooleanLexer._ATN, this);\n\t}\n\n\t// @Override\n\tpublic get grammarFileName(): string { return \"SimpleBoolean.g4\"; }\n\n\t// @Override\n\tpublic get ruleNames(): string[] { return SimpleBooleanLexer.ruleNames; }\n\n\t// @Override\n\tpublic get serializedATN(): string { return SimpleBooleanLexer._serializedATN; }\n\n\t// @Override\n\tpublic get channelNames(): string[] { return SimpleBooleanLexer.channelNames; }\n\n\t// @Override\n\tpublic get modeNames(): string[] { return SimpleBooleanLexer.modeNames; }\n\n\tpublic static readonly _serializedATN: string =\n\t\t\"\\x03\\uC91D\\uCABA\\u058D\\uAFBA\\u4F53\\u0607\\uEA8B\\uC241\\x02\\x11e\\b\\x01\\x04\" +\n\t\t\"\\x02\\t\\x02\\x04\\x03\\t\\x03\\x04\\x04\\t\\x04\\x04\\x05\\t\\x05\\x04\\x06\\t\\x06\\x04\" +\n\t\t\"\\x07\\t\\x07\\x04\\b\\t\\b\\x04\\t\\t\\t\\x04\\n\\t\\n\\x04\\v\\t\\v\\x04\\f\\t\\f\\x04\\r\\t\\r\" +\n\t\t\"\\x04\\x0E\\t\\x0E\\x04\\x0F\\t\\x0F\\x04\\x10\\t\\x10\\x03\\x02\\x03\\x02\\x03\\x02\\x03\" +\n\t\t\"\\x02\\x03\\x03\\x03\\x03\\x03\\x03\\x03\\x04\\x03\\x04\\x03\\x04\\x03\\x04\\x03\\x05\\x03\" +\n\t\t\"\\x05\\x03\\x05\\x03\\x05\\x03\\x05\\x03\\x06\\x03\\x06\\x03\\x06\\x03\\x06\\x03\\x06\\x03\" +\n\t\t\"\\x06\\x03\\x07\\x03\\x07\\x03\\b\\x03\\b\\x03\\b\\x03\\t\\x03\\t\\x03\\n\\x03\\n\\x03\\n\\x03\" +\n\t\t\"\\v\\x03\\v\\x03\\f\\x03\\f\\x03\\r\\x03\\r\\x03\\x0E\\x05\\x0EI\\n\\x0E\\x03\\x0E\\x06\\x0E\" +\n\t\t\"L\\n\\x0E\\r\\x0E\\x0E\\x0EM\\x03\\x0E\\x03\\x0E\\x06\\x0ER\\n\\x0E\\r\\x0E\\x0E\\x0ES\\x05\" +\n\t\t\"\\x0EV\\n\\x0E\\x03\\x0F\\x03\\x0F\\x07\\x0FZ\\n\\x0F\\f\\x0F\\x0E\\x0F]\\v\\x0F\\x03\\x10\" +\n\t\t\"\\x06\\x10`\\n\\x10\\r\\x10\\x0E\\x10a\\x03\\x10\\x03\\x10\\x02\\x02\\x02\\x11\\x03\\x02\" +\n\t\t\"\\x03\\x05\\x02\\x04\\x07\\x02\\x05\\t\\x02\\x06\\v\\x02\\x07\\r\\x02\\b\\x0F\\x02\\t\\x11\" +\n\t\t\"\\x02\\n\\x13\\x02\\v\\x15\\x02\\f\\x17\\x02\\r\\x19\\x02\\x0E\\x1B\\x02\\x0F\\x1D\\x02\\x10\" +\n\t\t\"\\x1F\\x02\\x11\\x03\\x02\\x06\\x03\\x022;\\x05\\x02C\\\\aac|\\x06\\x022;C\\\\aac|\\x05\" +\n\t\t\"\\x02\\v\\f\\x0E\\x0F\\\"\\\"\\x02j\\x02\\x03\\x03\\x02\\x02\\x02\\x02\\x05\\x03\\x02\\x02\" +\n\t\t\"\\x02\\x02\\x07\\x03\\x02\\x02\\x02\\x02\\t\\x03\\x02\\x02\\x02\\x02\\v\\x03\\x02\\x02\\x02\" +\n\t\t\"\\x02\\r\\x03\\x02\\x02\\x02\\x02\\x0F\\x03\\x02\\x02\\x02\\x02\\x11\\x03\\x02\\x02\\x02\" +\n\t\t\"\\x02\\x13\\x03\\x02\\x02\\x02\\x02\\x15\\x03\\x02\\x02\\x02\\x02\\x17\\x03\\x02\\x02\\x02\" +\n\t\t\"\\x02\\x19\\x03\\x02\\x02\\x02\\x02\\x1B\\x03\\x02\\x02\\x02\\x02\\x1D\\x03\\x02\\x02\\x02\" +\n\t\t\"\\x02\\x1F\\x03\\x02\\x02\\x02\\x03!\\x03\\x02\\x02\\x02\\x05%\\x03\\x02\\x02\\x02\\x07\" +\n\t\t\"(\\x03\\x02\\x02\\x02\\t,\\x03\\x02\\x02\\x02\\v1\\x03\\x02\\x02\\x02\\r7\\x03\\x02\\x02\" +\n\t\t\"\\x02\\x0F9\\x03\\x02\\x02\\x02\\x11<\\x03\\x02\\x02\\x02\\x13>\\x03\\x02\\x02\\x02\\x15\" +\n\t\t\"A\\x03\\x02\\x02\\x02\\x17C\\x03\\x02\\x02\\x02\\x19E\\x03\\x02\\x02\\x02\\x1BH\\x03\\x02\" +\n\t\t\"\\x02\\x02\\x1DW\\x03\\x02\\x02\\x02\\x1F_\\x03\\x02\\x02\\x02!\\\"\\x07C\\x02\\x02\\\"#\" +\n\t\t\"\\x07P\\x02\\x02#$\\x07F\\x02\\x02$\\x04\\x03\\x02\\x02\\x02%&\\x07Q\\x02\\x02&\\'\\x07\" +\n\t\t\"T\\x02\\x02\\'\\x06\\x03\\x02\\x02\\x02()\\x07P\\x02\\x02)*\\x07Q\\x02\\x02*+\\x07V\\x02\" +\n\t\t\"\\x02+\\b\\x03\\x02\\x02\\x02,-\\x07V\\x02\\x02-.\\x07T\\x02\\x02./\\x07W\\x02\\x02/\" +\n\t\t\"0\\x07G\\x02\\x020\\n\\x03\\x02\\x02\\x0212\\x07H\\x02\\x0223\\x07C\\x02\\x0234\\x07\" +\n\t\t\"N\\x02\\x0245\\x07U\\x02\\x0256\\x07G\\x02\\x026\\f\\x03\\x02\\x02\\x0278\\x07@\\x02\" +\n\t\t\"\\x028\\x0E\\x03\\x02\\x02\\x029:\\x07@\\x02\\x02:;\\x07?\\x02\\x02;\\x10\\x03\\x02\\x02\" +\n\t\t\"\\x02<=\\x07>\\x02\\x02=\\x12\\x03\\x02\\x02\\x02>?\\x07>\\x02\\x02?@\\x07?\\x02\\x02\" +\n\t\t\"@\\x14\\x03\\x02\\x02\\x02AB\\x07?\\x02\\x02B\\x16\\x03\\x02\\x02\\x02CD\\x07*\\x02\\x02\" +\n\t\t\"D\\x18\\x03\\x02\\x02\\x02EF\\x07+\\x02\\x02F\\x1A\\x03\\x02\\x02\\x02GI\\x07/\\x02\\x02\" +\n\t\t\"HG\\x03\\x02\\x02\\x02HI\\x03\\x02\\x02\\x02IK\\x03\\x02\\x02\\x02JL\\t\\x02\\x02\\x02\" +\n\t\t\"KJ\\x03\\x02\\x02\\x02LM\\x03\\x02\\x02\\x02MK\\x03\\x02\\x02\\x02MN\\x03\\x02\\x02\\x02\" +\n\t\t\"NU\\x03\\x02\\x02\\x02OQ\\x070\\x02\\x02PR\\t\\x02\\x02\\x02QP\\x03\\x02\\x02\\x02RS\" +\n\t\t\"\\x03\\x02\\x02\\x02SQ\\x03\\x02\\x02\\x02ST\\x03\\x02\\x02\\x02TV\\x03\\x02\\x02\\x02\" +\n\t\t\"UO\\x03\\x02\\x02\\x02UV\\x03\\x02\\x02\\x02V\\x1C\\x03\\x02\\x02\\x02W[\\t\\x03\\x02\" +\n\t\t\"\\x02XZ\\t\\x04\\x02\\x02YX\\x03\\x02\\x02\\x02Z]\\x03\\x02\\x02\\x02[Y\\x03\\x02\\x02\" +\n\t\t\"\\x02[\\\\\\x03\\x02\\x02\\x02\\\\\\x1E\\x03\\x02\\x02\\x02][\\x03\\x02\\x02\\x02^`\\t\\x05\" +\n\t\t\"\\x02\\x02_^\\x03\\x02\\x02\\x02`a\\x03\\x02\\x02\\x02a_\\x03\\x02\\x02\\x02ab\\x03\\x02\" +\n\t\t\"\\x02\\x02bc\\x03\\x02\\x02\\x02cd\\b\\x10\\x02\\x02d \\x03\\x02\\x02\\x02\\t\\x02HMS\" +\n\t\t\"U[a\\x03\\b\\x02\\x02\";\n\tpublic static __ATN: ATN;\n\tpublic static get _ATN(): ATN {\n\t\tif (!SimpleBooleanLexer.__ATN) {\n\t\t\tSimpleBooleanLexer.__ATN = new ATNDeserializer().deserialize(Utils.toCharArray(SimpleBooleanLexer._serializedATN));\n\t\t}\n\n\t\treturn SimpleBooleanLexer.__ATN;\n\t}\n\n}\n\n","/* eslint-disable */\n// Generated from ./src/step/SimpleBoolean.g4 by ANTLR 4.7.3-SNAPSHOT\n// @ts-nocheck\n// @ts-ignore\n\nimport { ATN } from \"antlr4ts/atn/ATN\";\nimport { ATNDeserializer } from \"antlr4ts/atn/ATNDeserializer\";\nimport { NoViableAltException } from \"antlr4ts/NoViableAltException\";\nimport { Parser } from \"antlr4ts/Parser\";\nimport { ParserRuleContext } from \"antlr4ts/ParserRuleContext\";\nimport { ParserATNSimulator } from \"antlr4ts/atn/ParserATNSimulator\";\nimport { RecognitionException } from \"antlr4ts/RecognitionException\";\n//import { RuleVersion } from \"antlr4ts/RuleVersion\";\nimport { TerminalNode } from \"antlr4ts/tree/TerminalNode\";\nimport { Token } from \"antlr4ts/Token\";\nimport { TokenStream } from \"antlr4ts/TokenStream\";\nimport { Vocabulary } from \"antlr4ts/Vocabulary\";\nimport { VocabularyImpl } from \"antlr4ts/VocabularyImpl\";\n\nimport * as Utils from \"antlr4ts/misc/Utils\";\n\nimport { SimpleBooleanListener } from \"./SimpleBooleanListener\";\nimport { SimpleBooleanVisitor } from \"./SimpleBooleanVisitor\";\n\n\nexport class SimpleBooleanParser extends Parser {\n\tpublic static readonly AND = 1;\n\tpublic static readonly OR = 2;\n\tpublic static readonly NOT = 3;\n\tpublic static readonly TRUE = 4;\n\tpublic static readonly FALSE = 5;\n\tpublic static readonly GT = 6;\n\tpublic static readonly GE = 7;\n\tpublic static readonly LT = 8;\n\tpublic static readonly LE = 9;\n\tpublic static readonly EQ = 10;\n\tpublic static readonly LPAREN = 11;\n\tpublic static readonly RPAREN = 12;\n\tpublic static readonly DECIMAL = 13;\n\tpublic static readonly IDENTIFIER = 14;\n\tpublic static readonly WS = 15;\n\tpublic static readonly RULE_parse = 0;\n\tpublic static readonly RULE_expression = 1;\n\tpublic static readonly RULE_expressionAnd = 2;\n\tpublic static readonly RULE_expressionSimple = 3;\n\tpublic static readonly RULE_numExpression = 4;\n\tpublic static readonly RULE_comparator = 5;\n\t// tslint:disable:no-trailing-whitespace\n\tpublic static readonly ruleNames: string[] = [\n\t\t\"parse\", \"expression\", \"expressionAnd\", \"expressionSimple\", \"numExpression\", \n\t\t\"comparator\",\n\t];\n\n\tprivate static readonly _LITERAL_NAMES: Array<string | undefined> = [\n\t\tundefined, \"'AND'\", \"'OR'\", \"'NOT'\", \"'TRUE'\", \"'FALSE'\", \"'>'\", \"'>='\", \n\t\t\"'<'\", \"'<='\", \"'='\", \"'('\", \"')'\",\n\t];\n\tprivate static readonly _SYMBOLIC_NAMES: Array<string | undefined> = [\n\t\tundefined, \"AND\", \"OR\", \"NOT\", \"TRUE\", \"FALSE\", \"GT\", \"GE\", \"LT\", \"LE\", \n\t\t\"EQ\", \"LPAREN\", \"RPAREN\", \"DECIMAL\", \"IDENTIFIER\", \"WS\",\n\t];\n\tpublic static readonly VOCABULARY: Vocabulary = new VocabularyImpl(SimpleBooleanParser._LITERAL_NAMES, SimpleBooleanParser._SYMBOLIC_NAMES, []);\n\n\t// @Override\n\t// @NotNull\n\tpublic get vocabulary(): Vocabulary {\n\t\treturn SimpleBooleanParser.VOCABULARY;\n\t}\n\t// tslint:enable:no-trailing-whitespace\n\n\t// @Override\n\tpublic get grammarFileName(): string { return \"SimpleBoolean.g4\"; }\n\n\t// @Override\n\tpublic get ruleNames(): string[] { return SimpleBooleanParser.ruleNames; }\n\n\t// @Override\n\tpublic get serializedATN(): string { return SimpleBooleanParser._serializedATN; }\n\n\tconstructor(input: TokenStream) {\n\t\tsuper(input);\n\t\tthis._interp = new ParserATNSimulator(SimpleBooleanParser._ATN, this);\n\t}\n\t// @RuleVersion(0)\n\tpublic parse(): ParseContext {\n\t\tlet _localctx: ParseContext = new ParseContext(this._ctx, this.state);\n\t\tthis.enterRule(_localctx, 0, SimpleBooleanParser.RULE_parse);\n\t\ttry {\n\t\t\tthis.enterOuterAlt(_localctx, 1);\n\t\t\t{\n\t\t\tthis.state = 12;\n\t\t\tthis.expression();\n\t\t\tthis.state = 13;\n\t\t\tthis.match(SimpleBooleanParser.EOF);\n\t\t\t}\n\t\t}\n\t\tcatch (re) {\n\t\t\tif (re instanceof RecognitionException) {\n\t\t\t\t_localctx.exception = re;\n\t\t\t\tthis._errHandler.reportError(this, re);\n\t\t\t\tthis._errHandler.recover(this, re);\n\t\t\t} else {\n\t\t\t\tthrow re;\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tthis.exitRule();\n\t\t}\n\t\treturn _localctx;\n\t}\n\t// @RuleVersion(0)\n\tpublic expression(): ExpressionContext {\n\t\tlet _localctx: ExpressionContext = new ExpressionContext(this._ctx, this.state);\n\t\tthis.enterRule(_localctx, 2, SimpleBooleanParser.RULE_expression);\n\t\ttry {\n\t\t\tthis.state = 22;\n\t\t\tthis._errHandler.sync(this);\n\t\t\tswitch ( this.interpreter.adaptivePredict(this._input, 0, this._ctx) ) {\n\t\t\tcase 1:\n\t\t\t\t_localctx = new NotExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 1);\n\t\t\t\t{\n\t\t\t\tthis.state = 15;\n\t\t\t\tthis.match(SimpleBooleanParser.NOT);\n\t\t\t\tthis.state = 16;\n\t\t\t\tthis.expression();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\t_localctx = new OrExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 2);\n\t\t\t\t{\n\t\t\t\tthis.state = 17;\n\t\t\t\t(_localctx as OrExpressionContext)._left = this.expressionAnd();\n\t\t\t\tthis.state = 18;\n\t\t\t\tthis.match(SimpleBooleanParser.OR);\n\t\t\t\tthis.state = 19;\n\t\t\t\t(_localctx as OrExpressionContext)._right = this.expression();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 3:\n\t\t\t\t_localctx = new AndParentExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 3);\n\t\t\t\t{\n\t\t\t\tthis.state = 21;\n\t\t\t\tthis.expressionAnd();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tcatch (re) {\n\t\t\tif (re instanceof RecognitionException) {\n\t\t\t\t_localctx.exception = re;\n\t\t\t\tthis._errHandler.reportError(this, re);\n\t\t\t\tthis._errHandler.recover(this, re);\n\t\t\t} else {\n\t\t\t\tthrow re;\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tthis.exitRule();\n\t\t}\n\t\treturn _localctx;\n\t}\n\t// @RuleVersion(0)\n\tpublic expressionAnd(): ExpressionAndContext {\n\t\tlet _localctx: ExpressionAndContext = new ExpressionAndContext(this._ctx, this.state);\n\t\tthis.enterRule(_localctx, 4, SimpleBooleanParser.RULE_expressionAnd);\n\t\ttry {\n\t\t\tthis.state = 29;\n\t\t\tthis._errHandler.sync(this);\n\t\t\tswitch ( this.interpreter.adaptivePredict(this._input, 1, this._ctx) ) {\n\t\t\tcase 1:\n\t\t\t\t_localctx = new AndExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 1);\n\t\t\t\t{\n\t\t\t\tthis.state = 24;\n\t\t\t\t(_localctx as AndExpressionContext)._left = this.expressionSimple();\n\t\t\t\tthis.state = 25;\n\t\t\t\tthis.match(SimpleBooleanParser.AND);\n\t\t\t\tthis.state = 26;\n\t\t\t\t(_localctx as AndExpressionContext)._right = this.expressionAnd();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\t_localctx = new SimpleExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 2);\n\t\t\t\t{\n\t\t\t\tthis.state = 28;\n\t\t\t\tthis.expressionSimple();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tcatch (re) {\n\t\t\tif (re instanceof RecognitionException) {\n\t\t\t\t_localctx.exception = re;\n\t\t\t\tthis._errHandler.reportError(this, re);\n\t\t\t\tthis._errHandler.recover(this, re);\n\t\t\t} else {\n\t\t\t\tthrow re;\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tthis.exitRule();\n\t\t}\n\t\treturn _localctx;\n\t}\n\t// @RuleVersion(0)\n\tpublic expressionSimple(): ExpressionSimpleContext {\n\t\tlet _localctx: ExpressionSimpleContext = new ExpressionSimpleContext(this._ctx, this.state);\n\t\tthis.enterRule(_localctx, 6, SimpleBooleanParser.RULE_expressionSimple);\n\t\ttry {\n\t\t\tthis.state = 40;\n\t\t\tthis._errHandler.sync(this);\n\t\t\tswitch ( this.interpreter.adaptivePredict(this._input, 2, this._ctx) ) {\n\t\t\tcase 1:\n\t\t\t\t_localctx = new ComparatorExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 1);\n\t\t\t\t{\n\t\t\t\tthis.state = 31;\n\t\t\t\t(_localctx as ComparatorExpressionContext)._left = this.numExpression();\n\t\t\t\tthis.state = 32;\n\t\t\t\t(_localctx as ComparatorExpressionContext)._op = this.comparator();\n\t\t\t\tthis.state = 33;\n\t\t\t\t(_localctx as ComparatorExpressionContext)._right = this.numExpression();\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 2:\n\t\t\t\t_localctx = new IdentifierExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 2);\n\t\t\t\t{\n\t\t\t\tthis.state = 35;\n\t\t\t\tthis.match(SimpleBooleanParser.IDENTIFIER);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 3:\n\t\t\t\t_localctx = new ParenExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 3);\n\t\t\t\t{\n\t\t\t\tthis.state = 36;\n\t\t\t\tthis.match(SimpleBooleanParser.LPAREN);\n\t\t\t\tthis.state = 37;\n\t\t\t\tthis.expression();\n\t\t\t\tthis.state = 38;\n\t\t\t\tthis.match(SimpleBooleanParser.RPAREN);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tcatch (re) {\n\t\t\tif (re instanceof RecognitionException) {\n\t\t\t\t_localctx.exception = re;\n\t\t\t\tthis._errHandler.reportError(this, re);\n\t\t\t\tthis._errHandler.recover(this, re);\n\t\t\t} else {\n\t\t\t\tthrow re;\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tthis.exitRule();\n\t\t}\n\t\treturn _localctx;\n\t}\n\t// @RuleVersion(0)\n\tpublic numExpression(): NumExpressionContext {\n\t\tlet _localctx: NumExpressionContext = new NumExpressionContext(this._ctx, this.state);\n\t\tthis.enterRule(_localctx, 8, SimpleBooleanParser.RULE_numExpression);\n\t\ttry {\n\t\t\tthis.state = 44;\n\t\t\tthis._errHandler.sync(this);\n\t\t\tswitch (this._input.LA(1)) {\n\t\t\tcase SimpleBooleanParser.IDENTIFIER:\n\t\t\t\t_localctx = new IdentifierNumExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 1);\n\t\t\t\t{\n\t\t\t\tthis.state = 42;\n\t\t\t\tthis.match(SimpleBooleanParser.IDENTIFIER);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase SimpleBooleanParser.DECIMAL:\n\t\t\t\t_localctx = new DecimalExpressionContext(_localctx);\n\t\t\t\tthis.enterOuterAlt(_localctx, 2);\n\t\t\t\t{\n\t\t\t\tthis.state = 43;\n\t\t\t\tthis.match(SimpleBooleanParser.DECIMAL);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthrow new NoViableAltException(this);\n\t\t\t}\n\t\t}\n\t\tcatch (re) {\n\t\t\tif (re instanceof RecognitionException) {\n\t\t\t\t_localctx.exception = re;\n\t\t\t\tthis._errHandler.reportError(this, re);\n\t\t\t\tthis._errHandler.recover(this, re);\n\t\t\t} else {\n\t\t\t\tthrow re;\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tthis.exitRule();\n\t\t}\n\t\treturn _localctx;\n\t}\n\t// @RuleVersion(0)\n\tpublic comparator(): ComparatorContext {\n\t\tlet _localctx: ComparatorContext = new ComparatorContext(this._ctx, this.state);\n\t\tthis.enterRule(_localctx, 10, SimpleBooleanParser.RULE_comparator);\n\t\tlet _la: number;\n\t\ttry {\n\t\t\tthis.enterOuterAlt(_localctx, 1);\n\t\t\t{\n\t\t\tthis.state = 46;\n\t\t\t_la = this._input.LA(1);\n\t\t\tif (!((((_la) & ~0x1F) === 0 && ((1 << _la) & ((1 << SimpleBooleanParser.GT) | (1 << SimpleBooleanParser.GE) | (1 << SimpleBooleanParser.LT) | (1 << SimpleBooleanParser.LE) | (1 << SimpleBooleanParser.EQ))) !== 0))) {\n\t\t\tthis._errHandler.recoverInline(this);\n\t\t\t} else {\n\t\t\t\tif (this._input.LA(1) === Token.EOF) {\n\t\t\t\t\tthis.matchedEOF = true;\n\t\t\t\t}\n\n\t\t\t\tthis._errHandler.reportMatch(this);\n\t\t\t\tthis.consume();\n\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcatch (re) {\n\t\t\tif (re instanceof RecognitionException) {\n\t\t\t\t_localctx.exception = re;\n\t\t\t\tthis._errHandler.reportError(this, re);\n\t\t\t\tthis._errHandler.recover(this, re);\n\t\t\t} else {\n\t\t\t\tthrow re;\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tthis.exitRule();\n\t\t}\n\t\treturn _localctx;\n\t}\n\n\tpublic static readonly _serializedATN: string =\n\t\t\"\\x03\\uC91D\\uCABA\\u058D\\uAFBA\\u4F53\\u0607\\uEA8B\\uC241\\x03\\x113\\x04\\x02\" +\n\t\t\"\\t\\x02\\x04\\x03\\t\\x03\\x04\\x04\\t\\x04\\x04\\x05\\t\\x05\\x04\\x06\\t\\x06\\x04\\x07\" +\n\t\t\"\\t\\x07\\x03\\x02\\x03\\x02\\x03\\x02\\x03\\x03\\x03\\x03\\x03\\x03\\x03\\x03\\x03\\x03\" +\n\t\t\"\\x03\\x03\\x03\\x03\\x05\\x03\\x19\\n\\x03\\x03\\x04\\x03\\x04\\x03\\x04\\x03\\x04\\x03\" +\n\t\t\"\\x04\\x05\\x04 \\n\\x04\\x03\\x05\\x03\\x05\\x03\\x05\\x03\\x05\\x03\\x05\\x03\\x05\\x03\" +\n\t\t\"\\x05\\x03\\x05\\x03\\x05\\x05\\x05+\\n\\x05\\x03\\x06\\x03\\x06\\x05\\x06/\\n\\x06\\x03\" +\n\t\t\"\\x07\\x03\\x07\\x03\\x07\\x02\\x02\\x02\\b\\x02\\x02\\x04\\x02\\x06\\x02\\b\\x02\\n\\x02\" +\n\t\t\"\\f\\x02\\x02\\x03\\x03\\x02\\b\\f\\x022\\x02\\x0E\\x03\\x02\\x02\\x02\\x04\\x18\\x03\\x02\" +\n\t\t\"\\x02\\x02\\x06\\x1F\\x03\\x02\\x02\\x02\\b*\\x03\\x02\\x02\\x02\\n.\\x03\\x02\\x02\\x02\" +\n\t\t\"\\f0\\x03\\x02\\x02\\x02\\x0E\\x0F\\x05\\x04\\x03\\x02\\x0F\\x10\\x07\\x02\\x02\\x03\\x10\" +\n\t\t\"\\x03\\x03\\x02\\x02\\x02\\x11\\x12\\x07\\x05\\x02\\x02\\x12\\x19\\x05\\x04\\x03\\x02\\x13\" +\n\t\t\"\\x14\\x05\\x06\\x04\\x02\\x14\\x15\\x07\\x04\\x02\\x02\\x15\\x16\\x05\\x04\\x03\\x02\\x16\" +\n\t\t\"\\x19\\x03\\x02\\x02\\x02\\x17\\x19\\x05\\x06\\x04\\x02\\x18\\x11\\x03\\x02\\x02\\x02\\x18\" +\n\t\t\"\\x13\\x03\\x02\\x02\\x02\\x18\\x17\\x03\\x02\\x02\\x02\\x19\\x05\\x03\\x02\\x02\\x02\\x1A\" +\n\t\t\"\\x1B\\x05\\b\\x05\\x02\\x1B\\x1C\\x07\\x03\\x02\\x02\\x1C\\x1D\\x05\\x06\\x04\\x02\\x1D\" +\n\t\t\" \\x03\\x02\\x02\\x02\\x1E \\x05\\b\\x05\\x02\\x1F\\x1A\\x03\\x02\\x02\\x02\\x1F\\x1E\\x03\" +\n\t\t\"\\x02\\x02\\x02 \\x07\\x03\\x02\\x02\\x02!\\\"\\x05\\n\\x06\\x02\\\"#\\x05\\f\\x07\\x02#$\" +\n\t\t\"\\x05\\n\\x06\\x02$+\\x03\\x02\\x02\\x02%+\\x07\\x10\\x02\\x02&\\'\\x07\\r\\x02\\x02\\'\" +\n\t\t\"(\\x05\\x04\\x03\\x02()\\x07\\x0E\\x02\\x02)+\\x03\\x02\\x02\\x02*!\\x03\\x02\\x02\\x02\" +\n\t\t\"*%\\x03\\x02\\x02\\x02*&\\x03\\x02\\x02\\x02+\\t\\x03\\x02\\x02\\x02,/\\x07\\x10\\x02\" +\n\t\t\"\\x02-/\\x07\\x0F\\x02\\x02.,\\x03\\x02\\x02\\x02.-\\x03\\x02\\x02\\x02/\\v\\x03\\x02\" +\n\t\t\"\\x02\\x0201\\t\\x02\\x02\\x021\\r\\x03\\x02\\x02\\x02\\x06\\x18\\x1F*.\";\n\tpublic static __ATN: ATN;\n\tpublic static get _ATN(): ATN {\n\t\tif (!SimpleBooleanParser.__ATN) {\n\t\t\tSimpleBooleanParser.__ATN = new ATNDeserializer().deserialize(Utils.toCharArray(SimpleBooleanParser._serializedATN));\n\t\t}\n\n\t\treturn SimpleBooleanParser.__ATN;\n\t}\n\n}\n\nexport class ParseContext extends ParserRuleContext {\n\tpublic expression(): ExpressionContext {\n\t\treturn this.getRuleContext(0, ExpressionContext);\n\t}\n\tpublic EOF(): TerminalNode { return this.getToken(SimpleBooleanParser.EOF, 0); }\n\tconstructor(parent: ParserRuleContext | undefined, invokingState: number) {\n\t\tsuper(parent, invokingState);\n\t}\n\t// @Override\n\tpublic get ruleIndex(): number { return SimpleBooleanParser.RULE_parse; }\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterParse) {\n\t\t\tlistener.enterParse(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitParse) {\n\t\t\tlistener.exitParse(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitParse) {\n\t\t\treturn visitor.visitParse(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\n\n\nexport class ExpressionContext extends ParserRuleContext {\n\tconstructor(parent: ParserRuleContext | undefined, invokingState: number) {\n\t\tsuper(parent, invokingState);\n\t}\n\t// @Override\n\tpublic get ruleIndex(): number { return SimpleBooleanParser.RULE_expression; }\n\tpublic copyFrom(ctx: ExpressionContext): void {\n\t\tsuper.copyFrom(ctx);\n\t}\n}\nexport class NotExpressionContext extends ExpressionContext {\n\tpublic NOT(): TerminalNode { return this.getToken(SimpleBooleanParser.NOT, 0); }\n\tpublic expression(): ExpressionContext {\n\t\treturn this.getRuleContext(0, ExpressionContext);\n\t}\n\tconstructor(ctx: ExpressionContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterNotExpression) {\n\t\t\tlistener.enterNotExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitNotExpression) {\n\t\t\tlistener.exitNotExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitNotExpression) {\n\t\t\treturn visitor.visitNotExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\nexport class OrExpressionContext extends ExpressionContext {\n\tpublic _left: ExpressionAndContext;\n\tpublic _right: ExpressionContext;\n\tpublic OR(): TerminalNode { return this.getToken(SimpleBooleanParser.OR, 0); }\n\tpublic expressionAnd(): ExpressionAndContext {\n\t\treturn this.getRuleContext(0, ExpressionAndContext);\n\t}\n\tpublic expression(): ExpressionContext {\n\t\treturn this.getRuleContext(0, ExpressionContext);\n\t}\n\tconstructor(ctx: ExpressionContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterOrExpression) {\n\t\t\tlistener.enterOrExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitOrExpression) {\n\t\t\tlistener.exitOrExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitOrExpression) {\n\t\t\treturn visitor.visitOrExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\nexport class AndParentExpressionContext extends ExpressionContext {\n\tpublic expressionAnd(): ExpressionAndContext {\n\t\treturn this.getRuleContext(0, ExpressionAndContext);\n\t}\n\tconstructor(ctx: ExpressionContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterAndParentExpression) {\n\t\t\tlistener.enterAndParentExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitAndParentExpression) {\n\t\t\tlistener.exitAndParentExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitAndParentExpression) {\n\t\t\treturn visitor.visitAndParentExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\n\n\nexport class ExpressionAndContext extends ParserRuleContext {\n\tconstructor(parent: ParserRuleContext | undefined, invokingState: number) {\n\t\tsuper(parent, invokingState);\n\t}\n\t// @Override\n\tpublic get ruleIndex(): number { return SimpleBooleanParser.RULE_expressionAnd; }\n\tpublic copyFrom(ctx: ExpressionAndContext): void {\n\t\tsuper.copyFrom(ctx);\n\t}\n}\nexport class AndExpressionContext extends ExpressionAndContext {\n\tpublic _left: ExpressionSimpleContext;\n\tpublic _right: ExpressionAndContext;\n\tpublic AND(): TerminalNode { return this.getToken(SimpleBooleanParser.AND, 0); }\n\tpublic expressionSimple(): ExpressionSimpleContext {\n\t\treturn this.getRuleContext(0, ExpressionSimpleContext);\n\t}\n\tpublic expressionAnd(): ExpressionAndContext {\n\t\treturn this.getRuleContext(0, ExpressionAndContext);\n\t}\n\tconstructor(ctx: ExpressionAndContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterAndExpression) {\n\t\t\tlistener.enterAndExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitAndExpression) {\n\t\t\tlistener.exitAndExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitAndExpression) {\n\t\t\treturn visitor.visitAndExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\nexport class SimpleExpressionContext extends ExpressionAndContext {\n\tpublic expressionSimple(): ExpressionSimpleContext {\n\t\treturn this.getRuleContext(0, ExpressionSimpleContext);\n\t}\n\tconstructor(ctx: ExpressionAndContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterSimpleExpression) {\n\t\t\tlistener.enterSimpleExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitSimpleExpression) {\n\t\t\tlistener.exitSimpleExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitSimpleExpression) {\n\t\t\treturn visitor.visitSimpleExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\n\n\nexport class ExpressionSimpleContext extends ParserRuleContext {\n\tconstructor(parent: ParserRuleContext | undefined, invokingState: number) {\n\t\tsuper(parent, invokingState);\n\t}\n\t// @Override\n\tpublic get ruleIndex(): number { return SimpleBooleanParser.RULE_expressionSimple; }\n\tpublic copyFrom(ctx: ExpressionSimpleContext): void {\n\t\tsuper.copyFrom(ctx);\n\t}\n}\nexport class ComparatorExpressionContext extends ExpressionSimpleContext {\n\tpublic _left: NumExpressionContext;\n\tpublic _op: ComparatorContext;\n\tpublic _right: NumExpressionContext;\n\tpublic numExpression(): NumExpressionContext[];\n\tpublic numExpression(i: number): NumExpressionContext;\n\tpublic numExpression(i?: number): NumExpressionContext | NumExpressionContext[] {\n\t\tif (i === undefined) {\n\t\t\treturn this.getRuleContexts(NumExpressionContext);\n\t\t} else {\n\t\t\treturn this.getRuleContext(i, NumExpressionContext);\n\t\t}\n\t}\n\tpublic comparator(): ComparatorContext {\n\t\treturn this.getRuleContext(0, ComparatorContext);\n\t}\n\tconstructor(ctx: ExpressionSimpleContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterComparatorExpression) {\n\t\t\tlistener.enterComparatorExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitComparatorExpression) {\n\t\t\tlistener.exitComparatorExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitComparatorExpression) {\n\t\t\treturn visitor.visitComparatorExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\nexport class IdentifierExpressionContext extends ExpressionSimpleContext {\n\tpublic IDENTIFIER(): TerminalNode { return this.getToken(SimpleBooleanParser.IDENTIFIER, 0); }\n\tconstructor(ctx: ExpressionSimpleContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterIdentifierExpression) {\n\t\t\tlistener.enterIdentifierExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitIdentifierExpression) {\n\t\t\tlistener.exitIdentifierExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitIdentifierExpression) {\n\t\t\treturn visitor.visitIdentifierExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\nexport class ParenExpressionContext extends ExpressionSimpleContext {\n\tpublic LPAREN(): TerminalNode { return this.getToken(SimpleBooleanParser.LPAREN, 0); }\n\tpublic expression(): ExpressionContext {\n\t\treturn this.getRuleContext(0, ExpressionContext);\n\t}\n\tpublic RPAREN(): TerminalNode { return this.getToken(SimpleBooleanParser.RPAREN, 0); }\n\tconstructor(ctx: ExpressionSimpleContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterParenExpression) {\n\t\t\tlistener.enterParenExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitParenExpression) {\n\t\t\tlistener.exitParenExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitParenExpression) {\n\t\t\treturn visitor.visitParenExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\n\n\nexport class NumExpressionContext extends ParserRuleContext {\n\tconstructor(parent: ParserRuleContext | undefined, invokingState: number) {\n\t\tsuper(parent, invokingState);\n\t}\n\t// @Override\n\tpublic get ruleIndex(): number { return SimpleBooleanParser.RULE_numExpression; }\n\tpublic copyFrom(ctx: NumExpressionContext): void {\n\t\tsuper.copyFrom(ctx);\n\t}\n}\nexport class IdentifierNumExpressionContext extends NumExpressionContext {\n\tpublic IDENTIFIER(): TerminalNode { return this.getToken(SimpleBooleanParser.IDENTIFIER, 0); }\n\tconstructor(ctx: NumExpressionContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterIdentifierNumExpression) {\n\t\t\tlistener.enterIdentifierNumExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitIdentifierNumExpression) {\n\t\t\tlistener.exitIdentifierNumExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitIdentifierNumExpression) {\n\t\t\treturn visitor.visitIdentifierNumExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\nexport class DecimalExpressionContext extends NumExpressionContext {\n\tpublic DECIMAL(): TerminalNode { return this.getToken(SimpleBooleanParser.DECIMAL, 0); }\n\tconstructor(ctx: NumExpressionContext) {\n\t\tsuper(ctx.parent, ctx.invokingState);\n\t\tthis.copyFrom(ctx);\n\t}\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterDecimalExpression) {\n\t\t\tlistener.enterDecimalExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitDecimalExpression) {\n\t\t\tlistener.exitDecimalExpression(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitDecimalExpression) {\n\t\t\treturn visitor.visitDecimalExpression(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\n\n\nexport class ComparatorContext extends ParserRuleContext {\n\tpublic GT(): TerminalNode | undefined { return this.tryGetToken(SimpleBooleanParser.GT, 0); }\n\tpublic GE(): TerminalNode | undefined { return this.tryGetToken(SimpleBooleanParser.GE, 0); }\n\tpublic LT(): TerminalNode | undefined { return this.tryGetToken(SimpleBooleanParser.LT, 0); }\n\tpublic LE(): TerminalNode | undefined { return this.tryGetToken(SimpleBooleanParser.LE, 0); }\n\tpublic EQ(): TerminalNode | undefined { return this.tryGetToken(SimpleBooleanParser.EQ, 0); }\n\tconstructor(parent: ParserRuleContext | undefined, invokingState: number) {\n\t\tsuper(parent, invokingState);\n\t}\n\t// @Override\n\tpublic get ruleIndex(): number { return SimpleBooleanParser.RULE_comparator; }\n\t// @Override\n\tpublic enterRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.enterComparator) {\n\t\t\tlistener.enterComparator(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic exitRule(listener: SimpleBooleanListener): void {\n\t\tif (listener.exitComparator) {\n\t\t\tlistener.exitComparator(this);\n\t\t}\n\t}\n\t// @Override\n\tpublic accept<Result>(visitor: SimpleBooleanVisitor<Result>): Result {\n\t\tif (visitor.visitComparator) {\n\t\t\treturn visitor.visitComparator(this);\n\t\t} else {\n\t\t\treturn visitor.visitChildren(this);\n\t\t}\n\t}\n}\n\n\n","import { CharStreams, CommonTokenStream } from \"antlr4ts\";\nimport { SimpleBooleanLexer } from \"../grammar/SimpleBooleanLexer\";\nimport {\n  ExpressionContext,\n  IdentifierExpressionContext,\n  IdentifierNumExpressionContext,\n  SimpleBooleanParser,\n} from \"../grammar/SimpleBooleanParser\";\nimport { SimpleBooleanVisitor } from \"../grammar/SimpleBooleanVisitor\";\nimport { AbstractParseTreeVisitor } from \"antlr4ts/tree/AbstractParseTreeVisitor\";\nimport { ErrorNode } from \"antlr4ts/tree/ErrorNode\";\nimport { ParseTree } from \"antlr4ts/tree/ParseTree\";\n\n// Extend the AbstractParseTreeVisitor to get default visitor behaviour\nclass ErrorVisitor\n  extends AbstractParseTreeVisitor<string[]>\n  implements SimpleBooleanVisitor<string[]> {\n  isInvalid: boolean = false;\n  constructor(public signals: { numSignals: string[]; boolSignals: string[] }) {\n    super();\n  }\n\n  defaultResult() {\n    return [];\n  }\n\n  aggregateResult(aggregate: string[], nextResult: string[]) {\n    return aggregate.concat(nextResult);\n  }\n\n  visitErrorNode(node: ErrorNode): string[] {\n    if (this.isInvalid) {\n      return [];\n    }\n    this.isInvalid = true;\n    return [\"Invalid boolean expression\"];\n  }\n\n  visitIdentifierExpression(n: IdentifierExpressionContext): string[] {\n    const valid = this.signals.boolSignals.includes(n.text);\n    return valid ? [] : [`'${n.text}' is not a defined boolean signal`];\n  }\n\n  visitIdentifierNumExpression(n: IdentifierNumExpressionContext): string[] {\n    const valid = this.signals.numSignals.includes(n.text);\n    return valid ? [] : [`'${n.text}' is not a defined numeric signal`];\n  }\n\n  visitExpression(n: ExpressionContext): string[] {\n    console.log(\"Dddddddddddddddddddddd\");\n    if (n.exception !== undefined && !this.isInvalid) {\n      this.isInvalid = true;\n      return [\"Invalid boolean expression\"];\n    }\n    return [];\n  }\n}\n\nexport const parseBoolExpression = (\n  text: string,\n  signals: { numSignals: string[]; boolSignals: string[] }\n): { tree: ExpressionContext; errors: string[] } => {\n  // Create the lexer and parser\n  let inputStream = CharStreams.fromString(text);\n  let lexer = new SimpleBooleanLexer(inputStream);\n  let tokenStream = new CommonTokenStream(lexer);\n  let parser = new SimpleBooleanParser(tokenStream);\n\n  // Parse the input, where `compilationUnit` is whatever entry point you defined\n\n  let tree = parser.parse();\n\n  // Create the visitor\n  const countFunctionsVisitor = new ErrorVisitor(signals);\n  // Use the visitor entry point\n  const errors = countFunctionsVisitor.visit(tree);\n\n  if (tree.exception !== undefined) {\n    countFunctionsVisitor.isInvalid = true;\n    errors.push(\"Invalid boolean expression\");\n  }\n\n  let toProcess: ParseTree[] | undefined = tree.children;\n  if (toProcess !== undefined && !countFunctionsVisitor.isInvalid) {\n    while (toProcess.length !== 0) {\n      const curr: ParseTree | undefined = toProcess.pop()!;\n      if (curr instanceof ExpressionContext && curr.exception !== undefined) {\n        errors.push(\"Invalid boolean expression\");\n        break;\n      } else if (curr.childCount > 0) {\n        toProcess = toProcess.concat(\n          [...Array(curr.childCount).keys()].map((i) => curr.getChild(i))\n        );\n      }\n    }\n  }\n  return { tree, errors };\n};\n","import Switch from \"@material-ui/core/Switch\";\nimport { action, computed, observable } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport React, { useRef } from \"react\";\nimport { JsonType } from \"../canvas/store\";\nimport { FieldSpec, StrFieldSpec } from \"../fields\";\nimport { ChoiceField } from \"../fields/choice-field\";\nimport { ConnModel } from \"../node/node-model\";\nimport { PropertiesTable } from \"../properties/properties-table\";\nimport { parseBoolExpression } from \"./antlr_parser\";\nimport { CustomToken, getCustomTokens, VarId } from \"./custom_parser\";\nimport { GemmaGrafcet } from \"./gemma\";\nimport { Step, StepType } from \"./step\";\n\ntype GemmaConn = ConnModel<Step, GemmaGrafcet, Transition>;\n\nexport class Transition {\n  @observable\n  conditionExpression: string;\n  @observable\n  priority: number;\n  @observable\n  isNegated: boolean;\n  @computed\n  get priorityChoices() {\n    return [...Array(this.connection.from.outputs.length)].map(\n      (_, i) => \"\" + (i + 1)\n    );\n  }\n\n  errors = observable.map<string, string>();\n\n  spec: { [key: string]: FieldSpec } = {\n    conditionExpression: new StrFieldSpec({ default: \"\" }),\n  };\n\n  constructor(\n    private connection: GemmaConn,\n    d?: {\n      conditionExpression?: string;\n      priority?: number;\n      isNegated?: boolean;\n    }\n  ) {\n    this.conditionExpression = d?.conditionExpression ?? \"\";\n    this.priority = d?.priority ?? connection.from.outputs.length + 1;\n    this.isNegated = d?.isNegated ?? false;\n  }\n\n  @action.bound\n  setPriority = (v: string): void => {\n    const priority = parseInt(v);\n    if (this.priority === priority) {\n      return;\n    }\n    const transitions = this.connection.from.outputs;\n    if (this.priority > priority) {\n      transitions\n        .filter(\n          (t) => t.data.priority >= priority && t.data.priority < this.priority\n        )\n        .forEach((t) => t.data.priority++);\n    } else {\n      transitions\n        .filter(\n          (t) => t.data.priority <= priority && t.data.priority > this.priority\n        )\n        .forEach((t) => t.data.priority--);\n    }\n    this.priority = priority;\n  };\n\n  get from(): Step {\n    return this.connection.from.data;\n  }\n\n  get to(): Step {\n    return this.connection.to.data;\n  }\n\n  @computed\n  get connectionText(): string {\n    const cond = this.conditionExpression.substring(0, 20);\n    const negation =\n      this.isNegated &&\n      (this.from.type === StepType.MACRO ||\n        this.from.type === StepType.ENCLOSING)\n        ? \"\\u00AF\"\n        : \"\";\n    return `${\n      this.from.type === StepType.CONTAINER\n        ? \"\"\n        : `${this.priority}${negation}:`\n    }${cond}${this.conditionExpression.length > 20 ? \"...\" : \"\"}`;\n  }\n\n  @computed\n  get toJson(): JsonType {\n    return {\n      conditionExpression: this.conditionExpression,\n      priority: this.priority,\n      isNegated: this.isNegated,\n    };\n  }\n\n  @computed\n  get expressionTokens(): [CustomToken, number][] {\n    return getCustomTokens(this.conditionExpression);\n  }\n\n  @computed\n  get expressionErrors(): string[] {\n    const gemma = this.connection.graph.globalData;\n    try {\n      const { errors } = parseBoolExpression(this.conditionExpression, {\n        boolSignals: gemma.boolSignals.map((s) => s.name),\n        numSignals: gemma.numSignals.map((s) => s.name),\n      });\n      return errors;\n    } catch (e) {}\n    return [];\n  }\n\n  ConnectionView = observer(() => {\n    return (\n      <>\n        <PropertiesTable key=\"table\">\n          <tr key=\"priority\">\n            <td>Priority</td>\n            <td>\n              <ChoiceField\n                keys={this.priorityChoices}\n                value={\"\" + this.priority}\n                setValue={this.setPriority}\n              />\n            </td>\n          </tr>\n          <tr key=\"condition\">\n            <td>Condition</td>\n            <td>{<ConditionInput m={this} />}</td>\n          </tr>\n          {(this.from.type === StepType.MACRO ||\n            this.from.type === StepType.ENCLOSING) && (\n            <tr key=\"isNegated\">\n              <td>Negated</td>\n              <td>\n                {\n                  <Switch\n                    checked={this.isNegated}\n                    onChange={() => {\n                      this.isNegated = !this.isNegated;\n                    }}\n                    color=\"primary\"\n                  />\n                }\n              </td>\n            </tr>\n          )}\n        </PropertiesTable>\n        <div>\n          <h4 style={{ margin: \"0\" }}>Errors</h4>\n          {this.expressionErrors.length === 0 && \"No errors\"}\n          <ul style={{ color: \"indianred\", marginTop: \"0\" }} key=\"errors\">\n            {this.expressionErrors.map((err, index) => (\n              <li key={index}>{err}</li>\n            ))}\n          </ul>\n        </div>\n      </>\n    );\n  });\n}\n\nconst ConditionInput = observer(\n  ({\n    m,\n  }: {\n    m: {\n      conditionExpression: string;\n      expressionTokens: [CustomToken, number][];\n    };\n  }) => {\n    let prevIndex = 0;\n    let _spanStyleRef = useRef<HTMLSpanElement>(null);\n    const font = \"400 15px monospace\";\n\n    return (\n      <div style={{ width: \"180px\", position: \"relative\" }} className=\"center\">\n        <span\n          style={{\n            font,\n            position: \"absolute\",\n            top: 0,\n            padding: \"3px\",\n            textAlign: \"initial\",\n            whiteSpace: \"pre-line\",\n          }}\n          ref={_spanStyleRef}\n        >\n          {m.expressionTokens.map(([c, textIndex], index) => {\n            let color: string;\n            if (c instanceof VarId) {\n              color = \"black\";\n            } else if ([\"AND\", \"NOT\", \"OR\"].includes(c)) {\n              color = \"blue\";\n            } else {\n              color = \"brown\";\n            }\n            const whiteSpace = textIndex - prevIndex;\n            const text = \" \".repeat(whiteSpace) + c.toString();\n            prevIndex = textIndex + c.toString().length;\n            return (\n              <span key={index} style={{ color }}>\n                {text}\n              </span>\n            );\n          })}\n        </span>\n        <textarea\n          onScroll={(s) => {\n            _spanStyleRef.current!.scrollTo(0, s.currentTarget.scrollTop);\n          }}\n          className=\"multiline-input\"\n          style={{\n            font,\n            background: \"transparent\",\n            color: \"transparent\",\n            caretColor: \"black\",\n            position: \"relative\",\n          }}\n          spellCheck={false}\n          value={m.conditionExpression}\n          onChange={(e) => {\n            m.conditionExpression = e.currentTarget.value;\n          }}\n        ></textarea>\n      </div>\n    );\n  }\n);\n","\nexport abstract class SourceItem {\n  constructor(public name: string) {}\n\n  when(f: {file: (f: SourceFile) => void, dir: (f: SourceDirectory) => void}) {\n    if (this instanceof SourceFile) {\n      f.file(this)\n    } else if (this instanceof SourceDirectory) {\n      f.dir(this)\n    }\n  }\n}\n\nexport class SourceFile extends SourceItem {\n  constructor(name: string, public content: string) {\n    super(name);\n  }\n}\n\nexport class SourceDirectory extends SourceItem {\n  constructor(name: string, public items: SourceItem[]) {\n    super(name);\n  }\n}\n","import { MacroStep } from \"./step\";\n\nexport const macroStepTemplate = (model: MacroStep) =>\n  `\\\nFUNCTION_BLOCK ${model.name}_FB\n\n// Variable declaration\nVAR_INPUT\n  Initialization:BOOL;\nEND_VAR\n\nVAR_OUTPUT\n  Complete:BOOL;\nEND_VAR\n\n// FB behavior\nIF Initialization THEN\n  Complete:=FALSE;\n  //Initialization actions\n\nEND_IF\n\n//Nested behavior\n\n//Termination of the nested behavior\nComplete:=TRUE;\n`;\n","import { observer } from \"mobx-react-lite\";\nimport React from \"react\";\nimport Draggable, { DraggableData, DraggableEvent } from \"react-draggable\";\nimport styled from \"styled-components\";\nimport { NodeModel } from \"./node-model\";\nimport { useStore } from \"../App\";\n\nexport type Shape = (number | undefined)[];\n\nconst StyledNode = styled.div`\n  z-index: 1;\n  cursor: pointer;\n  position: absolute;\n  box-shadow: 0 1px 4px 1px #eee;\n  background: #fff;\n  border-radius: 6;\n  border: 1.5px solid;\n`;\n\ntype NodeViewProps = { node: NodeModel<any, any, any> };\nexport const NodeView: React.FC<NodeViewProps> = observer((params) => {\n  const { node, children } = params;\n  const rootStore = useStore();\n  const onDrag = React.useCallback(\n    (_: DraggableEvent, data: DraggableData) => {\n      node.move(data.deltaX, data.deltaY);\n    },\n    [node]\n  );\n  const selectingInput = rootStore.selectingInputFor !== undefined;\n  const isValidInput =\n    selectingInput && rootStore.selectingInputFor!.data.isValidInput(node);\n  const isSelected = rootStore.selectedNode === node;\n\n  const onClick = React.useCallback(\n    (_: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n      console.log(node);\n      if (selectingInput) {\n        if (isValidInput) {\n          rootStore.assignInput(node);\n        }\n      } else {\n        rootStore.selectNode(node);\n      }\n    },\n    [rootStore, node, selectingInput, isValidInput]\n  );\n  // const [_, setDivRef] = React.useState<HTMLDivElement | null>(null);\n  const { x, y } = node;\n\n  let style: React.CSSProperties = {};\n  if (isSelected) {\n    style[\"boxShadow\"] = \"rgb(110 110 110) 1px 1.5px 3px 1px\";\n  }\n  if (selectingInput) {\n    style[\"cursor\"] = isValidInput ? \"pointer\" : \"not-allowed\";\n  }\n  if (node.isHidden) {\n    style[\"opacity\"] = 0.1;\n  }\n\n  return (\n    <Draggable\n      onDrag={onDrag}\n      position={{\n        // TODO: improve x, y with support for nested children\n        x: x - (node.data.parent?.x ?? 0),\n        y: y - (node.data.parent?.y ?? 0),\n      }}\n      bounds=\"parent\"\n    >\n      <StyledNode\n        ref={(e) => {\n          if (e === null) return;\n          node.setElement(e);\n        }}\n        onClick={onClick}\n        style={style}\n      >\n        <node.data.View children={children} />\n      </StyledNode>\n    </Draggable>\n  );\n});\n","import { templateGemmaGrafcet, templateGlobals } from \"./gemma-templates\";\nimport {\n  GlobalData,\n  RootStoreModel,\n  DataBuilder,\n  JsonType,\n} from \"../canvas/store\";\nimport { action, computed, IObservableArray, observable } from \"mobx\";\nimport { observer } from \"mobx-react-lite\";\nimport React, { useState } from \"react\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Button from \"@material-ui/core/Button\";\nimport { ChoiceField } from \"../fields/choice-field\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport IconButton from \"@material-ui/core/IconButton\";\nimport { Transition } from \"./transition\";\nimport { Step, StepType, ProcedureType, BaseStep } from \"./step\";\nimport { NodeModel } from \"../node/node-model\";\nimport { IndexedDB } from \"../canvas/persistence\";\nimport Table from \"@material-ui/core/Table\";\nimport TableBody from \"@material-ui/core/TableBody\";\nimport TableCell from \"@material-ui/core/TableCell\";\nimport TableHead from \"@material-ui/core/TableHead\";\nimport TableRow from \"@material-ui/core/TableRow\";\nimport \"./gemma-styles.css\";\nimport { SourceDirectory, SourceFile } from \"../codegen/file-system\";\nimport { enclosingStepTemplate } from \"./enclosing-step\";\nimport { macroStepTemplate } from \"./macro-step\";\nimport { NodeView } from \"../node/node\";\nimport { Tooltip } from \"@material-ui/core\";\n\nenum SignalTypeBase {\n  bool = \"bool\",\n  int = \"int\",\n  uint = \"uint\",\n  real = \"real\",\n}\n\nenum SignalType {\n  bool = \"bool\",\n\n  sint = \"sint\",\n  int = \"int\",\n  lint = \"lint\",\n  dint = \"dint\",\n\n  usint = \"usint\",\n  uint = \"uint\",\n  ulint = \"ulint\",\n  udint = \"udint\",\n\n  real = \"real\",\n  lreal = \"lreal\",\n}\n\nenum SignalTypeSize {\n  s = \"s\",\n  i = \"i\",\n  l = \"l\",\n  d = \"d\",\n}\n\nconst signalTypeToPrimitives = (\n  type?: SignalType\n): { base: SignalTypeBase; size: SignalTypeSize } | undefined => {\n  if (type === undefined) {\n    return undefined;\n  }\n  switch (type) {\n    case SignalType.bool:\n      return { base: SignalTypeBase.bool, size: SignalTypeSize.i };\n    case SignalType.real:\n      return { base: SignalTypeBase.real, size: SignalTypeSize.i };\n    case SignalType.lreal:\n      return { base: SignalTypeBase.real, size: SignalTypeSize.l };\n  }\n  let base: SignalTypeBase;\n  let index: number;\n  if (type.startsWith(\"u\")) {\n    base = SignalTypeBase.uint;\n    index = 1;\n  } else {\n    base = SignalTypeBase.int;\n    index = 0;\n  }\n\n  const size = type.charAt(index) as SignalTypeSize;\n\n  if (!Object.keys(SignalTypeSize).includes(size)) {\n    return undefined;\n  }\n\n  return { base, size };\n};\n\nconst signalSizeMap: { [key in SignalTypeBase]: SignalTypeSize[] } = {\n  [SignalType.bool]: [SignalTypeSize.i],\n  [SignalType.int]: [...Object.keys(SignalTypeSize)] as SignalTypeSize[],\n  [SignalType.uint]: [...Object.keys(SignalTypeSize)] as SignalTypeSize[],\n  [SignalType.real]: [SignalTypeSize.i, SignalTypeSize.l],\n};\n\nexport class GemmaGrafcet implements GlobalData<Step> {\n  constructor(\n    private graph: RootStoreModel<Step, GemmaGrafcet, Transition>,\n    json?: JsonType\n  ) {\n    let signals: Signal[] = [];\n    if (Array.isArray(json?.signals)) {\n      signals = json?.signals\n        .map((s) => (typeof s === \"object\" ? Signal.fromJson(s) : undefined))\n        .filter((s) => s !== undefined) as Signal[];\n    }\n    this.signals = observable.array<Signal>(signals);\n  }\n\n  canAddNode = (nodeType: string): boolean => {\n    return true;\n  };\n\n  initState(): void {\n    const nodes = [...this.graph.nodes.values()];\n    this.fFamily =\n      nodes.find(\n        (n) =>\n          n.data.type === StepType.CONTAINER &&\n          n.data.family === ProcedureType.F\n      ) ?? this.graph.addNode(StepType.CONTAINER, { x: 600, y: 0 })!;\n    this.fFamily.setName(\"F family\");\n    this.fFamily.data.family = ProcedureType.F;\n\n    this.aFamily =\n      nodes.find(\n        (n) =>\n          n.data.type === StepType.CONTAINER &&\n          n.data.family === ProcedureType.A\n      ) ?? this.graph.addNode(StepType.CONTAINER, { x: 0, y: 0 })!;\n    this.aFamily.setName(\"A family\");\n    this.aFamily.data.family = ProcedureType.A;\n\n    this.dFamily =\n      nodes.find(\n        (n) =>\n          n.data.type === StepType.CONTAINER &&\n          n.data.family === ProcedureType.D\n      ) ?? this.graph.addNode(StepType.CONTAINER, { x: 0, y: 500 })!;\n    this.dFamily.setName(\"D family\");\n    this.dFamily.data.family = ProcedureType.D;\n  }\n\n  fFamily?: NodeModel<Step, GemmaGrafcet, Transition>;\n  aFamily?: NodeModel<Step, GemmaGrafcet, Transition>;\n  dFamily?: NodeModel<Step, GemmaGrafcet, Transition>;\n\n  private _hasInitialStep(): boolean {\n    return [...this.graph.nodes.values()].some((n) => n.data.isInitial);\n  }\n\n  @computed\n  get steps(): Step[] {\n    return [...this.graph.nodes.values()]\n      .filter((node) => !node.isHidden && node.data.type !== StepType.CONTAINER)\n      .map((node) => node.data);\n  }\n\n  readonly signals: IObservableArray<Signal>;\n\n  @computed\n  get numSignals(): Signal[] {\n    return this.signals.filter((s) => s.type !== SignalType.bool);\n  }\n\n  @computed\n  get boolSignals(): Signal[] {\n    return this.signals.filter((s) => s.type === SignalType.bool);\n  }\n\n  @computed\n  get initialStep(): Step | undefined {\n    return this.steps.find((s) => s.isInitial);\n  }\n\n  @computed\n  get generateMainFile(): string {\n    return templateGemmaGrafcet(this);\n  }\n\n  @computed\n  get generateSourceCode(): SourceDirectory {\n    const main = templateGemmaGrafcet(this);\n    const globals = templateGlobals(this.signals);\n    const files = [\n      new SourceFile(\"main.txt\", main),\n      new SourceFile(\"GVL.txt\", globals),\n    ];\n\n    for (const s of this.steps.values()) {\n      if (s.type === StepType.ENCLOSING) {\n        files.push(\n          new SourceFile(s.name + \"_FB.txt\", enclosingStepTemplate(s))\n        );\n      } else if (s.type === StepType.MACRO) {\n        files.push(new SourceFile(s.name + \"_FB.txt\", macroStepTemplate(s)));\n      }\n    }\n\n    return new SourceDirectory(\"gemma_grafcet\", files);\n  }\n\n  @computed\n  get toJson(): JsonType {\n    return {\n      signals: this.signals.map((s) => s.toJson),\n    };\n  }\n\n  View = observer(() => {\n    const [showDelete, setShowDelete] = useState(false);\n    return (\n      <div style={{ display: \"flex\", flexDirection: \"column\" }}>\n        <div\n          style={{\n            display: \"flex\",\n            flexDirection: \"row\",\n            justifyContent: \"space-between\",\n          }}\n        >\n          <h3 style={{ margin: \"5px 0 10px 5px\" }}>Signals</h3>\n          <Button onClick={(_) => setShowDelete(!showDelete)}>\n            {showDelete ? \"Hide Delete\" : \"Show Delete\"}\n            <FontAwesomeIcon\n              style={{ paddingLeft: \"7px\" }}\n              icon={\"trash-alt\"}\n              color={\"#000\"}\n            />\n          </Button>\n        </div>\n        <Table\n          id=\"signals-table\"\n          size=\"small\"\n          aria-label=\"a dense table\"\n          stickyHeader={true}\n        >\n          <TableHead>\n            <TableRow>\n              <TableCell>Name</TableCell>\n              <TableCell>Type</TableCell>\n              <TableCell>Size</TableCell>\n              <TableCell>Default</TableCell>\n              {showDelete && <TableCell>Delete</TableCell>}\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {this.signals.map((s, index) => (\n              <SignalRow\n                signal={s}\n                key={index}\n                showDelete={showDelete}\n                removeSignal={(s) => this.signals.remove(s)}\n                error={\n                  this.signals.findIndex(\n                    (s2) => s2.name === s.name && s !== s2\n                  ) !== -1\n                    ? \"Duplicate name\"\n                    : undefined\n                }\n              />\n            ))}\n          </TableBody>\n        </Table>\n        <Button\n          style={{ alignSelf: \"flex-end\" }}\n          onClick={(_) => this.signals.push(new Signal())}\n        >\n          Add Signal\n        </Button>\n      </div>\n    );\n  });\n\n  CanvasView = observer(() => {\n    const nodes = [...this.graph.nodes.values()];\n    const _nodesFromFamily = (family: ProcedureType) => {\n      return nodes\n        .filter(\n          (n) => n.data.family === family && n.data.type !== StepType.CONTAINER\n        )\n        .map((n) => {\n          return <NodeView node={n} key={n.key} />;\n        });\n    };\n\n    const _color = {\n      [ProcedureType.A]: { color: \"#ecf5ff\", size: { w: 600, h: 500 } },\n      [ProcedureType.D]: { color: \"#ffd6d6\", size: { w: 600, h: 500 } },\n      [ProcedureType.F]: { color: \"#ebffec\", size: { w: 600, h: 1000 } },\n    };\n\n    return (\n      <div style={{ width: \"100%\", height: \"100%\", position: \"absolute\" }}>\n        {nodes\n          .filter((n) => n.data.type === StepType.CONTAINER)\n          .map((n) => {\n            const _d = _color[n.data.family]!;\n            return (\n              <div\n                style={{\n                  background: _d.color,\n                  width: _d.size.w,\n                  height: _d.size.h,\n                  position: \"absolute\",\n                  top: n.y,\n                  left: n.x,\n                }}\n                key={n.key}\n                ref={(e) => {\n                  if (e === null) return;\n                  n.setSize(e.getBoundingClientRect());\n                }}\n              >\n                {_nodesFromFamily(n.data.family)}\n              </div>\n            );\n          })}\n      </div>\n    );\n  });\n}\n\nconst SignalRow = observer(\n  ({\n    signal: s,\n    showDelete,\n    removeSignal,\n    error,\n  }: {\n    signal: Signal;\n    showDelete: boolean;\n    removeSignal: (s: Signal) => void;\n    error?: string;\n  }) => (\n    <TableRow>\n      <TableCell>\n        <Tooltip title={error !== undefined ? error : \"\"}>\n          <TextField\n            type=\"text\"\n            value={s.name}\n            onChange={(e) => (s.name = e.target.value)}\n            style={{ width: \"110px\" }}\n            error={error !== undefined}\n          />\n        </Tooltip>\n      </TableCell>\n      <TableCell>\n        <ChoiceField\n          keys={Object.keys(SignalTypeBase)}\n          setValue={(v) => s.setTypeBase(v as any)}\n          value={s.typeBase}\n        />\n      </TableCell>\n      <TableCell>\n        <ChoiceField\n          keys={signalSizeMap[s.typeBase]}\n          setValue={(v) => (s.typeSize = v as any)}\n          value={s.typeSize}\n          maxButton={0}\n        />\n      </TableCell>\n      <TableCell>\n        <TextField\n          type=\"text\"\n          value={s.defaultValue}\n          onChange={(e) => {\n            s.defaultValue = e.target.value.replace(/\\s/g, \"\");\n          }}\n          style={{ width: \"80px\" }}\n          error={\n            s.didBlur\n              ? !regexSignalDefaultValid[s.typeBase].test(s.defaultValue)\n              : false\n          }\n          onBlur={(_) => (s.didBlur = true)}\n        />\n      </TableCell>\n      {showDelete && (\n        <TableCell align=\"center\">\n          <IconButton onClick={(_) => removeSignal(s)} size=\"small\">\n            <FontAwesomeIcon icon={\"trash-alt\"} color={\"#000\"} />\n          </IconButton>\n        </TableCell>\n      )}\n    </TableRow>\n  )\n);\n\nconst regexSignalDefaultValid = {\n  [SignalTypeBase.bool]: /^(TRUE|FALSE)$/,\n  [SignalTypeBase.int]: /^-?[1-9][0-9]*$/,\n  [SignalTypeBase.uint]: /^[1-9][0-9]*$/,\n  [SignalTypeBase.real]: /^-?[0-9]*\\.?[0-9]+$/,\n};\n\nexport class Signal {\n  @observable\n  didBlur: boolean = false;\n\n  @observable\n  name: string;\n  @observable\n  defaultValue: string;\n  @observable\n  typeSize: SignalTypeSize;\n  @observable\n  typeBase: SignalTypeBase;\n  @computed\n  get type(): SignalType {\n    if (this.typeBase === SignalTypeBase.bool) {\n      return SignalType.bool;\n    }\n    const sizeStr = this.typeSize === SignalTypeSize.i ? \"\" : this.typeSize!;\n    if (this.typeBase.startsWith(\"u\")) {\n      return (\"u\" + sizeStr + this.typeBase.substring(1)) as SignalType;\n    } else {\n      return (sizeStr + this.typeBase) as SignalType;\n    }\n  }\n\n  @action.bound\n  setTypeBase = (base: SignalTypeBase) => {\n    this.typeBase = base;\n    if (!signalSizeMap[base].includes(this.typeSize)) {\n      this.typeSize = signalSizeMap[base][0];\n    }\n  };\n\n  description?: string;\n\n  @computed\n  get toJson(): JsonType {\n    return {\n      name: this.name,\n      type: this.type,\n      defaultValue: this.defaultValue,\n    };\n  }\n\n  static fromJson(json: JsonType): Signal | undefined {\n    if (\n      typeof json[\"name\"] === \"string\" &&\n      Object.keys(SignalType).includes(json[\"type\"] as any)\n    ) {\n      return new Signal(json);\n    } else {\n      return undefined;\n    }\n  }\n\n  constructor(d?: {\n    name?: string;\n    description?: string;\n    type?: SignalType;\n    defaultValue?: string;\n  }) {\n    this.name = d?.name ?? \"\";\n    this.description = d?.description;\n    const typePrim = signalTypeToPrimitives(d?.type);\n    this.typeBase = typePrim?.base ?? SignalTypeBase.bool;\n    this.typeSize = typePrim?.size ?? SignalTypeSize.i;\n    this.defaultValue = d?.defaultValue ?? \"\";\n  }\n}\n\nexport const gemmaBuilders: DataBuilder<Step, GemmaGrafcet, Transition> = {\n  graphBuilder: (g, json) => new GemmaGrafcet(g, json),\n  nodeBuilder: (n, json) => {\n    console.log(json);\n    const type = json !== undefined ? json[\"type\"] : undefined;\n    if (typeof type === \"string\" && Object.keys(StepType).includes(type)) {\n      return new BaseStep(n, json);\n    }\n\n    return new BaseStep(n);\n  },\n  connectionBuilder: (c, json) => new Transition(c, json),\n};\n\nexport const make5NodesGraph = (\n  db: IndexedDB\n): RootStoreModel<Step, GemmaGrafcet, Transition> => {\n  const rootStore = new RootStoreModel<Step, GemmaGrafcet, Transition>({\n    db,\n    builders: gemmaBuilders,\n  });\n\n  const s1 = rootStore.addNode(StepType.SIMPLE, { x: 72, y: 60 });\n  if (s1 !== undefined) {\n    s1.data.isInitial = true;\n  }\n  const s2 = rootStore.addNode(StepType.MACRO, { x: 261, y: 170 });\n\n  [\n    s1,\n    s2,\n    rootStore.addNode(StepType.ENCLOSING, { x: 441, y: 316 }),\n    rootStore.addNode(StepType.SIMPLE, { x: 211, y: 410 }),\n    rootStore.addNode(StepType.SIMPLE, { x: 441, y: 500 }),\n  ].forEach((s, index) => s?.setName(`S${index + 1}`));\n\n  s1!.data.family = ProcedureType.A;\n  s2!.data.family = ProcedureType.D;\n  rootStore.selectNode(s1!);\n\n  rootStore.selectingInput(s1!);\n  const conn = rootStore.assignInput(s2!);\n\n  rootStore.selectConnection(conn);\n  rootStore.globalData.signals.push(new Signal({ name: \"\" }));\n  return rootStore;\n};\n\nexport const makeBaseGemmaTemplate = (\n  db: IndexedDB\n): RootStoreModel<Step, GemmaGrafcet, Transition> => {\n  const rootStore = new RootStoreModel<Step, GemmaGrafcet, Transition>({\n    db,\n    builders: gemmaBuilders,\n    hideOnDelete: true,\n  });\n\n  const nodesRaw: {\n    [key in ProcedureType]: {\n      [key: string]: { type: StepType; x: number; y: number };\n    };\n  } = {\n    [ProcedureType.A]: {\n      A1: { type: StepType.SIMPLE, x: 497, y: 125 },\n      A2: { type: StepType.SIMPLE, x: 260, y: 364 },\n      A3: { type: StepType.SIMPLE, x: 444, y: 400 },\n      A4: { type: StepType.SIMPLE, x: 457, y: 246 },\n      A5: { type: StepType.MACRO, x: 100, y: 301 },\n      A6: { type: StepType.SIMPLE, x: 173, y: 54 },\n      A7: { type: StepType.MACRO, x: 239, y: 176 },\n    },\n    [ProcedureType.D]: {\n      D1: { type: StepType.MACRO, x: 146, y: 767 },\n      D2: { type: StepType.SIMPLE, x: 221, y: 573 },\n      D3: { type: StepType.ENCLOSING, x: 381, y: 639 },\n    },\n    [ProcedureType.F]: {\n      F1: { type: StepType.MACRO, x: 768, y: 707 },\n      F2: { type: StepType.MACRO, x: 846, y: 233 },\n      F3: { type: StepType.MACRO, x: 982, y: 147 },\n      F4: { type: StepType.ENCLOSING, x: 848, y: 29 },\n      F5: { type: StepType.ENCLOSING, x: 734, y: 282 },\n      F6: { type: StepType.ENCLOSING, x: 722, y: 378 },\n    },\n  };\n\n  const nodes: {\n    [key: string]: NodeModel<Step, GemmaGrafcet, Transition>;\n  } = {};\n\n  for (const [family, nn] of Object.entries(nodesRaw)) {\n    for (const [k, v] of Object.entries(nn)) {\n      const n = rootStore.addNode(v.type, { x: v.x, y: v.y });\n      n?.setName(k);\n      n!.data.family = family as ProcedureType;\n      nodes[k] = n!;\n      if (k === \"A6\") {\n        n!.data.isInitial = true;\n      }\n    }\n  }\n\n  const connections = {\n    A1: [\"F2\", \"F1\", \"F6\", \"F5\", \"F4\"],\n    A2: [\"A1\"],\n    A3: [\"A4\"],\n    A4: [\"F1\"],\n    A5: [\"A7\"],\n    A6: [\"A1\"],\n    A7: [\"A4\"],\n    F1: [\"F3\", \"A2\", \"A3\", \"D1\", \"D3\"],\n    F2: [\"F1\"],\n    F3: [\"A1\"],\n    F4: [\"A6\"],\n    D1: [\"D2\", \"A5\"],\n    D2: [\"A5\"],\n    D3: [\"A2\", \"A3\"],\n  };\n\n  for (const [from, v] of Object.entries(connections)) {\n    for (const to of v) {\n      rootStore.addConnection(nodes[from], nodes[to]);\n    }\n  }\n\n  rootStore.addConnection(rootStore.globalData.fFamily!, nodes[\"D1\"]!, {\n    conditionExpression: \"I1 AND I2\",\n  });\n\n  const a1 = nodes[\"A1\"]!;\n  rootStore.selectNode(a1);\n  rootStore.selectConnection(a1.outputs[0]);\n\n  return rootStore;\n};\n","import { EnclosingStep } from \"./step\";\n\nexport const enclosingStepTemplate = (model: EnclosingStep) =>\n  `\\\nFUNCTION_BLOCK ${model.name}_FB\n\n// Variable declaration\nVAR_INPUT\n  Initialization:BOOL;\nEND_VAR\n\n// FB behavior\nIF Initialization THEN\n  //Initialization actions\n\nEND_IF\n\n//Nested behavior\n\n`;\n","import Button from \"@material-ui/core/Button\";\nimport Dialog from \"@material-ui/core/Dialog\";\nimport DialogContent from \"@material-ui/core/DialogContent\";\nimport DialogTitle from \"@material-ui/core/DialogTitle\";\nimport DialogActions from \"@material-ui/core/DialogActions\";\nimport DialogContentText from \"@material-ui/core/DialogContentText\";\nimport React, { useCallback, useState } from \"react\";\nimport { MainCanvas } from \"./canvas/canvas\";\nimport { ConfigView } from \"./canvas/config-view\";\nimport { createIndexedDB, IndexedDB } from \"./canvas/persistence\";\nimport { RootStoreModel, GlobalData } from \"./canvas/store\";\nimport { NodeData, ConnectionData } from \"./node/node-model\";\nimport { PropertiesView } from \"./properties/properties-view\";\nimport { gemmaBuilders, makeBaseGemmaTemplate } from \"./step/gemma\";\nimport { importJson } from \"./utils\";\n\nexport const storeContext = React.createContext<RootStoreModel<\n  any,\n  any,\n  any\n> | null>(null);\n\nexport function useStore<\n  D extends NodeData<D, G, C>,\n  G extends GlobalData<D>,\n  C extends ConnectionData<D>\n>() {\n  const store = React.useContext<RootStoreModel<D, G, C> | null>(storeContext);\n  if (!store) {\n    throw Error(\"useStore should be used inside a Store provider.\");\n  }\n  return store;\n}\n\ntype RootStore = RootStoreModel<any, any, any>;\n\nexport function App() {\n  const [globalDB, setDB] = React.useState<IndexedDB | null>(null);\n  const [store, setStore] = React.useState<RootStore | null>(null);\n  const _isReset = store && store.resetStore;\n  React.useEffect(() => {\n    if (!store) {\n      createIndexedDB().then(async (db) => {\n        setDB(db);\n        const graphs = await db.fetchGraphs();\n\n        let _store: RootStore;\n        const graph = graphs[0];\n        if (graph !== undefined) {\n          const graphExt = await db.loadGraph(graph.key);\n          _store = new RootStoreModel({\n            db,\n            json: { graph, ...graphExt },\n            hideOnDelete: true,\n            builders: gemmaBuilders,\n          });\n        } else {\n          _store = makeBaseGemmaTemplate(db);\n        }\n\n        (window as any).store = _store;\n        setStore(_store);\n      });\n    } else if (store.resetStore) {\n      setStore(null);\n    }\n  }, [store, _isReset]);\n\n  if (!store) {\n    return <div className=\"center\">Loading...</div>;\n  }\n\n  return (\n    <storeContext.Provider value={store}>\n      <div\n        className=\"row\"\n        style={{ background: \"rgba(250,250,250,0.7)\", height: \"100%\" }}\n      >\n        {/* <div className=\"col\">\n          <MainMenu items={Object.keys(rootStore.builders.nodeBuilder)} />\n        </div> */}\n        <div\n          className=\"col\"\n          style={{\n            width: \"0px\",\n            background: \"rgba(250,250,250,0.7)\",\n            flex: \"1 0 auto\",\n          }}\n        >\n          <div className=\"row\" style={{ minHeight: 0, flex: 1 }}>\n            <div className=\"col\">\n              <TopMenu store={store} globalDB={globalDB!} setStore={setStore} />\n              <MainCanvas />\n            </div>\n            <ConfigView />\n          </div>\n          <PropertiesView />\n        </div>\n      </div>\n    </storeContext.Provider>\n  );\n}\n\nfunction TopMenu({\n  store,\n  setStore,\n  globalDB,\n}: {\n  store: RootStore;\n  globalDB: IndexedDB;\n  setStore: (store: RootStore) => void;\n}) {\n  const [isResetDialogOpen, setIsResetDialogOpen] = useState(false);\n  const toggleDialog = useCallback(() => {\n    setIsResetDialogOpen(!isResetDialogOpen);\n  }, [isResetDialogOpen]);\n\n  return (\n    <div\n      className=\"row\"\n      style={{\n        justifyContent: \"flex-end\",\n        borderBottom: \"rgb(221 220 220) solid 1.5px\",\n      }}\n    >\n      <Button\n        onClick={(_) => {\n          store.saveModel();\n        }}\n      >\n        Save\n      </Button>\n      <Button onClick={toggleDialog}>Reset</Button>\n      <Dialog\n        open={isResetDialogOpen}\n        onClose={toggleDialog}\n        keepMounted\n        aria-labelledby=\"alert-dialog-slide-title\"\n        aria-describedby=\"alert-dialog-slide-description\"\n      >\n        <DialogTitle id=\"alert-dialog-slide-title\">\n          Reset Diagram State\n        </DialogTitle>\n        <DialogContent>\n          <DialogContentText id=\"alert-dialog-slide-description\">\n            Are you sure you want to reset the diagram state? All changes will\n            be lost.\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={toggleDialog} color=\"primary\">\n            Close\n          </Button>\n          <Button\n            onClick={async (_) => {\n              const _store = makeBaseGemmaTemplate(globalDB);\n              setStore(_store);\n              toggleDialog();\n            }}\n            color=\"primary\"\n          >\n            Reset Diagram\n          </Button>\n        </DialogActions>\n      </Dialog>\n      <Button\n        onClick={(_) => {\n          store.downloadModel();\n        }}\n      >\n        Export\n      </Button>\n      <Button>\n        <label\n          htmlFor=\"import-file-input\"\n          style={{ margin: 0, width: \"100%\", cursor: \"pointer\" }}\n        >\n          Import\n        </label>\n        <input\n          type=\"file\"\n          id=\"import-file-input\"\n          accept=\"application/json\"\n          style={{ display: \"none\" }}\n          onChange={async (e) => {\n            const json = await importJson(e);\n            if (typeof json === \"string\") {\n              try {\n                const val = JSON.parse(json);\n                const _store = new RootStoreModel({\n                  db: globalDB,\n                  json: val,\n                  builders: gemmaBuilders,\n                });\n                setStore(_store);\n              } catch (e) {\n                console.log(e);\n              }\n            }\n          }}\n        />\n      </Button>\n    </div>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker === null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import { library } from \"@fortawesome/fontawesome-svg-core\";\nimport { faChevronDown, faChevronUp, faTrashAlt, faEye, faEyeSlash} from \"@fortawesome/free-solid-svg-icons\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { App } from \"./App\";\nimport \"./index.css\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nlibrary.add(faChevronDown, faChevronUp, faTrashAlt, faEye, faEyeSlash);\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}